import{r as l,R as r}from"./index-6f814c40.js";import{c as M}from"./index-74f03c09.js";import{e as oe,h as pe,i as me,t as fe,u as be,f as we,s as ve,d as ye,p as ge}from"./requests-85814546.js";import{a0 as he,a1 as xe,n as Ce,a2 as Ee,h as Pe,j as Te,k as _e,C as Ne,a as Ae,S as Se}from"./patient-allergies-17fa370a.js";import"./_baseToString-187d444d.js";import{c as te,a as ke,T as Ie}from"./table-e295e10f.js";import"./_baseClone-fef349e9.js";import"./sortBy-efab5300.js";import"./_equalByTag-10364aa0.js";import"./_baseForOwn-253202de.js";import"./_createSet-3974b849.js";import{c as Re}from"./_basePickBy-fb0e0feb.js";import"./action-list-e2dd9cac.js";import{h as ie,i as Fe,C as k,y as I,s as W,a as Q,$ as R,I as se,o as $,S as ne,u as ce,M as H,e as De,b as h,O as N,T as x,v as Oe,j as re}from"./drawer-13cd88e8.js";import"./spinner-66aa4ba7.js";import"./request-47bfd586.js";import"./_commonjsHelpers-042e6b4d.js";import"./isEqual-ce9a64bb.js";import"./_baseIsEqual-3673da74.js";import"./coding-list-1d7c950f.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./mapValues-df167d9c.js";import"./data-list-254aa0b0.js";import"./uniq-e0410fc4.js";import"./_arrayIncludes-66d8e0f7.js";import"./isString-f42f95ae.js";import"./extends-f6fdd1c6.js";import"./index-6de6b113.js";import"./debounce-13803188.js";import"./toNumber-02bd1cf0.js";import"./isPlainObject-b29fff7a.js";function $e({onFocus:e}){let[t,n]=l.useState(!0);return t?r.createElement(ie,{as:"button",type:"button",features:Fe.Focusable,onFocus:a=>{a.preventDefault();let o,s=50;function i(){if(s--<=0){o&&cancelAnimationFrame(o);return}if(e()){n(!1),cancelAnimationFrame(o);return}o=requestAnimationFrame(i)}o=requestAnimationFrame(i)}}):null}var He=(e=>(e[e.SetSelectedIndex=0]="SetSelectedIndex",e[e.RegisterTab=1]="RegisterTab",e[e.UnregisterTab=2]="UnregisterTab",e[e.RegisterPanel=3]="RegisterPanel",e[e.UnregisterPanel=4]="UnregisterPanel",e))(He||{});let Le={[0](e,t){let n=e.tabs.filter(s=>{var i;return!((i=s.current)!=null&&i.hasAttribute("disabled"))});if(t.index<0)return{...e,selectedIndex:e.tabs.indexOf(n[0])};if(t.index>e.tabs.length)return{...e,selectedIndex:e.tabs.indexOf(n[n.length-1])};let a=e.tabs.slice(0,t.index),o=[...e.tabs.slice(t.index),...a].find(s=>n.includes(s));return o?{...e,selectedIndex:e.tabs.indexOf(o)}:e},[1](e,t){var n;if(e.tabs.includes(t.tab))return e;let a=e.tabs[e.selectedIndex],o=re([...e.tabs,t.tab],i=>i.current),s=(n=o.indexOf(a))!=null?n:e.selectedIndex;return s===-1&&(s=e.selectedIndex),{...e,tabs:o,selectedIndex:s}},[2](e,t){return{...e,tabs:e.tabs.filter(n=>n!==t.tab)}},[3](e,t){return e.panels.includes(t.panel)?e:{...e,panels:re([...e.panels,t.panel],n=>n.current)}},[4](e,t){return{...e,panels:e.panels.filter(n=>n!==t.panel)}}},Y=l.createContext(null);Y.displayName="TabsSSRContext";function J(e){let t=l.useContext(Y);if(t===null){let n=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,J),n}return t}let K=l.createContext(null);K.displayName="TabsDataContext";function A(e){let t=l.useContext(K);if(t===null){let n=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,A),n}return t}let X=l.createContext(null);X.displayName="TabsActionsContext";function Z(e){let t=l.useContext(X);if(t===null){let n=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,Z),n}return t}function Me(e,t){return ce(t.type,Le,e,t)}let qe=l.Fragment,We=k(function(e,t){let{defaultIndex:n=0,vertical:a=!1,manual:o=!1,onChange:s,selectedIndex:i=null,...d}=e;const v=a?"vertical":"horizontal",y=o?"manual":"auto";let b=i!==null,g=I(t),[m,u]=l.useReducer(Me,{selectedIndex:i??n,tabs:[],panels:[]}),C=l.useMemo(()=>({selectedIndex:m.selectedIndex}),[m.selectedIndex]),p=W(s||(()=>{})),f=W(m.tabs),E=l.useMemo(()=>({orientation:v,activation:y,...m}),[v,y,m]),T=W(b?e.selectedIndex:m.selectedIndex),_=l.useMemo(()=>({registerTab(w){return u({type:1,tab:w}),()=>u({type:2,tab:w})},registerPanel(w){return u({type:3,panel:w}),()=>u({type:4,panel:w})},change(w){T.current!==w&&p.current(w),b||u({type:0,index:w})}}),[u,b]);Q(()=>{u({type:0,index:i??n})},[i]);let S=l.useRef({tabs:[],panels:[]}),q={ref:g};return r.createElement(Y.Provider,{value:S},r.createElement(X.Provider,{value:_},r.createElement(K.Provider,{value:E},E.tabs.length<=0&&r.createElement($e,{onFocus:()=>{var w,F;for(let D of f.current)if(((w=D.current)==null?void 0:w.tabIndex)===0)return(F=D.current)==null||F.focus(),!0;return!1}}),R({ourProps:q,theirProps:d,slot:C,defaultTag:qe,name:"Tabs"}))))}),Ue="div",Ve=k(function(e,t){let{orientation:n,selectedIndex:a}=A("Tab.List"),o=I(t);return R({ourProps:{ref:o,role:"tablist","aria-orientation":n},theirProps:e,slot:{selectedIndex:a},defaultTag:Ue,name:"Tabs.List"})}),je="button",Be=k(function(e,t){var n,a;let o=`headlessui-tabs-tab-${se()}`,{orientation:s,activation:i,selectedIndex:d,tabs:v,panels:y}=A("Tab"),b=Z("Tab"),g=A("Tab"),m=J("Tab"),u=l.useRef(null),C=I(u,t);Q(()=>b.registerTab(u),[b,u]);let p=m.current.tabs.indexOf(o);p===-1&&(p=m.current.tabs.push(o)-1);let f=v.indexOf(u);f===-1&&(f=p);let E=f===d,T=$(c=>{var P;let O=c();if(O===H.Success&&i==="auto"){let de=(P=De(u))==null?void 0:P.activeElement,ee=g.tabs.findIndex(ue=>ue.current===de);ee!==-1&&b.change(ee)}return O}),_=$(c=>{let P=v.map(O=>O.current).filter(Boolean);if(c.key===h.Space||c.key===h.Enter){c.preventDefault(),c.stopPropagation(),b.change(f);return}switch(c.key){case h.Home:case h.PageUp:return c.preventDefault(),c.stopPropagation(),T(()=>N(P,x.First));case h.End:case h.PageDown:return c.preventDefault(),c.stopPropagation(),T(()=>N(P,x.Last))}if(T(()=>ce(s,{vertical(){return c.key===h.ArrowUp?N(P,x.Previous|x.WrapAround):c.key===h.ArrowDown?N(P,x.Next|x.WrapAround):H.Error},horizontal(){return c.key===h.ArrowLeft?N(P,x.Previous|x.WrapAround):c.key===h.ArrowRight?N(P,x.Next|x.WrapAround):H.Error}}))===H.Success)return c.preventDefault()}),S=l.useRef(!1),q=$(()=>{var c;S.current||(S.current=!0,(c=u.current)==null||c.focus(),b.change(f),Oe(()=>{S.current=!1}))}),w=$(c=>{c.preventDefault()}),F=l.useMemo(()=>({selected:E}),[E]),D=e,le={ref:C,onKeyDown:_,onMouseDown:w,onClick:q,id:o,role:"tab",type:he(e,u),"aria-controls":(a=(n=y[f])==null?void 0:n.current)==null?void 0:a.id,"aria-selected":E,tabIndex:E?0:-1};return R({ourProps:le,theirProps:D,slot:F,defaultTag:je,name:"Tabs.Tab"})}),Ge="div",ze=k(function(e,t){let{selectedIndex:n}=A("Tab.Panels"),a=I(t),o=l.useMemo(()=>({selectedIndex:n}),[n]);return R({ourProps:{ref:a},theirProps:e,slot:o,defaultTag:Ge,name:"Tabs.Panels"})}),Qe="div",Ye=ne.RenderStrategy|ne.Static,Je=k(function(e,t){var n,a,o,s;let{selectedIndex:i,tabs:d,panels:v}=A("Tab.Panel"),y=Z("Tab.Panel"),b=J("Tab.Panel"),g=`headlessui-tabs-panel-${se()}`,m=l.useRef(null),u=I(m,t);Q(()=>y.registerPanel(m),[y,m]);let C=b.current.panels.indexOf(g);C===-1&&(C=b.current.panels.push(g)-1);let p=v.indexOf(m);p===-1&&(p=C);let f=p===i,E=l.useMemo(()=>({selected:f}),[f]),T=e,_={ref:u,id:g,role:"tabpanel","aria-labelledby":(a=(n=d[p])==null?void 0:n.current)==null?void 0:a.id,tabIndex:f?0:-1};return!f&&((o=e.unmount)==null||o)&&!((s=e.static)!=null&&s)?r.createElement(ie,{as:"span",..._}):R({ourProps:_,theirProps:T,slot:E,defaultTag:Qe,features:Ye,visible:f,name:"Tabs.Panel"})}),L=Object.assign(Be,{Group:We,List:Ve,Panels:ze,Panel:Je});function V({hideAdd:e,onToggleShowHistoric:t}){const n=oe();return r.createElement("div",{className:"ctw-flex ctw-items-center ctw-justify-end ctw-space-x-2 ctw-p-3"},r.createElement(xe,{name:"historic",text:"Historic",onChange:t}),!e&&r.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:()=>n()},"Add Condition"))}try{V.displayName="PatientConditionsActions",V.__docgenInfo={description:"",displayName:"PatientConditionsActions",props:{hideAdd:{defaultValue:null,description:"",name:"hideAdd",required:!0,type:{name:"boolean"}},onToggleShowHistoric:{defaultValue:null,description:"",name:"onToggleShowHistoric",required:!0,type:{name:"() => void"}}}}}catch{}function Ke(e){switch(e){case"Active":return"ctw-text-success-main";case"Pending":return"ctw-text-caution-main";default:return"ctw-text-content-lighter"}}const Xe=[{widthPercent:30,minWidth:320,render:e=>r.createElement("div",null,r.createElement("div",{className:"ctw-pc-title group-hover:ctw-underline"},e.display),r.createElement("div",{className:"ctw-pc-chapter"},e.ccsChapter))},{render:e=>{var t,n;return r.createElement("div",{className:"ctw-pc-status-container"},r.createElement("div",{className:M("ctw-pc-status-dot",Ke(e.displayStatus))},"â€¢"),r.createElement("div",{className:"ctw-pc-status-and-extra"},r.createElement("div",{className:"ctw-pc-status"},e.displayStatus),e.isSummaryResource?r.createElement("div",null,te([(n=(t=e.patient)==null?void 0:t.organization)==null?void 0:n.name,e.recordedDate]).join(" ")):r.createElement("div",null,te([e.recorder,e.recordedDate]).join(" "))))},widthPercent:30,minWidth:128},{widthPercent:40,minWidth:132,render:e=>{const t=e.isSummaryResource?"Earliest known onset:":"Onset:";return r.createElement("div",{className:"ctw-pc-onset-notes"},e.onset&&r.createElement("div",null,t," ",e.onset),r.createElement("div",{className:"ctw-pc-notes"},e.notes.join(" ")))}}];function Ze(){const[e,t]=l.useState({collection:"patient",showHistoric:!1});function n(o){t(ke(Re(e),o))}function a(o,s){return(e.collection==="patient"?o:s).filter(d=>e.showHistoric?!0:["Active","Pending"].includes(d.displayStatus))}return{filters:e,updateFilters:n,applyFilters:a}}const j=({record:e})=>{const t=pe(),n=me();return r.createElement("div",{className:"ctw-flex ctw-space-x-2"},!e.isDeleted&&r.createElement("button",{type:"button",className:"ctw-btn-default",onClick:a=>{a.stopPropagation(),n(e)}},"Remove"),r.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:a=>{a.stopPropagation(),t(e)}},"Edit"))},B=({record:e})=>{const t=oe(),{getRequestContext:n}=Ce();return r.createElement("div",{className:"ctw-flex ctw-space-x-2"},r.createElement("button",{type:"button",className:"ctw-btn-default",onClick:async a=>{a.stopPropagation(),await fe(e,await n())}},e.isArchived?"Restore":"Dismiss"),r.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:a=>{a.stopPropagation(),t(e)}},"Add"))};try{j.displayName="PatientConditionHoverActions",j.__docgenInfo={description:"",displayName:"PatientConditionHoverActions",props:{record:{defaultValue:null,description:"",name:"record",required:!0,type:{name:"ConditionModel"}}}}}catch{}try{B.displayName="OtherProviderConditionHoverActions",B.__docgenInfo={description:"",displayName:"OtherProviderConditionHoverActions",props:{record:{defaultValue:null,description:"",name:"record",required:!0,type:{name:"ConditionModel"}}}}}catch{}function G({collection:e,otherConditions:t,onCollectionChange:n}){function a(d){return e===d?"ctw-text-content-black":"ctw-text-content-light"}const o=t.filter(d=>d.displayStatus==="Active").length;function s(){typeof document<"u"&&requestAnimationFrame(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()})}const i="ctw-relative ctw-tab-underline ctw-tab";return r.createElement("div",{className:"ctw-justify-end ctw-space-x-2 ctw-border-0 ctw-border-b ctw-border-t ctw-border-solid ctw-border-divider-light"},r.createElement("div",{className:"ctw-space-x-4"},r.createElement(L.Group,{onChange:d=>{n(d===0?"patient":"other")}},r.createElement(L.List,{className:"ctw-mt-3"},r.createElement(L,{onClick:s,className:({selected:d})=>M(a("patient"),i,{"ctw-tab-underline-selected":d})},"Condition List"),r.createElement(L,{onClick:s,className:({selected:d})=>M(a("other"),i,"ctw-space-x-2",{"ctw-tab-underline-selected":d})},r.createElement("span",null,"Other Provider Records"),r.createElement(Ee,{text:`${o}`,color:"primary"}))))))}try{G.displayName="PatientConditionsTabs",G.__docgenInfo={description:"",displayName:"PatientConditionsTabs",props:{collection:{defaultValue:null,description:"",name:"collection",required:!0,type:{name:"enum",value:[{value:'"patient"'},{value:'"other"'}]}},otherConditions:{defaultValue:null,description:"",name:"otherConditions",required:!0,type:{name:"ConditionModel[]"}},onCollectionChange:{defaultValue:null,description:"",name:"onCollectionChange",required:!0,type:{name:"(collection: FilterCollection) => void"}}}}}catch{}function z({className:e,readOnly:t=!1}){const{filters:n,updateFilters:a,applyFilters:o}=Ze(),s=l.useRef(null),i=Pe(s),d=be(),v=Te(),y=_e();function b(){const p=v.isLoading,f=p||y.isLoading;return n.collection==="patient"?p:f}const g=v.data??[],m=we(y.data??[],g,!0),u=o(g,m),C=n.collection==="patient"?j:B;return r.createElement("div",{ref:s,className:M("ctw-patient-conditions",e,{"ctw-patient-conditions-stacked":i.sm})},r.createElement("div",{className:"ctw-items-center ctw-justify-between ctw-py-5 ctw-px-4"},r.createElement("div",{className:"ctw-ml-3 ctw-text-xl ctw-font-medium ctw-text-content-black"},"Conditions"),r.createElement(G,{otherConditions:m,collection:n.collection,onCollectionChange:p=>a({collection:p})}),r.createElement(V,{hideAdd:t||n.collection==="other",onToggleShowHistoric:()=>a({showHistoric:!n.showHistoric})}),r.createElement(Ie,{stacked:i.sm,className:"-ctw-mx-px !ctw-rounded-none",showTableHead:!1,isLoading:b(),records:u,RowActions:t?void 0:C,columns:Xe,handleRowClick:p=>d({condition:p,readOnly:t||p.isSummaryResource})})))}try{z.displayName="PatientConditions",z.__docgenInfo={description:"",displayName:"PatientConditions",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},readOnly:{defaultValue:{value:"false"},description:"",name:"readOnly",required:!1,type:{name:"boolean"}}}}}catch{}const It={component:z,tags:["docsPage"],argTypes:{className:{options:["Blank","Fixed Width"],control:"select",mapping:{Blank:"","Fixed Width":"ctw-m-auto ctw-max-w-[600px]"}}},args:{className:"Blank",readOnly:!1},decorators:[(e,{args:t})=>r.createElement(Ne,{env:"dev",authToken:"dummy-token",builderId:"b123"},r.createElement(Ae,{patientID:"u12345",systemURL:Se},r.createElement(e,{args:t})))]},U={...ve({otherConditions:ye,patientConditions:ge})};var ae;U.parameters={...U.parameters,storySource:{source:`{
  ...setupConditionMocks({
    otherConditions,
    patientConditions
  })
}`,...(ae=U.parameters)==null?void 0:ae.storySource}};const Rt=["Basic"];export{U as Basic,Rt as __namedExportsOrder,It as default};
//# sourceMappingURL=patient-conditions.stories-fa6bcf10.js.map

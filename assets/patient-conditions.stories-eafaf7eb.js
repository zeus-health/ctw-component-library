import{R as t,r as _}from"./index-6f814c40.js";import{c as j}from"./index-74f03c09.js";import{h as W,P as J,i as K,j as X,t as ee,u as te,f as ne,s as Z,d as ae,p as se,e as R}from"./requests-615a9c4c.js";import{u as z,P as ie}from"./use-patient-history-3c70314f.js";import{aa as re,ab as oe,u as ce,ac as de,ad as le,k as I,ae as pe,w as ue,h as me,j as ye,C as Ce,a as fe,S as he}from"./patient-allergies-c03cbc79.js";import{C as we,c as C,f as ve,T as ge}from"./table-cb4e25ad.js";import"./_baseToString-7c0e3f59.js";import"./_baseClone-17ec433b.js";import"./sortBy-a390368e.js";import{b as Q}from"./_equalByTag-eda72788.js";import"./_baseForOwn-7324d3a8.js";import"./_createSet-6ff8e1d4.js";import{c as _e}from"./_basePickBy-fa3aec3b.js";import{u as g}from"./uniq-8676ca12.js";import"./action-list-bc3500ad.js";import"./drawer-3c02213f.js";import"./spinner-66aa4ba7.js";import"./request-5d5ec5f4.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-ccda-e3498c56.js";import"./isEqual-298b6ab1.js";import"./_baseIsEqual-7d59e24c.js";import"./coding-list-1d7c950f.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./mapValues-13598fe6.js";import"./data-list-254aa0b0.js";import"./extends-b0154772.js";import"./isString-933c0e0c.js";import"./debounce-5029c56d.js";import"./toNumber-d7ce3bd9.js";import"./index-6de6b113.js";import"./isPlainObject-f51be120.js";function N({hideAdd:e,sortOptions:n,updateSorts:i,activeCollection:a,currentSorts:s,filterItems:c,setFilters:p,filters:r}){const d=W(),l=z();return t.createElement("div",{className:"ctw-flex ctw-flex-wrap ctw-items-center ctw-justify-between ctw-py-3 sm:ctw-pt-1.5"},t.createElement("div",{className:"ctw-flex ctw-flex-wrap ctw-gap-x-2"},t.createElement(Se,{options:n,updateSorts:i,activeCollection:a,currentSorts:s}),t.createElement(re,{filters:c,handleOnChange:p,defaultState:r})),l.lastRetrievedAt&&e&&t.createElement(J,{patientHistory:l,message:"Last Retrieved"}),!e&&t.createElement("button",{type:"button",className:"ctw-btn-primary ctw-p-0",onClick:()=>d()},"Add Condition"))}const Se=({options:e,updateSorts:n,activeCollection:i,currentSorts:a})=>t.createElement(oe,{type:"select",buttonClassName:"ctw-bg-transparent ctw-border-none ctw-p-0",onItemSelect:s=>{const{dir:c,key:p,isDate:r}=e.filter(d=>d.display===s.key)[0];n({[i]:{key:p,dir:c,isDate:r,display:s.name}})},items:e.map(s=>({key:s.display,name:s.display,isSelected:a.display===s.display}))},t.createElement("div",{className:"ctw-btn-default ctw-flex ctw-items-center ctw-space-x-1"},t.createElement("span",null,"Sort"),t.createElement(we,{className:"ctw-h-4"})));try{N.displayName="PatientConditionsActions",N.__docgenInfo={description:"",displayName:"PatientConditionsActions",props:{hideAdd:{defaultValue:null,description:"",name:"hideAdd",required:!0,type:{name:"boolean"}},sortOptions:{defaultValue:null,description:"",name:"sortOptions",required:!0,type:{name:"SortOption<ConditionModel>[]"}},updateSorts:{defaultValue:null,description:"",name:"updateSorts",required:!0,type:{name:"(newSorts: Partial<Sort>) => void"}},activeCollection:{defaultValue:null,description:"",name:"activeCollection",required:!0,type:{name:"enum",value:[{value:'"patient"'},{value:'"other"'}]}},currentSorts:{defaultValue:null,description:"",name:"currentSorts",required:!0,type:{name:"Sort"}},filterItems:{defaultValue:null,description:"",name:"filterItems",required:!0,type:{name:"FilterItem[]"}},setFilters:{defaultValue:null,description:"",name:"setFilters",required:!0,type:{name:"(filterChangeEvent: FilterChangeEvent) => void"}},filters:{defaultValue:null,description:"",name:"filters",required:!0,type:{name:"FilterChangeEvent"}}}}}catch{}function Ee(e){switch(e){case"Active":return"ctw-text-success-main";case"Pending":return"ctw-text-caution-main";default:return"ctw-text-content-lighter"}}const be=[{widthPercent:30,minWidth:320,render:e=>t.createElement("div",null,t.createElement("div",{className:"ctw-pc-title group-hover:ctw-underline"},e.display),t.createElement("div",{className:"ctw-pc-chapter"},e.ccsChapter))},{render:e=>{var n,i;return t.createElement("div",{className:"ctw-pc-status-container"},t.createElement("div",{className:j("ctw-pc-status-dot",Ee(e.displayStatus))},"â€¢"),t.createElement("div",{className:"ctw-pc-status-and-extra"},t.createElement("div",{className:"ctw-pc-status"},e.displayStatus),e.isSummaryResource?t.createElement("div",null,C([(i=(n=e.patient)==null?void 0:n.organization)==null?void 0:i.name,e.recordedDate]).join(" ")):t.createElement("div",null,C([e.recorder,e.recordedDate]).join(" "))))},widthPercent:30,minWidth:128},{widthPercent:40,minWidth:132,render:e=>{const n=e.isSummaryResource?"Earliest known onset:":"Onset:";return t.createElement("div",{className:"ctw-pc-onset-notes"},e.onset&&t.createElement("div",null,n," ",e.onset),t.createElement("div",{className:"ctw-pc-notes"},e.notes.join(" ")))}}],ke={patient:{displayStatus:{key:"displayStatus",selected:["Active","Pending","Unknown"],type:"checkbox"}},other:{displayStatus:{key:"displayStatus",selected:["Active","Pending","Unknown"],type:"checkbox"}}};function P(e){const[n,i]=_.useState({...ke});function a(r){i(()=>({...n,[e]:{...s(r)}}))}const s=r=>{const d=_e(r),l=ve(d,o=>typeof(o==null?void 0:o.selected)>"u"&&(o==null?void 0:o.type)==="checkbox"||(o==null?void 0:o.type)==="select");return l!=null&&l.key?{...d,[l.key]:{isOpen:!0}}:r};function c(r){var d,l;return[{key:"displayStatus",type:"checkbox",icon:"eye",display:()=>"Status",values:g(r.map(o=>o.displayStatus)),isOpen:(d=n[e].displayStatus)==null?void 0:d.isOpen},{key:"ccsChapter",type:"checkbox",icon:"eye",display:()=>"Category",values:C(g(r.map(o=>o.ccsChapter))),isOpen:(l=n[e].ccsChapter)==null?void 0:l.isOpen}]}function p(r,d){const l=e==="patient"?r:d;return l.filter(o=>Object.entries(n[e]).every(([D,u])=>{if((u==null?void 0:u.type)==="checkbox"&&Q(u.selected)){const m=u.selected.filter(f=>C(g(l.map(h=>h[u.key]))).includes(f)),S=o[u.key]??"";return m.length<1||m.includes(String(S))}return!0}))}return{filters:n,updateFilters:a,applyFilters:p,availableFilters:c}}try{P.displayName="useConditionFilters",P.__docgenInfo={description:"",displayName:"useConditionFilters",props:{}}}catch{}const A=({record:e})=>{const n=K(),i=X();return t.createElement("div",{className:"ctw-flex ctw-space-x-2"},!e.isDeleted&&t.createElement("button",{type:"button",className:"ctw-btn-default",onClick:a=>{a.stopPropagation(),i(e)}},"Remove"),t.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:a=>{a.stopPropagation(),n(e)}},"Edit"))},x=({record:e})=>{const n=W(),{getRequestContext:i}=ce();return t.createElement("div",{className:"ctw-flex ctw-space-x-2"},t.createElement("button",{type:"button",className:"ctw-btn-default",onClick:async a=>{a.stopPropagation(),await ee(e,await i())}},e.isArchived?"Restore":"Dismiss"),t.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:a=>{a.stopPropagation(),n(e)}},"Add"))};try{A.displayName="PatientConditionHoverActions",A.__docgenInfo={description:"",displayName:"PatientConditionHoverActions",props:{record:{defaultValue:null,description:"",name:"record",required:!0,type:{name:"ConditionModel"}}}}}catch{}try{x.displayName="OtherProviderConditionHoverActions",x.__docgenInfo={description:"",displayName:"OtherProviderConditionHoverActions",props:{record:{defaultValue:null,description:"",name:"record",required:!0,type:{name:"ConditionModel"}}}}}catch{}const q={key:"recordedDate",dir:"desc",display:"Last Updated Date (Newest to Oldest)"},Ne={patient:{...q},other:{...q}},Pe=[{display:"Name (A-Z)",key:"display",dir:"asc"},{display:"Name (Z-A)",key:"display",dir:"desc"},{display:"Category (A-Z)",key:"ccsChapter",dir:"asc"},{display:"Category (Z-A)",key:"ccsChapter",dir:"desc"},{display:"Status (A-Z)",key:"displayStatus",dir:"asc"},{display:"Status (Z-A)",key:"displayStatus",dir:"desc"},{display:"Last Updated Date (Oldest to Newest)",key:"recordedDate",dir:"asc",isDate:!0},{display:"Last Updated Date (Newest to Oldest)",key:"recordedDate",dir:"desc",isDate:!0}];function F(e){const[n,i]=_.useState(Ne);function a(c){i({...n,...c})}function s(c){const p=n[e];return de(c,r=>r[p.key],p.dir,p.isDate)}return{applySorts:s,sortOptions:Pe,updateSorts:a,currentSorts:n}}try{F.displayName="useConditionSorts",F.__docgenInfo={description:"",displayName:"useConditionSorts",props:{}}}catch{}const Ae=[{key:"inactive-provider-records",getPanelClassName:e=>e?"ctw-mt-0":"ctw-mt-2",display:()=>"condition list",render:()=>null},{key:"other-provider-records",getPanelClassName:e=>e?"ctw-mt-0":"ctw-mt-2",display:()=>t.createElement(t.Fragment,null,t.createElement("span",{className:"ctw-pr-2 ctw-capitalize"},"other provider records"),t.createElement(xe,null)),render:()=>null}];function O({collection:e,onCollectionChange:n,forceHorizontalTabs:i=!1}){const a=z();return t.createElement(t.Fragment,null,e==="other"&&t.createElement(ie,{status:a.lastStatus,date:a.dateCreatedAt}),t.createElement(le,{content:Ae,forceHorizontalTabs:i,onChange:s=>{n(s===0?"patient":"other")}}))}const xe=()=>{const e=I();if(!e.data)return null;const n=e.data.filter(i=>i.displayStatus==="Active");return n.length>0?t.createElement(pe,{color:"notification",text:n.length.toString(),className:"ctw-h-5"}):null};try{O.displayName="PatientConditionsTabs",O.__docgenInfo={description:"",displayName:"PatientConditionsTabs",props:{collection:{defaultValue:null,description:"",name:"collection",required:!0,type:{name:"enum",value:[{value:'"patient"'},{value:'"other"'}]}},forceHorizontalTabs:{defaultValue:{value:"false"},description:"",name:"forceHorizontalTabs",required:!1,type:{name:"boolean"}},onCollectionChange:{defaultValue:null,description:"",name:"onCollectionChange",required:!0,type:{name:"(collection: FilterCollection) => void"}},otherConditions:{defaultValue:null,description:"",name:"otherConditions",required:!0,type:{name:"ConditionModel[]"}}}}}catch{}const Fe=(e,n)=>e.filter(i=>Object.entries(n).every(([a,s])=>{if((s==null?void 0:s.type)==="checkbox"&&Q(s.selected)){const c=s.selected.filter(r=>C(g(e.map(d=>d[s.key]))).includes(r)),p=i[s.key];return c.length<1||c.includes(String(p))}return!0})),T=ue(({className:e,readOnly:n=!1,hideBuilderOwnedRecords:i=!1})=>{const[a,s]=_.useState(i?"other":"patient"),{filters:c,updateFilters:p,availableFilters:r}=P(a),{applySorts:d,sortOptions:l,updateSorts:o,currentSorts:D}=F(a),u=_.useRef(null),m=me(u),S=te(),f=ye(),h=I();function G(){const y=f.isLoading,$=y||h.isLoading;return a==="patient"?y:$}const E=f.data??[],b=ne(h.data??[],E,!0);let k=Fe(a==="patient"?E:b,c[a]);k=d(k);const Y=a==="patient"?A:x;return t.createElement("div",{ref:u,className:j("ctw-patient-resource-component ctw-patient-conditions ctw-items-center ctw-justify-between ctw-py-5",e,{"ctw-patient-conditions-stacked":m.sm})},!i&&t.createElement(O,{forceHorizontalTabs:!0,otherConditions:b,collection:a,onCollectionChange:s}),t.createElement(N,{sortOptions:l,updateSorts:o,activeCollection:a,hideAdd:n||a==="other",currentSorts:D[a],filterItems:r(a==="patient"?E:b),setFilters:p,filters:c[a]}),t.createElement(ge,{stacked:m.sm,removeLeftAndRightBorders:!0,className:"-ctw-mx-px !ctw-rounded-none",showTableHead:!1,emptyMessage:"There are no condition records available.",isLoading:G(),records:k,RowActions:n?void 0:Y,columns:be,handleRowClick:y=>S({condition:y,readOnly:n||y.isSummaryResource})}))},"PatientConditions");try{T.displayName="PatientConditions",T.__docgenInfo={description:"",displayName:"PatientConditions",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}},hideBuilderOwnedRecords:{defaultValue:null,description:"",name:"hideBuilderOwnedRecords",required:!1,type:{name:"boolean"}}}}}catch{}const dt={component:T,tags:["autodocs"],argTypes:{className:{options:["Blank","Fixed Width"],control:"select",mapping:{Blank:"","Fixed Width":"ctw-m-auto ctw-max-w-[600px]"}}},args:{className:"Blank",readOnly:!1},decorators:[(e,{args:n})=>t.createElement(Ce,{env:"dev",authToken:"dummy-token",builderId:"b123"},t.createElement(fe,{patientID:"u12345",systemURL:he},t.createElement(e,{args:n})))]},w={...Z({otherConditions:ae,patientConditions:se})},v={...Z({otherConditions:R,patientConditions:R})};var L,H,V;w.parameters={...w.parameters,docs:{...(L=w.parameters)==null?void 0:L.docs,source:{originalSource:`{
  ...setupConditionMocks({
    otherConditions,
    patientConditions
  })
}`,...(V=(H=w.parameters)==null?void 0:H.docs)==null?void 0:V.source}}};var B,U,M;v.parameters={...v.parameters,docs:{...(B=v.parameters)==null?void 0:B.docs,source:{originalSource:`{
  ...setupConditionMocks({
    otherConditions: emptyConditions,
    patientConditions: emptyConditions
  })
}`,...(M=(U=v.parameters)==null?void 0:U.docs)==null?void 0:M.source}}};const lt=["Basic","Empty"];export{w as Basic,v as Empty,lt as __namedExportsOrder,dt as default};
//# sourceMappingURL=patient-conditions.stories-eafaf7eb.js.map

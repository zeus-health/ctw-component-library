var P=Object.defineProperty;var b=(i,r,e)=>r in i?P(i,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[r]=e;var p=(i,r,e)=>(b(i,typeof r!="symbol"?r+"":r,e),e);import{g as w,f as x,c as S}from"./patient-provider-0703dda3.js";import{aE as C,aF as L,T as m,G as c,a2 as y,aG as F,F as f,a as d,c as l,n as q,at as $,au as j,aj as R,ax as k,az as X,aA as z,aB as G,aC as Y,ay as B,aH as U}from"./patient-helper-9071e41b.js";import"./_baseToString-4993715b.js";import{o as E}from"./sortBy-be5f7eb4.js";import"./_baseClone-25b1595e.js";import"./sortBy-919d7262.js";import"./_equalByTag-aaf39779.js";import{h as H}from"./_baseForOwn-d8306f34.js";import"./_createSet-12ef9b81.js";import{b as h,w as Q,g as T,A as W}from"./values-0b6ffb91.js";import{i as v}from"./isString-35d4a3f2.js";async function me(i,r,e,t){if(!r.id)throw new Error(`Tried to ${t} a resource that hasn't been created yet.`);if(!r.isSummaryResource)throw new Error(`Tried to ${t} a patient record resource.`);const s={resourceType:"Basic",id:i==null?void 0:i.id,code:{coding:[{system:C,code:"adminact",display:"Administrative Activity"},{system:L,code:t}]},subject:{reference:`${r.resourceType}/${r.id}`,type:r.resourceType},author:await w(e)};if((await x(s,e)).id)m.reportActionFailure(t);else throw m.reportActionFailure(t),new Error(`Failed to ${t} resource with id of ${r.id}`)}const Z={active:"Currently taking","entered-in-error":"Never taken","not-taken":"Prescribed, not taken",completed:"No longer taking","on-hold":"On hold",intended:"Intend to take",stopped:"No longer taking"};function N(i,r){var t;if(i.medicationCodeableConcept)return i.medicationCodeableConcept;const e=c("Medication",i.contained,r,(t=i.medicationReference)==null?void 0:t.reference);return e==null?void 0:e.code}function J(i,r){var e;return(e=M(i,r))==null?void 0:e.code}function M(i,r){var s,n;const e=N(i,r),t=(s=e==null?void 0:e.coding)==null?void 0:s.find(o=>o.system===y&&o.extension===void 0);return t||((n=e==null?void 0:e.coding)==null?void 0:n.find(o=>{var a;return o.system===y&&((a=o.extension)==null?void 0:a.some(u=>u.url===F&&u.valueString==="Standardization"))}))}function I(i,r){var t,s,n;let e;switch(i.resourceType){case"MedicationAdministration":case"MedicationDispense":e=(s=(t=i.performer)==null?void 0:t[0])==null?void 0:s.actor;break;case"MedicationRequest":e=i.performer||((n=i.dispenseRequest)==null?void 0:n.performer);break;case"MedicationStatement":default:return}if(e!=null&&e.reference&&e.type==="Organization")return c("Organization",i.contained,r,e.reference)}function K(i){return H(Z,i,"")}class V extends f{get includedPerformer(){var t,s,n,o;const r=(s=(t=this.resource.performer)==null?void 0:t[0])==null?void 0:s.actor.reference,e=c("Practitioner",this.resource.contained,this.includedResources,r);return e?new S(e).fullName:(o=(n=this.resource.performer)==null?void 0:n[0])==null?void 0:o.actor.display}get performer(){return I(this.resource,this.includedResources)}get performerDetails(){var e,t;const{performer:r}=this;return{name:(r==null?void 0:r.name)??"",address:((e=r==null?void 0:r.address)==null?void 0:e[0].text)??"",telecom:((t=r==null?void 0:r.telecom)==null?void 0:t[0].value)??""}}get status(){return this.resource.status}get quantityDisplay(){const{value:r,unit:e="units"}=this.resource.quantity||{};return r?`${r} ${e}`:void 0}get supplied(){const{value:r,unit:e="days"}=this.resource.daysSupply||{};return r?`${r} ${e}`:void 0}}class ee extends f{get dosageDisplay(){const{text:r,route:e,dose:t}=this.resource.dosage||{};return r||h([t==null?void 0:t.value,t==null?void 0:t.unit]).join(" ")}get dosageRoute(){const{route:r}=this.resource.dosage||{};return r==null?void 0:r.text}get effectivePeriod(){const{start:r,end:e}=this.resource.effectivePeriod||{};return{start:r?d(r):"",end:e?d(e):""}}}class te extends f{get includedRequester(){var t,s;const r=(t=this.resource.requester)==null?void 0:t.reference,e=c("Practitioner",this.resource.contained,this.includedResources,r);return e?new S(e).fullName:(s=this.resource.requester)==null?void 0:s.display}get pharmacy(){var s,n,o;const{reference:r,display:e}=((s=this.resource.dispenseRequest)==null?void 0:s.performer)||{},t=c("Organization",this.resource.contained,this.includedResources,r);if(t){const a=(n=t.telecom)==null?void 0:n[0].value,{city:u,state:g,postalCode:_,text:D,line:O=[]}=((o=t.address)==null?void 0:o[0])||{},A=h([u,`${g} ${_}`]).join(", ");return{telecom:a,name:t.name,address:D??h([O,A]).join(`
`)}}return{name:e}}}class re extends f{constructor(){super(...arguments);p(this,"builderPatientRxNormStatus")}get basedOn(){var e,t;return(t=(e=this.resource.basedOn)==null?void 0:e[0])==null?void 0:t.type}get category(){return l(this.resource.category)}get context(){var e;return(e=this.resource.context)==null?void 0:e.display}get dateAsserted(){return d(this.resource.dateAsserted)}set dateAsserted(e){e instanceof Date?this.resource.dateAsserted=q(e):this.resource.dateAsserted=e}get derivedFrom(){var e;return((e=this.resource.derivedFrom)==null?void 0:e.map(({display:t})=>t||""))||[]}get aggregatedFrom(){const e=Q(t=>t.url===$||t.url===j,this.resource.extension);return e!=null&&e.extension?h(e.extension.map(T("valueReference"))):h(this.resource.derivedFrom)}get display(){return l(N(this.resource,this.includedResources))}get dosage(){var e,t;return(t=(e=this.resource.dosage)==null?void 0:e[0])==null?void 0:t.text}get effectiveStart(){var e;return d((e=this.resource.effectivePeriod)==null?void 0:e.start)}get identifier(){var e,t;return(t=(e=this.resource.identifier)==null?void 0:e[0])==null?void 0:t.value}get informationSource(){return this.resource.informationSource||void 0}set informationSource(e){this.resource.informationSource=e}get medicationReference(){var e;return(e=this.resource.medicationReference)==null?void 0:e.display}get notesDisplay(){var e;return((e=this.resource.note)==null?void 0:e.map(({text:t})=>t))||[]}get partOf(){var e,t;return(t=(e=this.resource.partOf)==null?void 0:e[0])==null?void 0:t.display}get patientStatus(){var e;return K((e=this.builderPatientRxNormStatus)==null?void 0:e[this.rxNorm??""])}get rxNorm(){return J(this.resource,this.includedResources)}get rxNormCodeableConcept(){const e=M(this.resource,this.includedResources);return{...e??{},display:(e==null?void 0:e.display)??this.display}}get reason(){var e;return l((e=this.resource.reasonCode)==null?void 0:e[0])}get reasonReference(){return this.resource.reasonReference}get isArchived(){return!!this.getBasicResourceByAction("archive")}get isInactive(){return!["active","intended","unknown"].includes(this.status)}get status(){return this.resource.status}get displayStatus(){return this.isArchived?"Dismissed":W(this.resource.status)}get statusReason(){var e;return l((e=this.resource.statusReason)==null?void 0:e[0])}get subject(){return this.resource.subject}get subjectID(){var t;const[,e]=((t=this.resource.subject.reference)==null?void 0:t.split("/"))||[];return e||""}get patient(){const e=c("Patient",this.resource.contained,this.includedResources,this.resource.subject.reference);if(e)return new R(e,this.includedResources)}get lastFillDate(){var e,t;return d((t=(e=this.resource.extension)==null?void 0:e.find(s=>s.url===k))==null?void 0:t.valueDateTime)}get quantity(){var t,s;const e=(s=(t=this.resource.extension)==null?void 0:t.find(n=>n.url===X))==null?void 0:s.valueQuantity;if(e)return`${e.value} ${e.unit||""}`}get daysSupply(){var e,t,s,n;return(n=(s=(t=(e=this.resource.extension)==null?void 0:e.find(o=>o.url===z))==null?void 0:t.valueQuantity)==null?void 0:s.value)==null?void 0:n.toString()}get refills(){var e,t,s;return(s=(t=(e=this.resource.extension)==null?void 0:e.find(n=>n.url===G))==null?void 0:t.valueUnsignedInt)==null?void 0:s.toString()}get lastPrescriber(){var s,n;const e=(n=(s=this.resource.extension)==null?void 0:s.find(o=>o.url===Y))==null?void 0:n.valueReference;if(!(e!=null&&e.type)||!e.reference)return;const t=c(e.type,this.resource.contained,this.includedResources,e.reference);if(t!=null&&t.name){if(typeof t.name=="string")return t.name;const{family:o,given:a=[]}=t.name[0];return h([o,a[0]]).join(", ")}return e.display}get lastPrescribedDate(){var e,t;return d((t=(e=this.resource.extension)==null?void 0:e.find(s=>s.url===B))==null?void 0:t.valueDateTime)}}class ye extends f{get performer(){var r;return(r=I(this.resource,this.includedResources))==null?void 0:r.name}get status(){return this.resource.status}get dosage(){var r,e,t;switch(this.resource.resourceType){case"MedicationStatement":return(e=(r=this.resource.dosage)==null?void 0:r[0])==null?void 0:e.text;case"MedicationAdministration":return new ee(this.resource,this.includedResources).dosageDisplay;case"MedicationDispense":case"MedicationRequest":return l((t=this.resource.dosageInstruction)==null?void 0:t[0]);default:return""}}get date(){var r,e,t,s,n,o;switch(this.resource.resourceType){case"MedicationStatement":return this.resource.dateAsserted??((r=this.resource.effectivePeriod)==null?void 0:r.start);case"MedicationAdministration":return(e=this.resource.effectivePeriod)==null?void 0:e.start;case"MedicationDispense":return this.resource.whenHandedOver??this.resource.whenPrepared;case"MedicationRequest":return this.resource.authoredOn??((o=(n=(s=(t=this.resource.dosageInstruction)==null?void 0:t[0].timing)==null?void 0:s.repeat)==null?void 0:n.boundsPeriod)==null?void 0:o.start);default:return""}}get dateLocal(){return d(this.date)}get patient(){var e;const r=c("Patient",this.resource.contained,this.includedResources,(e=this.resource.subject)==null?void 0:e.reference);if(r)return new R(r,this.includedResources)}get prescriber(){switch(this.resource.resourceType){case"MedicationStatement":return new re(this.resource,this.includedResources).lastPrescriber;case"MedicationDispense":return new V(this.resource,this.includedResources).includedPerformer;case"MedicationRequest":return new te(this.resource,this.includedResources).includedRequester;default:return}}}function Se(i,r){const e=n=>o=>{const a=o[n];return!v(a)||!a?0:new Date(a).getTime()},t=[],s=[];return r.forEach(n=>{const{key:o,dir:a,isDate:u}=n;t.push(g=>U(g[o]),u?e(o):o),s.push("asc",a)}),E(i,t,s)}function Re(i,r,e,t=!1){const s=v(r)?T(r):r;return t?se(i,s,e):E(i,r,e)}function se(i,r,e){return i.sort((t,s)=>{const n=r(t),o=r(s);if(!n&&!o)return 0;if(!n)return e==="asc"?-1:1;if(!o)return e==="asc"?1:-1;const a=new Date(n).getTime(),u=new Date(o).getTime();return e==="asc"?a-u:u-a}),i}export{re as M,ye as a,te as b,V as c,ee as d,Se as e,J as g,me as r,Re as s};

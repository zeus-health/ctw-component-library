import{r as l,R as r}from"./index-6f814c40.js";import{c as M}from"./index-74f03c09.js";import{h as ce,i as ye,j as Ce,t as he,u as ve,f as we,s as le,d as ge,p as xe,e as ne}from"./requests-a8f87beb.js";import{$ as Ee,a0 as Pe,n as Te,a1 as _e,h as Ne,j as Se,k as Ae,C as ke,a as Ie,S as Re}from"./patient-allergies-537ec5b6.js";import"./_baseToString-5e23e5e6.js";import{c as re,a as Fe,T as De}from"./table-f396f8bf.js";import"./_baseClone-59dfd81b.js";import"./sortBy-7530ff7d.js";import"./_equalByTag-2573c09c.js";import"./_baseForOwn-0b302854.js";import"./_createSet-00935424.js";import{c as Oe}from"./_basePickBy-d4bc7435.js";import"./action-list-ada7e7df.js";import{h as de,i as $e,C as k,y as I,s as W,a as Y,$ as R,I as ue,o as $,S as ae,u as pe,M as H,e as He,b as w,O as N,T as g,v as Le,j as oe}from"./drawer-a8e46714.js";import"./spinner-66aa4ba7.js";import"./request-47bfd586.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-ccda-22e2b23d.js";import"./isEqual-1a694167.js";import"./_baseIsEqual-4482d138.js";import"./coding-list-1d7c950f.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./uniq-38208ea9.js";import"./_baseUniq-701deb29.js";import"./mapValues-3edfa6db.js";import"./data-list-254aa0b0.js";import"./isString-45b38206.js";import"./extends-298b405d.js";import"./index-6de6b113.js";import"./debounce-c94122dc.js";import"./toNumber-4334224f.js";import"./isPlainObject-d68c8411.js";function Me({onFocus:e}){let[t,n]=l.useState(!0);return t?r.createElement(de,{as:"button",type:"button",features:$e.Focusable,onFocus:a=>{a.preventDefault();let o,s=50;function i(){if(s--<=0){o&&cancelAnimationFrame(o);return}if(e()){n(!1),cancelAnimationFrame(o);return}o=requestAnimationFrame(i)}o=requestAnimationFrame(i)}}):null}var qe=(e=>(e[e.SetSelectedIndex=0]="SetSelectedIndex",e[e.RegisterTab=1]="RegisterTab",e[e.UnregisterTab=2]="UnregisterTab",e[e.RegisterPanel=3]="RegisterPanel",e[e.UnregisterPanel=4]="UnregisterPanel",e))(qe||{});let We={[0](e,t){let n=e.tabs.filter(s=>{var i;return!((i=s.current)!=null&&i.hasAttribute("disabled"))});if(t.index<0)return{...e,selectedIndex:e.tabs.indexOf(n[0])};if(t.index>e.tabs.length)return{...e,selectedIndex:e.tabs.indexOf(n[n.length-1])};let a=e.tabs.slice(0,t.index),o=[...e.tabs.slice(t.index),...a].find(s=>n.includes(s));return o?{...e,selectedIndex:e.tabs.indexOf(o)}:e},[1](e,t){var n;if(e.tabs.includes(t.tab))return e;let a=e.tabs[e.selectedIndex],o=oe([...e.tabs,t.tab],i=>i.current),s=(n=o.indexOf(a))!=null?n:e.selectedIndex;return s===-1&&(s=e.selectedIndex),{...e,tabs:o,selectedIndex:s}},[2](e,t){return{...e,tabs:e.tabs.filter(n=>n!==t.tab)}},[3](e,t){return e.panels.includes(t.panel)?e:{...e,panels:oe([...e.panels,t.panel],n=>n.current)}},[4](e,t){return{...e,panels:e.panels.filter(n=>n!==t.panel)}}},J=l.createContext(null);J.displayName="TabsSSRContext";function K(e){let t=l.useContext(J);if(t===null){let n=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,K),n}return t}let X=l.createContext(null);X.displayName="TabsDataContext";function S(e){let t=l.useContext(X);if(t===null){let n=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,S),n}return t}let Z=l.createContext(null);Z.displayName="TabsActionsContext";function ee(e){let t=l.useContext(Z);if(t===null){let n=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,ee),n}return t}function je(e,t){return pe(t.type,We,e,t)}let Ue=l.Fragment,Ve=k(function(e,t){let{defaultIndex:n=0,vertical:a=!1,manual:o=!1,onChange:s,selectedIndex:i=null,...d}=e;const C=a?"vertical":"horizontal",h=o?"manual":"auto";let b=i!==null,v=I(t),[m,u]=l.useReducer(je,{selectedIndex:i??n,tabs:[],panels:[]}),x=l.useMemo(()=>({selectedIndex:m.selectedIndex}),[m.selectedIndex]),p=W(s||(()=>{})),f=W(m.tabs),E=l.useMemo(()=>({orientation:C,activation:h,...m}),[C,h,m]),T=W(b?e.selectedIndex:m.selectedIndex),_=l.useMemo(()=>({registerTab(y){return u({type:1,tab:y}),()=>u({type:2,tab:y})},registerPanel(y){return u({type:3,panel:y}),()=>u({type:4,panel:y})},change(y){T.current!==y&&p.current(y),b||u({type:0,index:y})}}),[u,b]);Y(()=>{u({type:0,index:i??n})},[i]);let A=l.useRef({tabs:[],panels:[]}),q={ref:v};return r.createElement(J.Provider,{value:A},r.createElement(Z.Provider,{value:_},r.createElement(X.Provider,{value:E},E.tabs.length<=0&&r.createElement(Me,{onFocus:()=>{var y,F;for(let D of f.current)if(((y=D.current)==null?void 0:y.tabIndex)===0)return(F=D.current)==null||F.focus(),!0;return!1}}),R({ourProps:q,theirProps:d,slot:x,defaultTag:Ue,name:"Tabs"}))))}),Be="div",Ge=k(function(e,t){let{orientation:n,selectedIndex:a}=S("Tab.List"),o=I(t);return R({ourProps:{ref:o,role:"tablist","aria-orientation":n},theirProps:e,slot:{selectedIndex:a},defaultTag:Be,name:"Tabs.List"})}),ze="button",Qe=k(function(e,t){var n,a;let o=`headlessui-tabs-tab-${ue()}`,{orientation:s,activation:i,selectedIndex:d,tabs:C,panels:h}=S("Tab"),b=ee("Tab"),v=S("Tab"),m=K("Tab"),u=l.useRef(null),x=I(u,t);Y(()=>b.registerTab(u),[b,u]);let p=m.current.tabs.indexOf(o);p===-1&&(p=m.current.tabs.push(o)-1);let f=C.indexOf(u);f===-1&&(f=p);let E=f===d,T=$(c=>{var P;let O=c();if(O===H.Success&&i==="auto"){let fe=(P=He(u))==null?void 0:P.activeElement,te=v.tabs.findIndex(be=>be.current===fe);te!==-1&&b.change(te)}return O}),_=$(c=>{let P=C.map(O=>O.current).filter(Boolean);if(c.key===w.Space||c.key===w.Enter){c.preventDefault(),c.stopPropagation(),b.change(f);return}switch(c.key){case w.Home:case w.PageUp:return c.preventDefault(),c.stopPropagation(),T(()=>N(P,g.First));case w.End:case w.PageDown:return c.preventDefault(),c.stopPropagation(),T(()=>N(P,g.Last))}if(T(()=>pe(s,{vertical(){return c.key===w.ArrowUp?N(P,g.Previous|g.WrapAround):c.key===w.ArrowDown?N(P,g.Next|g.WrapAround):H.Error},horizontal(){return c.key===w.ArrowLeft?N(P,g.Previous|g.WrapAround):c.key===w.ArrowRight?N(P,g.Next|g.WrapAround):H.Error}}))===H.Success)return c.preventDefault()}),A=l.useRef(!1),q=$(()=>{var c;A.current||(A.current=!0,(c=u.current)==null||c.focus(),b.change(f),Le(()=>{A.current=!1}))}),y=$(c=>{c.preventDefault()}),F=l.useMemo(()=>({selected:E}),[E]),D=e,me={ref:x,onKeyDown:_,onMouseDown:y,onClick:q,id:o,role:"tab",type:Ee(e,u),"aria-controls":(a=(n=h[f])==null?void 0:n.current)==null?void 0:a.id,"aria-selected":E,tabIndex:E?0:-1};return R({ourProps:me,theirProps:D,slot:F,defaultTag:ze,name:"Tabs.Tab"})}),Ye="div",Je=k(function(e,t){let{selectedIndex:n}=S("Tab.Panels"),a=I(t),o=l.useMemo(()=>({selectedIndex:n}),[n]);return R({ourProps:{ref:a},theirProps:e,slot:o,defaultTag:Ye,name:"Tabs.Panels"})}),Ke="div",Xe=ae.RenderStrategy|ae.Static,Ze=k(function(e,t){var n,a,o,s;let{selectedIndex:i,tabs:d,panels:C}=S("Tab.Panel"),h=ee("Tab.Panel"),b=K("Tab.Panel"),v=`headlessui-tabs-panel-${ue()}`,m=l.useRef(null),u=I(m,t);Y(()=>h.registerPanel(m),[h,m]);let x=b.current.panels.indexOf(v);x===-1&&(x=b.current.panels.push(v)-1);let p=C.indexOf(m);p===-1&&(p=x);let f=p===i,E=l.useMemo(()=>({selected:f}),[f]),T=e,_={ref:u,id:v,role:"tabpanel","aria-labelledby":(a=(n=d[p])==null?void 0:n.current)==null?void 0:a.id,tabIndex:f?0:-1};return!f&&((o=e.unmount)==null||o)&&!((s=e.static)!=null&&s)?r.createElement(de,{as:"span",..._}):R({ourProps:_,theirProps:T,slot:E,defaultTag:Ke,features:Xe,visible:f,name:"Tabs.Panel"})}),L=Object.assign(Qe,{Group:Ve,List:Ge,Panels:Je,Panel:Ze});function V({hideAdd:e,onToggleShowHistoric:t}){const n=ce();return r.createElement("div",{className:"ctw-flex ctw-items-center ctw-justify-end ctw-space-x-2 ctw-p-3"},r.createElement(Pe,{name:"historic",text:"Historic",onChange:t}),!e&&r.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:()=>n()},"Add Condition"))}try{V.displayName="PatientConditionsActions",V.__docgenInfo={description:"",displayName:"PatientConditionsActions",props:{hideAdd:{defaultValue:null,description:"",name:"hideAdd",required:!0,type:{name:"boolean"}},onToggleShowHistoric:{defaultValue:null,description:"",name:"onToggleShowHistoric",required:!0,type:{name:"() => void"}}}}}catch{}function et(e){switch(e){case"Active":return"ctw-text-success-main";case"Pending":return"ctw-text-caution-main";default:return"ctw-text-content-lighter"}}const tt=[{widthPercent:30,minWidth:320,render:e=>r.createElement("div",null,r.createElement("div",{className:"ctw-pc-title group-hover:ctw-underline"},e.display),r.createElement("div",{className:"ctw-pc-chapter"},e.ccsChapter))},{render:e=>{var t,n;return r.createElement("div",{className:"ctw-pc-status-container"},r.createElement("div",{className:M("ctw-pc-status-dot",et(e.displayStatus))},"â€¢"),r.createElement("div",{className:"ctw-pc-status-and-extra"},r.createElement("div",{className:"ctw-pc-status"},e.displayStatus),e.isSummaryResource?r.createElement("div",null,re([(n=(t=e.patient)==null?void 0:t.organization)==null?void 0:n.name,e.recordedDate]).join(" ")):r.createElement("div",null,re([e.recorder,e.recordedDate]).join(" "))))},widthPercent:30,minWidth:128},{widthPercent:40,minWidth:132,render:e=>{const t=e.isSummaryResource?"Earliest known onset:":"Onset:";return r.createElement("div",{className:"ctw-pc-onset-notes"},e.onset&&r.createElement("div",null,t," ",e.onset),r.createElement("div",{className:"ctw-pc-notes"},e.notes.join(" ")))}}];function nt(){const[e,t]=l.useState({collection:"patient",showHistoric:!1});function n(o){t(Fe(Oe(e),o))}function a(o,s){return(e.collection==="patient"?o:s).filter(d=>e.showHistoric?!0:["Active","Pending"].includes(d.displayStatus))}return{filters:e,updateFilters:n,applyFilters:a}}const B=({record:e})=>{const t=ye(),n=Ce();return r.createElement("div",{className:"ctw-flex ctw-space-x-2"},!e.isDeleted&&r.createElement("button",{type:"button",className:"ctw-btn-default",onClick:a=>{a.stopPropagation(),n(e)}},"Remove"),r.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:a=>{a.stopPropagation(),t(e)}},"Edit"))},G=({record:e})=>{const t=ce(),{getRequestContext:n}=Te();return r.createElement("div",{className:"ctw-flex ctw-space-x-2"},r.createElement("button",{type:"button",className:"ctw-btn-default",onClick:async a=>{a.stopPropagation(),await he(e,await n())}},e.isArchived?"Restore":"Dismiss"),r.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:a=>{a.stopPropagation(),t(e)}},"Add"))};try{B.displayName="PatientConditionHoverActions",B.__docgenInfo={description:"",displayName:"PatientConditionHoverActions",props:{record:{defaultValue:null,description:"",name:"record",required:!0,type:{name:"ConditionModel"}}}}}catch{}try{G.displayName="OtherProviderConditionHoverActions",G.__docgenInfo={description:"",displayName:"OtherProviderConditionHoverActions",props:{record:{defaultValue:null,description:"",name:"record",required:!0,type:{name:"ConditionModel"}}}}}catch{}function z({collection:e,otherConditions:t,onCollectionChange:n}){function a(d){return e===d?"ctw-text-content-black":"ctw-text-content-light"}const o=t.filter(d=>d.displayStatus==="Active").length;function s(){typeof document<"u"&&requestAnimationFrame(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()})}const i="ctw-relative ctw-tab-underline ctw-tab";return r.createElement("div",{className:"ctw-justify-end ctw-space-x-2 ctw-border-0 ctw-border-b ctw-border-t ctw-border-solid ctw-border-divider-light"},r.createElement("div",{className:"ctw-space-x-4"},r.createElement(L.Group,{onChange:d=>{n(d===0?"patient":"other")}},r.createElement(L.List,{className:"ctw-mt-3"},r.createElement(L,{onClick:s,className:({selected:d})=>M(a("patient"),i,{"ctw-tab-underline-selected":d})},"Condition List"),r.createElement(L,{onClick:s,className:({selected:d})=>M(a("other"),i,"ctw-space-x-2",{"ctw-tab-underline-selected":d})},r.createElement("span",null,"Other Provider Records"),r.createElement(_e,{text:`${o}`,color:"primary"}))))))}try{z.displayName="PatientConditionsTabs",z.__docgenInfo={description:"",displayName:"PatientConditionsTabs",props:{collection:{defaultValue:null,description:"",name:"collection",required:!0,type:{name:"enum",value:[{value:'"patient"'},{value:'"other"'}]}},otherConditions:{defaultValue:null,description:"",name:"otherConditions",required:!0,type:{name:"ConditionModel[]"}},onCollectionChange:{defaultValue:null,description:"",name:"onCollectionChange",required:!0,type:{name:"(collection: FilterCollection) => void"}}}}}catch{}function Q({className:e,readOnly:t=!1}){const{filters:n,updateFilters:a,applyFilters:o}=nt(),s=l.useRef(null),i=Ne(s),d=ve(),C=Se(),h=Ae();function b(){const p=C.isLoading,f=p||h.isLoading;return n.collection==="patient"?p:f}const v=C.data??[],m=we(h.data??[],v,!0),u=o(v,m),x=n.collection==="patient"?B:G;return r.createElement("div",{ref:s,className:M("ctw-patient-conditions",e,{"ctw-patient-conditions-stacked":i.sm})},r.createElement("div",{className:"ctw-items-center ctw-justify-between ctw-py-5"},r.createElement("div",{className:"ctw-ml-3 ctw-text-xl ctw-font-medium ctw-text-content-black"},"Conditions"),r.createElement(z,{otherConditions:m,collection:n.collection,onCollectionChange:p=>a({collection:p})}),r.createElement(V,{hideAdd:t||n.collection==="other",onToggleShowHistoric:()=>a({showHistoric:!n.showHistoric})}),r.createElement(De,{stacked:i.sm,className:"-ctw-mx-px !ctw-rounded-none",showTableHead:!1,emptyMessage:"There are no condition records available.",isLoading:b(),records:u,RowActions:t?void 0:x,columns:tt,handleRowClick:p=>d({condition:p,readOnly:t||p.isSummaryResource})})))}try{Q.displayName="PatientConditions",Q.__docgenInfo={description:"",displayName:"PatientConditions",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},readOnly:{defaultValue:{value:"false"},description:"",name:"readOnly",required:!1,type:{name:"boolean"}}}}}catch{}const Ot={component:Q,tags:["autodocs"],argTypes:{className:{options:["Blank","Fixed Width"],control:"select",mapping:{Blank:"","Fixed Width":"ctw-m-auto ctw-max-w-[600px]"}}},args:{className:"Blank",readOnly:!1},decorators:[(e,{args:t})=>r.createElement(ke,{env:"dev",authToken:"dummy-token",builderId:"b123"},r.createElement(Ie,{patientID:"u12345",systemURL:Re},r.createElement(e,{args:t})))]},j={...le({otherConditions:ge,patientConditions:xe})},U={...le({otherConditions:ne,patientConditions:ne})};var ie;j.parameters={...j.parameters,storySource:{source:`{
  ...setupConditionMocks({
    otherConditions,
    patientConditions
  })
}`,...(ie=j.parameters)==null?void 0:ie.storySource}};var se;U.parameters={...U.parameters,storySource:{source:`{
  ...setupConditionMocks({
    otherConditions: emptyConditions,
    patientConditions: emptyConditions
  })
}`,...(se=U.parameters)==null?void 0:se.storySource}};const $t=["Basic","Empty"];export{j as Basic,U as Empty,$t as __namedExportsOrder,Ot as default};
//# sourceMappingURL=patient-conditions.stories-80bc2317.js.map

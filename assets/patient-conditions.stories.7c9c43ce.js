import{r as d,R as t}from"./index.9f56b196.js";import{c as A}from"./index.d3b8680b.js";import{l as u,T as $}from"./table.e8870acf.js";import{u as S,c as q,g as Y,d as F,e as B,T as z,D as M,f as P,h as K,i as V,j as L,r as Z,Q as G,B as J,k as X,m as ee,n as te,o as ne,p as oe,q as ae,s as ie,M as se,t as re,a as ce,P as de,S as le}from"./index.4267a3f8.js";import"./action-list.8d2557fc.js";import{q as pe}from"./index.7dcc3bb2.js";import{s as ue,o as me,p as we}from"./requests.bfaeaccb.js";import"./_commonjsHelpers.712cc82f.js";import"./spinner.51ecf2bb.js";import"./extends.bed14d96.js";import"./drawer.0ebe46ba.js";import"./index.f2b75861.js";import"./data-list.6d7c3503.js";function he(e,n){return d.exports.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:n},e),d.exports.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"}))}const Ce=d.exports.forwardRef(he),fe=Ce;function v({hideAdd:e,onToggleShowHistoric:n}){var c,p;const a=(p=(c=S().data)==null?void 0:c.id)!=null?p:"",[i,s]=d.exports.useState(!1),l=new q(Y(a)),m=F({condition:l}),h=u.exports.curry(B)(l,a);return t.createElement("div",{className:"ctw-flex ctw-items-center ctw-justify-end ctw-space-x-2 ctw-border-0 ctw-border-t ctw-border-solid ctw-border-divider-light ctw-py-5 ctw-px-4"},t.createElement(z,{name:"historic",text:"Show Historic",onChange:n}),!e&&t.createElement("button",{type:"button",className:"ctw-btn-icon",onClick:()=>s(!0)},t.createElement(fe,{className:"ctw-h-4 ctw-w-4"})),t.createElement(M,{title:"Add Condition",action:h,data:m,schema:P,isOpen:i,onClose:()=>s(!1)}))}const ye=(e,n)=>{const o=K(e.resource);n({drawerIsOpen:!0,actionType:"Add",schema:P,data:F({condition:new q(o)})})},Ee=(e,n,o)=>{o({drawerIsOpen:!0,actionType:"Edit",schema:V,data:L({condition:e})}),n(e)},ge=(e,n,o)=>{o(!0),n(e)},ve=async(e,n)=>{const o=await n(),a=e.getBasicResourceByAction("archive")||e.getBasicResourceByAction("unarchive"),i=e.isArchived?"unarchive":"archive";await Z(a,e,o,i),await pe.invalidateQueries([G])};try{v.displayName="PatientConditionsActions",v.__docgenInfo={description:"",displayName:"PatientConditionsActions",props:{hideAdd:{defaultValue:null,description:"",name:"hideAdd",required:!0,type:{name:"boolean"}},onToggleShowHistoric:{defaultValue:null,description:"",name:"onToggleShowHistoric",required:!0,type:{name:"() => void"}}}}}catch{}function xe(e){switch(e){case"Active":return"ctw-text-success-main";case"Pending":return"ctw-text-caution-main";default:return"ctw-text-content-lighter"}}const _e=[{widthPercent:30,minWidth:320,render:e=>t.createElement("div",null,t.createElement("div",{className:"ctw-pc-title group-hover:ctw-underline"},e.display),t.createElement("div",{className:"ctw-pc-chapter"},e.ccsChapter))},{render:e=>{var n,o;return t.createElement("div",{className:"ctw-pc-status-container"},t.createElement("div",{className:A("ctw-pc-status-dot",xe(e.status))},"\u2022"),t.createElement("div",{className:"ctw-pc-status-and-extra"},t.createElement("div",{className:"ctw-pc-status"},e.status),e.isSummaryResource?t.createElement("div",null,u.exports.compact([(o=(n=e.patient)==null?void 0:n.organization)==null?void 0:o.name,e.recordedDate]).join(" ")):t.createElement("div",null,u.exports.compact([e.recorder,e.recordedDate]).join(" "))))},widthPercent:30,minWidth:128},{widthPercent:40,minWidth:132,render:e=>{const n=e.isSummaryResource?"Earliest known onset:":"Onset:";return t.createElement("div",{className:"ctw-pc-onset-notes"},e.onset&&t.createElement("div",null,n," ",e.onset),t.createElement("div",{className:"ctw-pc-notes"},e.notes.join(" ")))}}];function Ne(){const[e,n]=d.exports.useState({collection:"patient",showHistoric:!1});function o(i){n(u.exports.merge(u.exports.cloneDeep(e),i))}function a(i,s){return(e.collection==="patient"?i:s).filter(m=>e.showHistoric?!0:["Active","Pending"].includes(m.status))}return{filters:e,updateFilters:o,applyFilters:a}}function x({collection:e,otherConditions:n,onCollectionChange:o}){function a(s){return e===s?"ctw-btn-primary":"ctw-btn-default"}const i=n.filter(s=>s.status==="Active").length;return t.createElement("div",{className:"ctw-flex ctw-items-center ctw-justify-between ctw-py-5 ctw-px-4"},t.createElement("div",{className:"ctw-text-xl ctw-font-medium ctw-text-content-black"},"Conditions"),t.createElement("div",{className:"ctw-space-x-2"},t.createElement("button",{type:"button",className:a("patient"),onClick:()=>o("patient")},"Patient Record"),t.createElement("button",{type:"button",className:A(a("other"),"ctw-space-x-2"),onClick:()=>o("other")},t.createElement("span",null,"Other Provider Records"),t.createElement(J,{text:`${i}`,color:"gray"}))))}try{x.displayName="PatientConditionsHeader",x.__docgenInfo={description:"",displayName:"PatientConditionsHeader",props:{collection:{defaultValue:null,description:"",name:"collection",required:!0,type:{name:"enum",value:[{value:'"patient"'},{value:'"other"'}]}},otherConditions:{defaultValue:null,description:"",name:"otherConditions",required:!0,type:{name:"ConditionModel[]"}},onCollectionChange:{defaultValue:null,description:"",name:"onCollectionChange",required:!0,type:{name:"(collection: FilterCollection) => void"}}}}}catch{}const _=({data:e,patientRecords:n,handleEditCondition:o})=>{if(e&&n.some(a=>a.id===e.id))return()=>o(e)},Ae=(e,n,o)=>{e(!0),n(o)};try{_.displayName="createHandleEditCondition",_.__docgenInfo={description:"",displayName:"createHandleEditCondition",props:{data:{defaultValue:null,description:"",name:"data",required:!1,type:{name:"ConditionModel"}},patientRecords:{defaultValue:null,description:"",name:"patientRecords",required:!0,type:{name:"ConditionModel[]"}},handleEditCondition:{defaultValue:null,description:"",name:"handleEditCondition",required:!0,type:{name:"(data: ConditionModel) => void"}}}}}catch{}const Pe=(e,n,o,a,i,s)=>{switch(e){case"patient":return be(n,o,a,i);case"other":return Oe(n,a,s);default:throw Error(`${e} is not in the FilterCollection type`)}},be=(e,n,o,a)=>t.createElement("div",{className:"ctw-flex ctw-space-x-2"},t.createElement("button",{type:"button",className:"ctw-btn-default",onClick:i=>{i.stopPropagation(),ge(e,n,a)}},"Remove"),t.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:i=>{i.stopPropagation(),Ee(e,n,o)}},"Edit")),Oe=(e,n,o)=>{const{isArchived:a}=e,i=a?"Un-Archive":"Archive";return t.createElement("div",{className:"ctw-flex ctw-space-x-2"},t.createElement("button",{type:"button",className:"ctw-btn-default",onClick:async s=>{s.stopPropagation(),await ve(e,o)}},i),t.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:s=>{s.stopPropagation(),ye(e,n)}},"Add"))},Re={schema:P,actionType:"Add",data:void 0,drawerIsOpen:!1};function N({className:e,readOnly:n=!1}){var T,H;const{filters:o,updateFilters:a,applyFilters:i}=Ne(),s=d.exports.useRef(null),l=X(s),[m,h]=d.exports.useState(!1),[c,p]=d.exports.useState(),[W,b]=d.exports.useState(!1),[w,f]=d.exports.useReducer((r,E)=>({...r,...E}),Re),O=ee(),R=te(),C=S(),{getRequestContext:D}=ne();function j(){const r=O.isLoading,E=r||R.isLoading;return o.collection==="patient"?r:E}const y=(T=O.data)!=null?T:[],k=oe((H=R.data)!=null?H:[],y,!0),Q=i(y,k),U=r=>{C.data&&(f({actionType:"Edit",schema:V,data:L({condition:r}),drawerIsOpen:!0}),p(r))};return t.createElement("div",{ref:s,className:A("ctw-patient-conditions",e,{"ctw-patient-conditions-stacked":l.sm})},t.createElement(x,{otherConditions:k,collection:o.collection,onCollectionChange:r=>a({collection:r})}),t.createElement(v,{hideAdd:n||o.collection==="other",onToggleShowHistoric:()=>a({showHistoric:!o.showHistoric})}),t.createElement($,{stacked:l.sm,className:"-ctw-mx-px !ctw-rounded-none",showTableHead:!1,isLoading:j(),records:Q,rowActions:r=>Pe(o.collection,r,p,f,b,D),columns:_e,handleRowClick:r=>Ae(h,p,r)}),t.createElement(ae,{isOpen:m,onClose:()=>h(!1),condition:c,onEdit:_({data:c,patientRecords:y,handleEditCondition:U})}),C.data&&t.createElement(M,{title:`${w.actionType} Condition`,header:w.actionType==="Edit"&&c&&t.createElement(ie,{condition:c}),action:u.exports.curry(B)(c,C.data.id),data:w.data,schema:w.schema,isOpen:w.drawerIsOpen,onClose:()=>f({drawerIsOpen:!1})}),c&&C.data&&t.createElement(se,{resource:c,resourceName:c.display||"unnamed condition",onClose:()=>b(!1),isOpen:W,onDelete:async()=>{const r=await D();await re(c.resource,r)}}))}try{N.displayName="PatientConditions",N.__docgenInfo={description:"",displayName:"PatientConditions",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},readOnly:{defaultValue:{value:"false"},description:"",name:"readOnly",required:!1,type:{name:"boolean"}}}}}catch{}const je={component:N,tags:["docsPage"],argTypes:{className:{options:["Blank","Fixed Width"],control:"select",mapping:{Blank:"","Fixed Width":"ctw-m-auto ctw-max-w-[600px]"}}},args:{className:"Blank",readOnly:!1},decorators:[(e,{args:n})=>t.createElement(ce,{env:"dev",authToken:"dummy-token",builderId:"b123"},t.createElement(de,{patientID:"u12345",systemURL:le},t.createElement(e,{args:n})))]},g={...ue({otherConditions:me,patientConditions:we})};var I;g.parameters={...g.parameters,storySource:{source:`{
  ...setupConditionMocks({
    otherConditions,
    patientConditions
  })
}`,...(I=g.parameters)==null?void 0:I.storySource}};const Qe=["Basic"];export{g as Basic,Qe as __namedExportsOrder,je as default};
//# sourceMappingURL=patient-conditions.stories.7c9c43ce.js.map

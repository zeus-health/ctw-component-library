var R=Object.defineProperty;var I=(e,t,r)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var u=(e,t,r)=>(I(e,typeof t!="symbol"?t+"":t,r),r);import{R as a,r as c}from"./index-6f814c40.js";import{c as l}from"./index-74f03c09.js";import{g as C,h as q,i as L,u as A,j as V,k as M,T as B,Q as z,w as D,l as F,H as U,R as $,C as Q,a as W,S as Y}from"./patient-allergies-eb611e68.js";import"./_baseForOwn-6ce43847.js";import"./uniqWith-18747e2c.js";import{c as j,T as O}from"./table-5553b582.js";import"./_baseClone-7e8cfb08.js";import"./_baseIsEqual-2f71925b.js";import{u as K}from"./uniq-41de9089.js";import"./_baseUniq-cf39c5a7.js";import"./action-list-a695328d.js";import"./request-02bc8afe.js";import"./drawer-3e903764.js";import"./spinner-66aa4ba7.js";import{s as Z}from"./requests-86988863.js";import"./_commonjsHelpers-042e6b4d.js";import"./extends-866f950d.js";import"./_basePickBy-a6d7916f.js";import"./toNumber-6e4e7434.js";import"./index-d206d595.js";import"./mapValues-dc8f3697.js";import"./index-6de6b113.js";import"./debounce-5d5a9f7a.js";import"./data-list-254aa0b0.js";import"./isEqual-dc54df64.js";import"./isPlainObject-f4e3af75.js";import"./index-135b3e83.js";function G(){const e=[];return e.push({key:"status",type:"select",icon:C,values:["initialize",{key:"in_progress",name:"in progress"},"error","done",{key:"done_with_errors",name:"done with errors "}],display:"status"}),e}class J{constructor(t,r){u(this,"kind","PatientHistory");u(this,"historyInfo");u(this,"patient");this.patient=t,this.historyInfo=r}get providers(){var t;return(t=this.historyInfo)==null?void 0:t.attributes.providers}get key(){var t;return((t=this.historyInfo)==null?void 0:t.id)||""}get lastRetrievedAt(){var t;return q((t=this.historyInfo)==null?void 0:t.attributes.createdAt)}get createdAt(){var t;if((t=this.historyInfo)!=null&&t.attributes.createdAt)return L(new Date(Number(this.historyInfo.attributes.createdAt)*1e3),"M/d/yy h:mm a")}}function X(e,t,r){return A(z,[e,t,r],async i=>{try{const s=await V({requestContext:i,count:e,offset:t,status:r}),m=K(j(s.data.map(n=>n.relationships.patient.data.id)));if(!m.length)return{total:0,patients:[]};const w=await M(i,void 0,m),d=s.data.map(n=>{const p=w.patients.filter(o=>o.id===n.relationships.patient.data.id);return new J(p[0],n)});return{hasNext:!!s.links.next,total:s.data.length,patients:d}}catch(s){throw B.logError(s,"Failed fetching patient history patients."),new Error(`Failed fetching patient history patients: ${s}`)}})}const v=({setCurrentPage:e,currentPage:t,hasNext:r})=>a.createElement("div",{className:"ctw-simple-pagination ctw-flex ctw-justify-end ctw-space-x-3 ctw-px-6 ctw-py-3","data-zus-telemetry-namespace":"Pagination"},a.createElement(P,{pageToNavigateTo:t-1,setCurrentPage:e,className:l({"ctw-invisible":t===1})},"Prev"),a.createElement(P,{pageToNavigateTo:t+1,setCurrentPage:e,className:l({"ctw-invisible":!r})},"Next")),P=({pageToNavigateTo:e,setCurrentPage:t,children:r,className:i})=>a.createElement("button",{type:"button",className:l("ctw-btn-default",i),"data-zus-telemetry-click":"paginate",onClick:()=>t(e)},r);try{v.displayName="SimplePagination",v.__docgenInfo={description:"",displayName:"SimplePagination",props:{currentPage:{defaultValue:null,description:"",name:"currentPage",required:!0,type:{name:"number"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!1,type:{name:"boolean"}},setCurrentPage:{defaultValue:null,description:"",name:"setCurrentPage",required:!0,type:{name:"(n: number) => void"}},hasNext:{defaultValue:null,description:"",name:"hasNext",required:!1,type:{name:"boolean"}}}}}catch{}const N=D(({className:e,handleRowClick:t,pageSize:r=10,title:i="Patient History Request"})=>{const[s,m]=c.useState(1),[w,d]=c.useState([]),[n,p]=c.useState(),{data:{patients:o,total:S,hasNext:k}={},isFetching:g,isError:h}=X(r,s-1,n),H=E=>{var _;(_=E.status)!=null&&_.selected&&typeof E.status.selected=="string"?p(E.status.selected.split(" ").join("_")):p(void 0)};return c.useEffect(()=>{!g&&o&&d(o)},[o,S,h,g]),c.useEffect(()=>{h&&d([])},[h,g]),a.createElement(F,{className:l("ctw-patients-table",e),"data-zus-telemetry-namespace":"PatientsTable"},a.createElement(U,{title:i}),a.createElement($,{filterOptions:{onChange:H,filters:G()}}),a.createElement("div",{className:"ctw-overflow-hidden"},a.createElement(O,{records:w,columns:ee,pageSize:r,handleRowClick:t,hidePagination:!0},a.createElement(v,{currentPage:s,setCurrentPage:m,hasNext:k}))))},"PatientsHistoryTable"),ee=[{title:"Last Queried",render:e=>a.createElement("div",null,e.createdAt)},{title:"Name",render:e=>a.createElement(te,{data:e})},{title:"Source",render:e=>{var t;return a.createElement("div",{className:"ctw-space-y-2"},(t=e.providers)==null?void 0:t.map(r=>{var i;return a.createElement("div",{key:`${(i=e.historyInfo)==null?void 0:i.id}-${r.service}`},a.createElement("div",{className:"ctw-w-fit ctw-px-3 ctw-py-1	ctw-capitalize"},ae(r.service)))}))}},{title:"Status",render:e=>{var t;return a.createElement("div",{className:"ctw-space-y-2"},(t=e.providers)==null?void 0:t.map(r=>a.createElement("div",{key:`${e.key}-${r.service}`},a.createElement("div",{className:"ctw-capitalize"},a.createElement(re,{status:r.status})))))}}],te=({data:e})=>a.createElement("div",{className:"ctw-flex ctw-items-center"},a.createElement("div",null,a.createElement("div",{className:"ctw-flex ctw-space-x-1 ctw-font-medium"},a.createElement("div",{className:"ctw-max-w-xs"},e.patient.fullName),e.patient.resource.gender&&a.createElement("div",{className:"ctw-uppercase"},"(",e.patient.resource.gender[0],")")),a.createElement("div",{className:"ctw-text-content-lighter"},e.patient.dob," (",e.patient.age,")"))),ae=e=>{switch(e.toLowerCase()){case"commonwell":return"EHR Network";case"surescripts":return"Medication History";default:return e}},re=({status:e})=>{switch(e){case"initialize":case"in_progress":return a.createElement(y,{status:e,className:"ctw-bg-caution-light ctw-text-caution-heading"});case"done":return a.createElement(y,{status:e,className:"ctw-bg-success-light ctw-text-success-dark"});case"error":case"done_with_errors":return a.createElement(y,{status:e,className:"ctw-bg-error-light ctw-text-error-text"});default:return a.createElement(y,{status:e})}},y=({status:e,className:t})=>a.createElement("div",{className:l("ctw-w-fit ctw-rounded-xl ctw-px-3	ctw-py-1",t)},e.split("_").join(" "));try{N.displayName="PatientHistoryTable",N.__docgenInfo={description:"",displayName:"PatientHistoryTable",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"Argument"}},handleRowClick:{defaultValue:null,description:"",name:"handleRowClick",required:!1,type:{name:"((row: PatientHistoryRequestModel) => void)"}},pageSize:{defaultValue:null,description:"",name:"pageSize",required:!1,type:{name:"number"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},getRowClasses:{defaultValue:null,description:"",name:"getRowClasses",required:!1,type:{name:"((row: PatientModel) => Argument)"}},onRowClick:{defaultValue:null,description:"",name:"onRowClick",required:!1,type:{name:"((row: PatientModel) => void)"}}}}}catch{}const Ce={component:N,tags:["autodocs"],args:{},decorators:[(e,{args:t})=>a.createElement(Q,{env:"dev",authToken:"dummy-token",builderId:"b123"},a.createElement(W,{patientID:"u12345",systemURL:Y},a.createElement(e,{args:t})))]},f={...Z()};var b,T,x;f.parameters={...f.parameters,docs:{...(b=f.parameters)==null?void 0:b.docs,source:{originalSource:`{
  ...setupPatientHistoryMocks()
}`,...(x=(T=f.parameters)==null?void 0:T.docs)==null?void 0:x.source}}};const qe=["Basic"];export{f as Basic,qe as __namedExportsOrder,Ce as default};

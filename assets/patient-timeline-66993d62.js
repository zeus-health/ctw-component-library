import{R as a}from"./index-6f814c40.js";import{c as b}from"./index-74f03c09.js";import{u as D}from"./resource-details-drawer-3fe435d7.js";import{V as T}from"./view-fhir-54e8d253.js";import{C as N}from"./coding-list-1d7c950f.js";import{F as P,c as _,a as C,w as S,a7 as I,s as L,T as R,a8 as M,u as U}from"./patient-helper-b0cbc320.js";import{T as V}from"./table-be835e20.js";import{i as q}from"./null-flavor-28785e40.js";import"./_baseToString-4993715b.js";import{c as p,o as F}from"./sortBy-be5f7eb4.js";import"./_baseClone-25b1595e.js";import"./sortBy-919d7262.js";import"./_equalByTag-aaf39779.js";import{f as W,d as x}from"./values-0b6ffb91.js";import"./_baseForOwn-d8306f34.js";import"./_createSet-12ef9b81.js";import{u as $}from"./patient-provider-c19758d6.js";const u=({className:r,items:t,limit:e,total:i})=>a.createElement("div",{className:r},t.slice(0,e).map((s,n)=>a.createElement("div",{key:s+n},a.createElement("div",null,s))),i>e&&a.createElement("div",{className:"ctw-font-medium"},"+ ",i-e," more"));try{u.displayName="SimpleMoreList",u.__docgenInfo={description:"",displayName:"SimpleMoreList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"string[]"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},total:{defaultValue:null,description:"",name:"total",required:!0,type:{name:"number"}}}}}catch{}const y=(r=!1)=>{const t=[{title:"Date",widthPercent:10,minWidth:120,render:e=>a.createElement("div",{className:"group-hover:ctw-underline"},e.periodStart)},{title:"Type",widthPercent:20,minWidth:150,render:e=>a.createElement("div",null,a.createElement("div",null,"Encounter"),a.createElement("div",null,e.typeDisplay))},{title:"Provider",widthPercent:25,minWidth:200,render:e=>{const{participant:i}=e.resource;if(!i||i.length===0)return null;const s=i.map(n=>{var c,d;const o=((c=n.individual)==null?void 0:c.display)??"";let l=((d=n.type)==null?void 0:d[0].text)??"";return["noinformation","unk"].includes(l.toLowerCase())&&(l=""),o&&l?`${o} (${l})`:o||l});return a.createElement("div",null,a.createElement(u,{items:s,limit:6,total:i.length}),a.createElement("div",null,e.location))}},{widthPercent:45,minWidth:250,render:e=>{const{diagnosis:i}=e.resource;return!i||i.length===0?null:a.createElement("div",null,a.createElement(u,{items:i.map(s=>s.condition.display??""),limit:3,total:i.length}))}}];return r&&t.push({widthPercent:10,minWidth:200,render:e=>a.createElement(T,{name:"Encounter Resource",resource:e.resource})}),t};try{y.displayName="patientTimelineColumns",y.__docgenInfo={description:"",displayName:"patientTimelineColumns",props:{}}}catch{}class j extends P{get class(){const{display:t,code:e}=this.resource.class;return t??e!=="UNK"?e:void 0}get diagnosis(){var e;const t=p((e=this.resource.diagnosis)==null?void 0:e.map(i=>i.condition.display));return t.length?t.join(", "):void 0}get dischargeDisposition(){var t;return _((t=this.resource.hospitalization)==null?void 0:t.dischargeDisposition)}get location(){var e;const t=p((e=this.resource.location)==null?void 0:e.map(i=>i.location.display));return t.length?t.join(", "):void 0}get participants(){var e;const t=p((e=this.resource.participant)==null?void 0:e.map(i=>{var s;return(s=i.individual)==null?void 0:s.display}));return t.length?t.join(", "):void 0}get periodEnd(){var t;return C((t=this.resource.period)==null?void 0:t.end)}get periodStart(){var t;return C((t=this.resource.period)==null?void 0:t.start)}get reason(){var e;const t=p((e=this.resource.reasonCode)==null?void 0:e.map(i=>_(i)));return t.length?t.join(", "):void 0}get status(){return this.resource.status}get typeCodings(){var t;return p(W((t=this.resource.type)==null?void 0:t.map(e=>e.coding)))}get typeDisplay(){var g,h,f,E;const{display:t,system:e}=this.resource.class,i=(this.resource.class.code??"").toUpperCase(),s=((f=(h=(g=this.resource.type)==null?void 0:g[0])==null?void 0:h.coding)==null?void 0:f[0])??{},{text:n}=((E=this.resource.type)==null?void 0:E[0])??{},o=(s.code??"").toUpperCase(),l=q(e),c=l?o:i;let d=l?n:t;const m={AMB:"Ambulatory",IMP:"Inpatient",EMER:"Emergency"};if(c&&Object.keys(m).includes(c)){const v=m[c];if(!d)return v;d.toLowerCase()!==v.toLowerCase()&&(d+=`, ${m[c]}`)}return d??"Unknown"}}function k(){return $(I,[],S(async(r,t)=>{try{const{bundle:e,resources:i}=await L("Encounter",r,{patientUPID:t.UPID});return A(i,e)}catch(e){throw R.logError(e,"Failed fetching timeline information for patient"),new Error(`Failed fetching timeline information for patient: ${e}`)}},"req.patient_encounters"))}function A(r,t){const e=M(t);return r.map(i=>new j(i,void 0,e.get(i.id??"")))}function w({className:r}){const t=k(),{featureFlags:e}=U(),i=D({header:n=>`${n.periodStart} - ${n.periodEnd}`,subHeader:n=>n.typeDisplay,getSourceDocument:!0,details:B}),s=F(t.data??[],[n=>{var o;return((o=n.resource.period)==null?void 0:o.start)??""}],["desc"]);return a.createElement("div",{className:b(r,"ctw-overflow-hidden")},a.createElement(V,{isLoading:t.isLoading,records:s,columns:y(e==null?void 0:e.enableViewFhirButton),handleRowClick:i}))}const B=r=>[{label:"Period Start",value:r.periodStart},{label:"Period End",value:r.periodEnd},{label:"Status",value:x(r.status)},{label:"Class",value:r.class},{label:"Type",value:r.typeCodings.length?a.createElement(N,{codings:r.typeCodings}):void 0},{label:"Location",value:r.location},{label:"Participants",value:r.participants},{label:"Reason",value:r.reason},{label:"Diagnosis",value:r.diagnosis},{label:"Discharge Disposition",value:r.dischargeDisposition}];try{w.displayName="PatientTimeline",w.__docgenInfo={description:"",displayName:"PatientTimeline",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"Argument"}}}}}catch{}export{w as P};

import{R as i,r as u}from"./index-6f814c40.js";import{u as F,a as C,M as B}from"./use-medications-195acce2.js";import{m as l,D as j}from"./drawer-form-with-fields-c7511ce6.js";import{C as k}from"./combobox-field-178f69c7.js";import{P as Y,u as H,x as v,n as U,R as z,p as L,U as Q,V as $}from"./patient-helper-4581dd6e.js";import{t as K,i as A}from"./values-4e3b2a32.js";import{e as W,d as Z}from"./patient-provider-5f13d544.js";import{M as q,u as G}from"./medication-history-11a54a04.js";import{q as X}from"./request-5a1df4c1.js";import{c as J}from"./index-74f03c09.js";import{w as ee}from"./error-boundary-7710f561.js";const M=({className:e,color:a,text:t})=>{const r={primary:"ctw-bg-primary-light ctw-text-primary-main",gray:"ctw-bg-bg-light ctw-text-content-light",info:"ctw-bg-info-light ctw-text-info-main",success:"ctw-bg-success-light ctw-text-success-main",caution:"ctw-bg-caution-light ctw-text-caution-main",error:"ctw-bg-error-light ctw-text-error-main",notification:"ctw-bg-notification-light ctw-text-notification-main"}[a];return i.createElement("span",{className:J(e,r,"ctw-inline-flex ctw-rounded-full ctw-px-2 ctw-text-xs ctw-font-semibold ctw-leading-5")},t)};try{M.displayName="Badge",M.__docgenInfo={description:"",displayName:"Badge",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"enum",value:[{value:'"primary"'},{value:'"gray"'},{value:'"info"'},{value:'"success"'},{value:'"caution"'},{value:'"error"'},{value:'"notification"'}]}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}}}}}catch{}const te=async(e,a)=>{const{authToken:t,contextBuilderId:r}=e;return(await(await fetch(`${Y(e.env)}?display=${a}`,{headers:{Authorization:`Bearer ${t}`,...r&&{"Zus-Account":r}}})).json()).data},V=({defaultCoding:e,readonly:a,...t})=>{const{getRequestContext:r}=H(),[d,s]=u.useState(!1),[o,f]=u.useState(),c=async m=>{s(!0);const w=await r(),h=await te(w,m);h&&f(h.map(y=>({value:y,label:y.display}))),s(!1)};return i.createElement(k,{options:o||[],isLoading:d,name:`${t.name}`,defaultSearchTerm:t.defaultValue,readonly:a,onSearchChange:c,defaultValue:e})};try{V.displayName="MedicationsAutoComplete",V.__docgenInfo={description:"",displayName:"MedicationsAutoComplete",props:{defaultCoding:{defaultValue:null,description:"",name:"defaultCoding",required:!1,type:{name:"Coding"}},readonly:{defaultValue:null,description:"",name:"readonly",required:!0,type:{name:"boolean | undefined"}}}}}catch{}const _=e=>[{label:"Subject",value:e.subjectID,field:"subjectID",hidden:!0},{label:"Date Asserted",value:v(new Date,"P"),field:"dateAsserted",hidden:!0},{label:"Medication",field:"medication",value:e.display,render:(a,t)=>i.createElement(V,{readonly:a,...t,defaultCoding:e.rxNormCodeableConcept})},{label:"Latest Status",value:K(e.status),field:"status"},{label:"Instructions",value:e.dosage,field:"dosage"}],ae=l.object({subjectID:l.string({required_error:"Patient must be specified."}),dateAsserted:l.date({required_error:"Date asserted is required."}),medication:l.object({code:l.string({required_error:"Please choose a medication."}),display:l.string().optional(),system:l.string().optional()}),dosage:l.string().optional(),status:l.enum(["active","completed","entered-in-error","intended","not-taken","on-hold","stopped","unknown"])});try{_.displayName="getMedicationFormData",_.__docgenInfo={description:"",displayName:"getMedicationFormData",props:{builderPatientRxNormStatus:{defaultValue:null,description:"",name:"builderPatientRxNormStatus",required:!1,type:{name:"Record<string, string>"}},basedOn:{defaultValue:null,description:"",name:"basedOn",required:!0,type:{name:"string | undefined"}},category:{defaultValue:null,description:"",name:"category",required:!0,type:{name:"string"}},context:{defaultValue:null,description:"",name:"context",required:!0,type:{name:"string | undefined"}},dateAsserted:{defaultValue:null,description:"",name:"dateAsserted",required:!0,type:{name:"string | undefined"}},derivedFrom:{defaultValue:null,description:"",name:"derivedFrom",required:!0,type:{name:"string[]"}},aggregatedFrom:{defaultValue:null,description:"",name:"aggregatedFrom",required:!0,type:{name:"Reference[]"}},display:{defaultValue:null,description:"",name:"display",required:!0,type:{name:"string"}},dosage:{defaultValue:null,description:"",name:"dosage",required:!0,type:{name:"string | undefined"}},effectiveStart:{defaultValue:null,description:"",name:"effectiveStart",required:!0,type:{name:"string | undefined"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string | undefined"}},informationSource:{defaultValue:null,description:"",name:"informationSource",required:!0,type:{name:"Reference | undefined"}},medicationReference:{defaultValue:null,description:"",name:"medicationReference",required:!0,type:{name:"string | undefined"}},notesDisplay:{defaultValue:null,description:"",name:"notesDisplay",required:!0,type:{name:"string[]"}},partOf:{defaultValue:null,description:"",name:"partOf",required:!0,type:{name:"string | undefined"}},patientStatus:{defaultValue:null,description:"",name:"patientStatus",required:!0,type:{name:"string"}},rxNorm:{defaultValue:null,description:"",name:"rxNorm",required:!0,type:{name:"string | undefined"}},rxNormCodeableConcept:{defaultValue:null,description:'Get RxNorm coding with "display" defaulting to this Med-Statement label.',name:"rxNormCodeableConcept",required:!0,type:{name:"{ display: string; code?: string | undefined; _code?: Element | undefined; _display?: Element | undefined; system?: string | undefined; _system?: Element | undefined; ... 6 more ...; _id?: Element | undefined; }"}},reason:{defaultValue:null,description:"",name:"reason",required:!0,type:{name:"string | undefined"}},reasonReference:{defaultValue:null,description:"",name:"reasonReference",required:!0,type:{name:"Reference[] | undefined"}},isArchived:{defaultValue:null,description:"",name:"isArchived",required:!0,type:{name:"boolean"}},isInactive:{defaultValue:null,description:"",name:"isInactive",required:!0,type:{name:"boolean"}},status:{defaultValue:null,description:"",name:"status",required:!0,type:{name:"enum",value:[{value:'"active"'},{value:'"unknown"'},{value:'"completed"'},{value:'"entered-in-error"'},{value:'"intended"'},{value:'"stopped"'},{value:'"on-hold"'},{value:'"not-taken"'}]}},displayStatus:{defaultValue:null,description:"",name:"displayStatus",required:!0,type:{name:"string"}},statusReason:{defaultValue:null,description:"",name:"statusReason",required:!0,type:{name:"string | undefined"}},subject:{defaultValue:null,description:"",name:"subject",required:!0,type:{name:"Reference"}},subjectID:{defaultValue:null,description:"",name:"subjectID",required:!0,type:{name:"string"}},patient:{defaultValue:null,description:"",name:"patient",required:!0,type:{name:"PatientModel | undefined"}},lastFillDate:{defaultValue:null,description:"",name:"lastFillDate",required:!0,type:{name:"string | undefined"}},quantity:{defaultValue:null,description:"",name:"quantity",required:!0,type:{name:"string | undefined"}},daysSupply:{defaultValue:null,description:"",name:"daysSupply",required:!0,type:{name:"string | undefined"}},refills:{defaultValue:null,description:"",name:"refills",required:!0,type:{name:"string | undefined"}},lastPrescriber:{defaultValue:null,description:"",name:"lastPrescriber",required:!0,type:{name:"string | undefined"}},lastPrescribedDate:{defaultValue:null,description:"",name:"lastPrescribedDate",required:!0,type:{name:"string | undefined"}},resource:{defaultValue:null,description:"",name:"resource",required:!0,type:{name:"MedicationStatement"}},includedResources:{defaultValue:null,description:"",name:"includedResources",required:!1,type:{name:"ResourceMap"}},revIncludes:{defaultValue:null,description:"",name:"revIncludes",required:!1,type:{name:"Resource[]"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isSummaryResource:{defaultValue:null,description:"",name:"isSummaryResource",required:!0,type:{name:"boolean"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"string"}},resourceTypeTitle:{defaultValue:null,description:"",name:"resourceTypeTitle",required:!0,type:{name:"string"}},getBasicResourceByAction:{defaultValue:null,description:"",name:"getBasicResourceByAction",required:!0,type:{name:"(profileAction: string) => Basic | undefined"}},toString:{defaultValue:null,description:"",name:"toString",required:!1,type:{name:"() => string"}}}}}catch{}const ne=[L,Q,$],re=async(e,a)=>{const t={resourceType:"MedicationStatement",status:e.status,dateAsserted:U(e.dateAsserted),subject:{type:"Patient",reference:`Patient/${e.subjectID}`},medicationCodeableConcept:{text:e.medication.display,coding:[{system:z,code:e.medication.code}]},...e.dosage&&{dosage:[{text:e.dosage}]}},r=new q(t),d=await W(r.resource,await a());return await Promise.all(ne.map(async s=>X.invalidateQueries([s]))),d},S=({isOpen:e,handleOnClose:a,medication:t,children:r})=>{var c,m;const d=Z(),s={reference:`Patient/${(c=d.data)==null?void 0:c.id}`,display:(m=d.data)==null?void 0:m.display};let o;t?o=new q({...t,subject:s,dateAsserted:v(new Date,"yyyy-MM-dd")}):o=new q({resourceType:"MedicationStatement",status:"active",subject:s,dateAsserted:v(new Date,"yyyy-MM-dd")});const f=_(o);return i.createElement(i.Fragment,null,r,i.createElement(j,{title:"Add Medication",action:re,data:f,schema:ae,isOpen:e,onClose:()=>a()}))};try{S.displayName="AddNewMedDrawer",S.__docgenInfo={description:"",displayName:"AddNewMedDrawer",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},handleOnClose:{defaultValue:null,description:"",name:"handleOnClose",required:!0,type:{name:"() => void"}},medication:{defaultValue:null,description:"",name:"medication",required:!1,type:{name:"MedicationStatement"}}}}}catch{}const N=ee(({showDismissed:e=!1,showInactive:a=!1,hideAddToRecord:t=!1,handleAddToRecord:r,records:d,onAfterOpenHistoryDrawer:s,onOpenHistoryDrawer:o})=>{const f=G(),c=F(),[m,w]=u.useState([]),[h,y]=u.useState(!1),[E,x]=u.useState(!1),[b,R]=u.useState(),{otherProviderMedications:D,isLoading:P}=C();function T(n){A(o)&&o(),R(n),c({medication:n}),setTimeout(()=>{A(s)&&s()},0)}function I(n){R(n),y(!0)}return u.useEffect(()=>{const n=d||D;if(!n)return;const p=n.filter(g=>!g.isArchived||e).filter(g=>!g.isInactive||a),O=p.every(g=>g.isArchived);w(p),x(t&&O)},[D,a,e,d,t]),i.createElement("div",{"data-zus-telemetry-namespace":"OtherProviderMedsTable"},i.createElement(B,{getRowClassName:n=>({"ctw-tr-archived":n.isArchived}),emptyMessage:"No records found.",telemetryNamespace:"MedicationsTableBase",medicationStatements:m,isLoading:P,handleRowClick:T,RowActions:E?void 0:({record:n})=>i.createElement("div",{onClick:p=>p.stopPropagation(),onKeyDown:p=>p.stopPropagation()},!n.isArchived&&i.createElement("button",{type:"button",className:"ctw-btn-primary ctw-capitalize","data-zus-telemetry-click":"Dismiss record",onClick:async()=>{await f(n)}},"dismiss"),!t&&i.createElement("button",{type:"button",className:"ctw-btn-primary ctw-ml-1 ctw-capitalize","data-zus-telemetry-click":"Add to record","data-testid":"add-to-record",onClick:()=>{r?r(n):I(n)}},"add to record"))}),i.createElement(S,{medication:b==null?void 0:b.resource,isOpen:h,handleOnClose:()=>y(!1)}))},"OtherProviderMedsTable"),ge=()=>{const{otherProviderMedications:e=[]}=C(),a=e.filter(t=>!(t.isArchived||t.isInactive));return a.length>0?i.createElement(M,{color:"notification",text:a.length.toString(),className:"ctw-h-5"}):null};try{N.displayName="OtherProviderMedsTable",N.__docgenInfo={description:`Displays a table of medications that are not scoped to the current builder.
This component displays the inverse results of \`ProviderMedsTable\`.

The table has a menu to the right side which will pull out the
history for the medication listed in that row.`,displayName:"OtherProviderMedsTable",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},handleAddToRecord:{defaultValue:null,description:"",name:"handleAddToRecord",required:!1,type:{name:"((m: MedicationStatementModel) => void)"}},hideAddToRecord:{defaultValue:null,description:"",name:"hideAddToRecord",required:!1,type:{name:"boolean"}},showDismissed:{defaultValue:null,description:"",name:"showDismissed",required:!1,type:{name:"boolean"}},showInactive:{defaultValue:null,description:"",name:"showInactive",required:!1,type:{name:"boolean"}},records:{defaultValue:null,description:"",name:"records",required:!1,type:{name:"MedicationStatementModel[]"}},onOpenHistoryDrawer:{defaultValue:null,description:"",name:"onOpenHistoryDrawer",required:!1,type:{name:"(() => void)"}},onAfterOpenHistoryDrawer:{defaultValue:null,description:"",name:"onAfterOpenHistoryDrawer",required:!1,type:{name:"(() => void)"}}}}}catch{}export{M as B,N as O,ge as a};

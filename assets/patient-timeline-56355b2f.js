import{R as a}from"./index-6f814c40.js";import{c as w}from"./index-74f03c09.js";import{u as D}from"./resource-details-drawer-86a774c0.js";import{V as T}from"./view-fhir-c5264c4f.js";import{C as P}from"./coding-list-1d7c950f.js";import{F as N,c as _,a as C,U as L,s as R,T as S,V as I,W as V,u as M}from"./patient-helper-c5d8ffd5.js";import{T as U}from"./table-18dfc5b5.js";import"./_baseToString-ba0098b0.js";import{d as p,o as F}from"./sortBy-6991f27f.js";import"./_baseClone-0c3bfcab.js";import"./sortBy-9842b21c.js";import"./_equalByTag-3aa7c076.js";import{f as W,b as q}from"./values-fdc68ea6.js";import"./_baseForOwn-56487e0e.js";import"./_createSet-823d7c6f.js";import{u as x}from"./patient-provider-76317411.js";const u=({className:r,items:t,limit:e,total:i})=>a.createElement("div",{className:r},t.slice(0,e).map((n,s)=>a.createElement("div",{key:n+s},a.createElement("div",null,n))),i>e&&a.createElement("div",{className:"ctw-font-medium"},"+ ",i-e," more"));try{u.displayName="SimpleMoreList",u.__docgenInfo={description:"",displayName:"SimpleMoreList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"string[]"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},total:{defaultValue:null,description:"",name:"total",required:!0,type:{name:"number"}}}}}catch{}const y=(r=!0)=>{const t=[{title:"Date",widthPercent:10,minWidth:120,dataIndex:"periodStart"},{title:"Type",widthPercent:20,minWidth:150,render:e=>a.createElement("div",null,a.createElement("div",null,"Encounter"),a.createElement("div",null,e.typeDisplay))},{title:"Provider",widthPercent:25,minWidth:200,render:e=>{const{participant:i}=e.resource;if(!i||i.length===0)return null;const n=i.map(s=>{var c,d;const o=((c=s.individual)==null?void 0:c.display)??"";let l=((d=s.type)==null?void 0:d[0].text)??"";return["noinformation","unk"].includes(l.toLowerCase())&&(l=""),o&&l?`${o} (${l})`:o||l});return a.createElement("div",null,a.createElement(u,{items:n,limit:6,total:i.length}),a.createElement("div",null,e.location))}},{widthPercent:45,minWidth:250,render:e=>{const{diagnosis:i}=e.resource;return!i||i.length===0?null:a.createElement("div",null,a.createElement(u,{items:i.map(n=>n.condition.display??""),limit:3,total:i.length}))}}];return r&&t.push({widthPercent:10,minWidth:200,render:e=>a.createElement(T,{name:"Encounter Resource",resource:e.resource})}),t};try{y.displayName="patientTimelineColumns",y.__docgenInfo={description:"",displayName:"patientTimelineColumns",props:{}}}catch{}class $ extends N{get class(){const{display:t,code:e}=this.resource.class;return t??e!=="UNK"?e:void 0}get diagnosis(){var e;const t=p((e=this.resource.diagnosis)==null?void 0:e.map(i=>i.condition.display));return t.length?t.join(", "):void 0}get dischargeDisposition(){var t;return _((t=this.resource.hospitalization)==null?void 0:t.dischargeDisposition)}get location(){var e;const t=p((e=this.resource.location)==null?void 0:e.map(i=>i.location.display));return t.length?t.join(", "):void 0}get participants(){var e;const t=p((e=this.resource.participant)==null?void 0:e.map(i=>{var n;return(n=i.individual)==null?void 0:n.display}));return t.length?t.join(", "):void 0}get periodEnd(){var t;return C((t=this.resource.period)==null?void 0:t.end)}get periodStart(){var t;return C((t=this.resource.period)==null?void 0:t.start)}get reason(){var e;const t=p((e=this.resource.reasonCode)==null?void 0:e.map(i=>_(i)));return t.length?t.join(", "):void 0}get status(){return this.resource.status}get typeCodings(){var t;return p(W((t=this.resource.type)==null?void 0:t.map(e=>e.coding)))}get typeDisplay(){var g,h,f,E;const{display:t,system:e}=this.resource.class,i=(this.resource.class.code??"").toUpperCase(),n=((f=(h=(g=this.resource.type)==null?void 0:g[0])==null?void 0:h.coding)==null?void 0:f[0])??{},{text:s}=((E=this.resource.type)==null?void 0:E[0])??{},o=(n.code??"").toUpperCase(),l=e===L,c=l?o:i;let d=l?s:t;const m={AMB:"Ambulatory",IMP:"Inpatient",EMER:"Emergency"};if(c&&Object.keys(m).includes(c)){const v=m[c];if(!d)return v;d.toLowerCase()!==v.toLowerCase()&&(d+=`, ${m[c]}`)}return d??"Unknown"}}function j(){return x(I,[],async(r,t)=>{try{const{bundle:e,resources:i}=await R("Encounter",r,{patientUPID:t.UPID});return k(i,e)}catch(e){throw S.logError(e,"Failed fetching timeline information for patient"),new Error(`Failed fetching timeline information for patient: ${e}`)}})}function k(r,t){const e=V(t);return r.map(i=>new $(i,void 0,e.get(i.id??"")))}function b({className:r}){const t=j(),{featureFlags:e}=M(),i=D({header:s=>`${s.periodStart} - ${s.periodEnd}`,subHeader:s=>s.typeDisplay,getSourceDocument:!0,details:A}),n=F(t.data??[],[s=>{var o;return((o=s.resource.period)==null?void 0:o.start)??""}],["desc"]);return a.createElement("div",{className:w(r,"ctw-overflow-hidden")},a.createElement(U,{isLoading:t.isLoading,records:n,columns:y(e==null?void 0:e.enableViewFhirButton),handleRowClick:i}))}const A=r=>[{label:"Period Start",value:r.periodStart},{label:"Period End",value:r.periodEnd},{label:"Status",value:q(r.status)},{label:"Class",value:r.class},{label:"Type",value:r.typeCodings.length?a.createElement(P,{codings:r.typeCodings}):void 0},{label:"Location",value:r.location},{label:"Participants",value:r.participants},{label:"Reason",value:r.reason},{label:"Diagnosis",value:r.diagnosis},{label:"Discharge Disposition",value:r.dischargeDisposition}];try{b.displayName="PatientTimeline",b.__docgenInfo={description:"",displayName:"PatientTimeline",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"Argument"}},includeViewFhirResource:{defaultValue:null,description:"",name:"includeViewFhirResource",required:!1,type:{name:"boolean"}}}}}catch{}export{b as P};

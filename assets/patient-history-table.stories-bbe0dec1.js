var C=Object.defineProperty;var D=(e,t,r)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var p=(e,t,r)=>(D(e,typeof t!="symbol"?t+"":t,r),r);import{r as l,R as a}from"./index-9f32f44c.js";import{c as S}from"./index-a587463d.js";import{s as F,t as B,v as P,x as L,m as M,y as q,z as U,T as V,A as j,w as z,B as W,H as $,R as K,D as Y,C as O,F as Q,a as J,b as Z,c as G,S as X}from"./patient-allergies-86cf4e18.js";import"./_baseForOwn-2c8afc2d.js";import"./uniqWith-5ea28b10.js";import{c as ee,T as te}from"./table-48f05a25.js";import"./_baseClone-058b2292.js";import"./_baseIsEqual-51bafb81.js";import"./_baseUniq-df086167.js";import{u as ae}from"./uniq-95c702ad.js";import"./action-list-c818d1e1.js";import"./request-00a5930a.js";import"./___vite-browser-external_commonjs-proxy-25acf8c4.js";import"./spinner-096fc82a.js";import{s as re}from"./requests-8cc0ea3d.js";import"./_commonjsHelpers-de833af9.js";import"./extends-d3510bf0.js";import"./_basePickBy-c1a75bb1.js";import"./is-plain-object-1e15bc1a.js";import"./debounce-afba8bf8.js";import"./toNumber-0c016d7c.js";import"./mapValues-ceea932c.js";import"./index-9c2d1831.js";import"./data-list-2854f463.js";import"./isEqual-55976ea2.js";import"./isPlainObject-eb99f80b.js";import"./index-e0a0619e.js";import"./requests-4293153d.js";function se(){const e=[];return e.push({key:"status",type:"select",icon:F,values:["initialize",{key:"in_progress",name:"in progress"},"error","done",{key:"done_with_errors",name:"done with errors "}],display:"status"},{key:"future_jobs",type:"tag",icon:B,display:"Exclude Future Jobs"}),e}const ie={future_jobs:{key:"future_jobs",selected:!0,type:"tag"}};class ne{constructor(t,r){p(this,"kind","PatientHistory");p(this,"historyInfo");p(this,"patient");this.patient=t,this.historyInfo=r}get providers(){var t;return(t=this.historyInfo)==null?void 0:t.attributes.providers}get lastUpdatedAt(){var t;return P(new Date(Number((t=this.historyInfo)==null?void 0:t.attributes.lastUpdatedAt)*1e3),"M/d/yy h:mm a")}get key(){var t;return((t=this.historyInfo)==null?void 0:t.id)||""}get targetDate(){var t;return L((t=this.historyInfo)==null?void 0:t.attributes.targetDate)}get createdAt(){var t;if((t=this.historyInfo)!=null&&t.attributes.createdAt)return P(new Date(Number(this.historyInfo.attributes.createdAt)*1e3),"M/d/yy h:mm a")}}function oe(e,t,r,s){return M(j,[e,t,r,s],async n=>{try{const i=await q({requestContext:n,count:e,offset:t,status:r,excludeFutureJobs:s}),u=ae(ee(i.data.map(o=>o.relationships.patient.data.id)));if(!u.length)return{total:0,patients:[]};const w=await U(n,void 0,u),d=i.data.map(o=>{const m=w.patients.filter(h=>h.id===o.relationships.patient.data.id);return new ne(m[0],o)});return{hasNext:!!i.links.next,total:i.data.length,patients:d}}catch(i){throw V.logError(i,"Failed fetching patient history patients."),new Error(`Failed fetching patient history patients: ${i}`)}})}const b=z(({className:e,handleRowClick:t,pageSize:r=10,title:s="Patient History Request",includeBorder:n=!0})=>{const[i,u]=l.useState(1),[w,d]=l.useState([]),[o,m]=l.useState(),[h,k]=l.useState(!0),{data:{patients:g,total:x,hasNext:R}={},isFetching:E,isError:_}=oe(r,i-1,o,h),A=c=>{var v,N;k(!!((v=c.future_jobs)!=null&&v.selected)),(N=c.status)!=null&&N.selected&&typeof c.status.selected=="string"?m(c.status.selected.split(" ").join("_")):m(void 0)};return l.useEffect(()=>{!E&&g&&d(g.filter(c=>c.patient))},[g,x,_,E]),l.useEffect(()=>{_&&d([])},[_,E]),a.createElement(W,{className:S("ctw-patients-table-inputs",{"ctw-patients-border":n},e)},s&&a.createElement($,{title:s}),a.createElement(K,{filterOptions:{onChange:A,filters:se(),defaultState:ie},className:"ctw-ml-2"}),a.createElement("div",{className:"ctw-overflow-hidden"},a.createElement(te,{records:w,columns:ce,pageSize:r,handleRowClick:t,hidePagination:!0},a.createElement(Y,{currentPage:i,setCurrentPage:u,hasNext:R}))))},"PatientsHistoryTable"),ce=[{title:"Last Queried",render:e=>a.createElement("div",null,e.lastUpdatedAt)},{title:"Target Date",render:e=>a.createElement("div",null,e.targetDate)},{title:"Name",render:e=>a.createElement(le,{data:e})},{title:"Source",render:e=>{var t;return a.createElement("div",{className:"ctw-space-y-2"},(t=e.providers)==null?void 0:t.map(r=>{var s;return a.createElement("div",{key:`${(s=e.historyInfo)==null?void 0:s.id}-${r.service}`},a.createElement("div",{className:"ctw-w-fit  ctw-py-1	ctw-capitalize"},ue(r.service)))}))}},{title:"Status",render:e=>{var t;return a.createElement("div",{className:"ctw-space-y-2"},(t=e.providers)==null?void 0:t.map(r=>a.createElement("div",{key:`${e.key}-${r.service}`},a.createElement("div",{className:"ctw-capitalize"},a.createElement(de,{status:r.status})))))}}],le=({data:e})=>{var t,r,s,n;return a.createElement("div",{className:"ctw-flex ctw-items-center"},a.createElement("div",null,a.createElement("div",{className:"ctw-flex ctw-space-x-1 ctw-font-medium"},a.createElement("div",{className:"ctw-max-w-xs"},(t=e.patient)==null?void 0:t.fullName),((r=e.patient)==null?void 0:r.resource.gender)&&a.createElement("div",{className:"ctw-uppercase"},"(",e.patient.resource.gender[0],")")),a.createElement("div",{className:"ctw-text-content-lighter"},(s=e.patient)==null?void 0:s.dob," (",(n=e.patient)==null?void 0:n.age,")")))},ue=e=>{switch(e.toLowerCase()){case"commonwell":return"EHR Network";case"surescripts":return"Medication History";default:return e}},de=({status:e})=>{switch(e){case"initialize":case"in_progress":return a.createElement(f,{status:e,className:"ctw-bg-caution-light ctw-text-caution-heading"});case"done":return a.createElement(f,{status:e,className:"ctw-bg-success-light ctw-text-success-dark"});case"error":case"done_with_errors":return a.createElement(f,{status:e,className:"ctw-bg-error-light ctw-text-error-text"});default:return a.createElement(f,{status:e})}},f=({status:e,className:t})=>a.createElement("div",{className:S("ctw-w-fit ctw-rounded-2xl ctw-px-3 ctw-py-1 ctw-font-medium",t)},e.split("_").join(" "));try{b.displayName="PatientHistoryTable",b.__docgenInfo={description:"",displayName:"PatientHistoryTable",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"Argument"}},handleRowClick:{defaultValue:null,description:"",name:"handleRowClick",required:!1,type:{name:"((row: PatientHistoryRequestModel) => void)"}},pageSize:{defaultValue:null,description:"",name:"pageSize",required:!1,type:{name:"number"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},includeBorder:{defaultValue:null,description:"",name:"includeBorder",required:!1,type:{name:"boolean"}},getRowClasses:{defaultValue:null,description:"",name:"getRowClasses",required:!1,type:{name:"((row: PatientModel) => Argument)"}},onRowClick:{defaultValue:null,description:"",name:"onRowClick",required:!1,type:{name:"((row: PatientModel) => void)"}}}}}catch{}const Ve={component:b,tags:["autodocs"],args:{},decorators:[(e,{args:t})=>a.createElement(O,{env:"dev",authToken:Q,builderId:J},a.createElement(Z,{patientID:G,systemURL:X},a.createElement(e,{args:t})))]},y={...re()};var T,H,I;y.parameters={...y.parameters,docs:{...(T=y.parameters)==null?void 0:T.docs,source:{originalSource:`{
  ...setupPatientHistoryMocks()
}`,...(I=(H=y.parameters)==null?void 0:H.docs)==null?void 0:I.source}}};const je=["Basic"];export{y as Basic,je as __namedExportsOrder,Ve as default};

var P=Object.defineProperty;var A=(e,n,t)=>n in e?P(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var C=(e,n,t)=>(A(e,typeof n!="symbol"?n+"":n,t),t);import{R as i,r as b}from"./index-6f814c40.js";import{D as O,e as L}from"./data-list-254aa0b0.js";import{D as h}from"./drawer-ed34104d.js";import{u as F,M as Q,g as B,a as U,b as x,s as Y,c as k,d as j}from"./medication-history-492b3089.js";import{L as z}from"./loading-c7ff698a.js";import{i as K,h as G,j as H}from"./values-66360932.js";import{u as $}from"./resource-details-drawer-b03884fb.js";import{C as W}from"./coding-list-1d7c950f.js";import{u,b as J}from"./patient-provider-d1b391ca.js";import{w as d,aK as X,aL as Z,aM as ee,aw as R,aN as te,a4 as ae,a3 as ne,F as re,c as N,a as w,aO as ie,s as se,T as oe}from"./patient-helper-0838fee9.js";import{M as T,i as le}from"./sort-013eed15.js";import"./_baseToString-4993715b.js";import{c as g}from"./sortBy-df4456c4.js";import"./_baseClone-25b1595e.js";import"./sortBy-d677d734.js";import"./_equalByTag-aaf39779.js";import"./_baseForOwn-d8306f34.js";import{u as V}from"./uniq-f5468222.js";import"./_createSet-12ef9b81.js";function ue(e,n){return e?[{label:"Status",value:e.displayStatus},{label:"Last Fill Date",value:e.lastFillDate},{label:"Quantity",value:e.quantity},{label:"Days Supply",value:e.daysSupply},{label:"Refills",value:e.refills},{label:"Instructions",value:e.dosage},{label:"Prescriber",value:n},{label:"Last Prescribed Date",value:e.lastPrescribedDate},...L("Note",e.notesDisplay)]:[]}const S=({medication:e,onDismissal:n,...t})=>{const{lastPrescriber:a,isLoading:r}=F(e==null?void 0:e.resource),s=ue(e,a);return i.createElement(h,{title:"Medication Details",...t},i.createElement(h.Body,null,i.createElement("div",{className:"ctw-space-y-5"},i.createElement("div",{className:"ctw-flex ctw-justify-between ctw-space-x-8"},i.createElement("h3",{className:"ctw-m-0 ctw-text-3xl ctw-font-light"},e==null?void 0:e.display)),r&&i.createElement(z,null),!r&&i.createElement(O,{title:"Summary",data:s}),e&&i.createElement(Q,{medication:e}))),i.createElement(h.Footer,null,i.createElement("div",{className:"ctw-flex ctw-justify-end ctw-space-x-2"},K(n)&&!(e!=null&&e.isArchived)&&i.createElement("button",{type:"button",className:"ctw-btn-primary",onClick:()=>{n(e),t.onClose()},"data-zus-telemetry-click":"Dismiss"},"Dismiss"),i.createElement("button",{type:"button",className:"ctw-btn-default",onClick:t.onClose,"data-zus-telemetry-click":"Close"},"Close"))))};try{S.displayName="MedicationDrawer",S.__docgenInfo={description:"",displayName:"MedicationDrawer",props:{medication:{defaultValue:null,description:"",name:"medication",required:!1,type:{name:"MedicationStatementModel"}},onDismissal:{defaultValue:null,description:"",name:"onDismissal",required:!1,type:{name:"((m: MedicationStatementModel) => void)"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onOpen:{defaultValue:null,description:"",name:"onOpen",required:!1,type:{name:"(() => void)"}},onAfterOpen:{defaultValue:null,description:"",name:"onAfterOpen",required:!1,type:{name:"(() => void)"}}}}}catch{}function de(){return u(ae,[{informationSourceNot:"Patient"}],d(k,"req.builder_medications"))}function ce(){return u(ne,[{_revinclude:"Basic:subject"}],d(j,"req.active_medications"))}function Le(){return u(X,[{informationSourceNot:"Patient"}],d(B,"req.medication_requests_common"))}function Fe(){return u(Z,[{informationSourceNot:"Patient"}],d(U,"req.medication_dispense_common"))}function pe(e){return u(ee,[e],d(x,"req.medication_statement"))}function Qe(){const[e,n]=b.useState([]),[t,a]=b.useState([]),r=ce(),s=de();b.useEffect(()=>{var o,l;if((o=r.data)!=null&&o.bundle&&((l=s.data)!=null&&l.bundle)){const{medications:c,bundle:M}=r.data,{medications:v}=s.data,p=R(M),m=te([r.data.bundle,s.data.bundle]),y=Y(c.map(f=>new T(f,m,p.get(f.id??""))),v.map(f=>new T(f,m,p.get(f.id??""))));n(y.builderMedications),a(y.otherProviderMedications)}},[r.data,s.data]);const _=s.isLoading||r.isLoading,D=s.isFetching||r.isFetching,E=s.isError||r.isError;return{isFetching:D,isLoading:_,isError:E,builderMedications:e,otherProviderMedications:t}}function Be(){return $({header:e=>`${e.periodStart} - ${e.periodEnd}`,subHeader:e=>e.typeDisplay,getSourceDocument:!0,details:q})}const q=e=>{var n;return[{label:"Period Start",value:e.periodStart},{label:"Period End",value:e.periodEnd},{label:"Status",value:G(e.status)},{label:"Class",value:e.class},{label:"Type",value:e.typeCodings.length?i.createElement(W,{codings:e.typeCodings}):void 0},{label:"Location",value:e.location},{label:"Participants",value:e.participants},{label:"Reason",value:e.reason},{label:"Diagnosis",value:(n=e.diagnoses)==null?void 0:n.join(", ")},{label:"Discharge Disposition",value:e.dischargeDisposition}]};function Ue(){const{openDrawer:e}=J();return n=>{e({component:t=>i.createElement(me,{medicationEventModel:n,...t})})}}const me=e=>{var a;const{medicationEventModel:n}=e,t=pe(n.rxNorm);return(a=t.data)!=null&&a.length?i.createElement(S,{medication:t.data[0],...e}):null};try{q.displayName="encounterData",q.__docgenInfo={description:"",displayName:"encounterData",props:{kind:{defaultValue:null,description:"",name:"kind",required:!0,type:{name:'"Encounter"'}},class:{defaultValue:null,description:"",name:"class",required:!0,type:{name:"string | undefined"}},diagnoses:{defaultValue:null,description:"",name:"diagnoses",required:!0,type:{name:"string[] | undefined"}},dischargeDisposition:{defaultValue:null,description:"",name:"dischargeDisposition",required:!0,type:{name:"string | undefined"}},location:{defaultValue:null,description:"",name:"location",required:!0,type:{name:"string | undefined"}},participants:{defaultValue:null,description:"",name:"participants",required:!0,type:{name:"string | undefined"}},periodEnd:{defaultValue:null,description:"",name:"periodEnd",required:!0,type:{name:"string | undefined"}},periodStart:{defaultValue:null,description:"",name:"periodStart",required:!0,type:{name:"string | undefined"}},reason:{defaultValue:null,description:"",name:"reason",required:!0,type:{name:"string | undefined"}},status:{defaultValue:null,description:"",name:"status",required:!0,type:{name:"enum",value:[{value:'"entered-in-error"'},{value:'"planned"'},{value:'"arrived"'},{value:'"triaged"'},{value:'"in-progress"'},{value:'"onleave"'},{value:'"finished"'},{value:'"cancelled"'},{value:'"unknown"'}]}},typeCodings:{defaultValue:null,description:"",name:"typeCodings",required:!0,type:{name:"Coding[]"}},typeDisplay:{defaultValue:null,description:"",name:"typeDisplay",required:!0,type:{name:"string | undefined"}},resource:{defaultValue:null,description:"",name:"resource",required:!0,type:{name:"Encounter"}},includedResources:{defaultValue:null,description:"",name:"includedResources",required:!1,type:{name:"ResourceMap"}},revIncludes:{defaultValue:null,description:"",name:"revIncludes",required:!1,type:{name:"Resource[]"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isArchived:{defaultValue:null,description:"",name:"isArchived",required:!0,type:{name:"boolean"}},isSummaryResource:{defaultValue:null,description:"",name:"isSummaryResource",required:!0,type:{name:"boolean"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"string"}},resourceTypeTitle:{defaultValue:null,description:"",name:"resourceTypeTitle",required:!0,type:{name:"string"}},getBasicResourceByAction:{defaultValue:null,description:"",name:"getBasicResourceByAction",required:!0,type:{name:"(profileAction: string) => Basic | undefined"}},toString:{defaultValue:null,description:"",name:"toString",required:!1,type:{name:"() => string"}}}}}catch{}const I=({className:e,items:n,limit:t,total:a})=>i.createElement("div",{className:e},n.slice(0,t).map((r,s)=>i.createElement("div",{key:r+s},i.createElement("div",null,r))),a>t&&i.createElement("div",{className:"ctw-font-medium"},"+ ",a-t," more"));try{I.displayName="SimpleMoreList",I.__docgenInfo={description:"",displayName:"SimpleMoreList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"string[]"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},total:{defaultValue:null,description:"",name:"total",required:!0,type:{name:"number"}}}}}catch{}class ye extends re{constructor(){super(...arguments);C(this,"kind","Encounter")}get class(){const{display:t,code:a}=this.resource.class;return t??a!=="UNK"?a:void 0}get diagnoses(){var t;return g(V((t=this.resource.diagnosis)==null?void 0:t.map(a=>a.condition.display)))}get dischargeDisposition(){var t;return N((t=this.resource.hospitalization)==null?void 0:t.dischargeDisposition)}get location(){var a;const t=g((a=this.resource.location)==null?void 0:a.map(r=>r.location.display));return t.length?t.join(", "):void 0}get participants(){var a;const t=g(V((a=this.resource.participant)==null?void 0:a.map(r=>{var s;return(s=r.individual)==null?void 0:s.display})));return t.length?t.join(", "):void 0}get periodEnd(){var t;return w((t=this.resource.period)==null?void 0:t.end)}get periodStart(){var t;return w((t=this.resource.period)==null?void 0:t.start)}get reason(){var a;const t=g((a=this.resource.reasonCode)==null?void 0:a.map(r=>N(r)));return t.length?t.join(", "):void 0}get status(){return this.resource.status}get typeCodings(){var t;return g(H((t=this.resource.type)==null?void 0:t.map(a=>a.coding)))}get typeDisplay(){var M,v,p,m;const{display:t,system:a}=this.resource.class,r=(this.resource.class.code??"").toUpperCase(),s=((p=(v=(M=this.resource.type)==null?void 0:M[0])==null?void 0:v.coding)==null?void 0:p[0])??{},{text:_}=((m=this.resource.type)==null?void 0:m[0])??{},D=(s.code??"").toUpperCase(),E=le(a),o=E?D:r;let l=E?_:t;const c={AMB:"Ambulatory",IMP:"Inpatient",EMER:"Emergency"};if(o&&Object.keys(c).includes(o)){const y=c[o];if(!l)return y;l.toLowerCase()!==y.toLowerCase()&&(l+=`, ${c[o]}`)}return l??"Unknown"}}function xe(){return u(ie,[],d(async(e,n)=>{try{const{bundle:t,resources:a}=await se("Encounter",e,{patientUPID:n.UPID});return fe(a,t)}catch(t){throw oe.logError(t,"Failed fetching timeline information for patient"),new Error(`Failed fetching timeline information for patient: ${t}`)}},"req.patient_encounters"))}function fe(e,n){const t=R(n);return e.map(a=>new ye(a,void 0,t.get(a.id??"")))}export{ye as E,S as M,I as S,xe as a,Be as b,Le as c,Fe as d,Ue as e,Qe as u};

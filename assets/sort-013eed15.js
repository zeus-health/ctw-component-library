var ne=Object.defineProperty;var oe=(s,i,e)=>i in s?ne(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e;var h=(s,i,e)=>(oe(s,typeof i!="symbol"?i+"":i,e),e);import{r as L}from"./index-6f814c40.js";import{g as ae,e as j,u as b,c as G}from"./patient-provider-d1b391ca.js";import{ai as ce,n as D,aj as P,a0 as X,ak as O,al as T,F as g,a as u,c,a7 as f,am as B,an as M,ao as N,ap as Y,aq as ue,G as m,ar as w,as as p,at as de,au as le,av as he,w as A,e as Q,T as E,aw as fe,ax as me,s as ge,ay as ye,az as $,aA as pe,a2 as q,aB as Se,aC as ve,aD as Ne,aE as Ee,aF as Ce,aG as De,aH as Ie,aI as Re,aJ as Te,aa as Me}from"./patient-helper-0838fee9.js";import"./_baseToString-4993715b.js";import{f as I,c as R,i as _e,o as k}from"./sortBy-df4456c4.js";import"./_baseClone-25b1595e.js";import{c as H}from"./_basePickBy-239377e6.js";import"./sortBy-d677d734.js";import"./_equalByTag-aaf39779.js";import{b as be,h as z}from"./_baseForOwn-d8306f34.js";import{p as Pe}from"./getPrototypeOf-9c757e77.js";import"./_createSet-12ef9b81.js";import{q as _}from"./request-5a1df4c1.js";import{u as Oe}from"./collapsible-data-list-details-b542a54e.js";import{b as v,f as we,g as V,h as Ae}from"./values-66360932.js";import{i as K}from"./isString-35d4a3f2.js";function ke(s){return s===void 0}var xe=ke,Fe="Expected a function";function Ue(s){if(typeof s!="function")throw new TypeError(Fe);return function(){var i=arguments;switch(i.length){case 0:return!s.call(this);case 1:return!s.call(this,i[0]);case 2:return!s.call(this,i[0],i[1]);case 3:return!s.call(this,i[0],i[1],i[2])}return!s.apply(this,i)}}var Le=Ue,Be=be,Ye=Le,$e=Pe;function qe(s,i){return $e(s,Ye(Be(i)))}var je=qe;function Ge(s){return H(s)}const W=s=>{let i="",e="";switch(s){case"Active":i="confirmed",e="active";break;case"Inactive":i="confirmed",e="inactive";break;case"Pending":i="unconfirmed",e="active";break;case"Refuted":i="refuted",e="inactive";break;case"Entered In Error":i="entered-in-error";break;default:throw Error("status is should be of type ConditionStatus")}return je({verificationStatus:{coding:[{system:O,code:i}]},...e&&{clinicalStatus:{coding:[{system:T,code:e}]}}},xe)},It=async(s,i,e,t)=>{const r=await t(),n={resourceType:"Condition",id:e.id,recorder:await ae(r),...W(e.status),category:e.id&&s?s.resource.category:[{coding:[{system:ce,code:"problem-list-item",display:"Problem List Item"}]}],code:e.id&&s?s.codings:{coding:[{system:e.condition.system,code:e.condition.code,display:e.condition.display}],text:e.condition.display},...e.abatement&&{abatementDateTime:D(e.abatement)},onsetDateTime:D(e.onset),recordedDate:D(new Date),subject:{type:"Patient",reference:`Patient/${i}`},note:e.note?[{text:e.note}]:void 0},o=await j(n,r);return await Promise.all([_.invalidateQueries([P]),_.invalidateQueries([X])]),o},Xe={INF:{fullName:"Certain Infectious and Parasitic Diseases",shortName:"Infectious and Parasitic Diseases"},NEO:{fullName:"Neoplasms",shortName:"Neoplasms"},BLD:{fullName:"Diseases of the Blood and Blood Forming Organs and Certain Disorders Involving the Immune Mechanism",shortName:"Blood Diseases"},END:{fullName:"Endocrine, Nutritional and Metabolic Diseases",shortName:"Endocrine, Nutritional and Metabolic"},MBD:{fullName:"Mental, Behavioral and Neurodevelopmental Disorders",shortName:"Mental and Behavioral"},NVS:{fullName:"Diseases of the Nervous System",shortName:"Nervous System"},EYE:{fullName:"Diseases of the Eye and Adnexa",shortName:"Eye and Adnexa"},EAR:{fullName:"Diseases of the Ear and Mastoid Process",shortName:"Ear and Mastoid Process"},CIR:{fullName:"Diseases of the Circulatory System",shortName:"Circulatory System"},RSP:{fullName:"Diseases of the Respiratory System",shortName:"Respiratory System"},DIG:{fullName:"Diseases of the Digestive System",shortName:"Digestive System"},SKN:{fullName:"Diseases of the Skin and Subcutaneous Tissue",shortName:"Skin and Subcutaneous Tissue"},MUS:{fullName:"Diseases of the Musculoskeletal System and Connective Tissue",shortName:"Musculoskeletal System"},GEN:{fullName:"Diseases of the Genitourinary System",shortName:"Genitourinary System"},PRG:{fullName:"Pregnancy, Childbirth and the Puerperium",shortName:"Pregnancy & Childbirth"},PNL:{fullName:"Certain Conditions Originating in the Perinatal Period",shortName:"Perinatal Conditions"},MAL:{fullName:"Congenital Malformations, Deformations and Chromosomal Abnormalities",shortName:"Malformations and Chromosomal Abnormalities"},SYM:{fullName:"Symptoms, Signs and Abnormal Clinical and Laboratory Findings",shortName:"Clinical Findings"},INJ:{fullName:"Injury, Poisoning and Certain Other Consequences of External Causes",shortName:"External Causes Injury"},EXT:{fullName:"External Causes of Morbidity",shortName:"External Morbidity"},FAC:{fullName:"Factors Influencing Health Status and Contact with Health Services",shortName:"Health Status Influences"},XXX:{fullName:"Unacceptable principal diagnosis (inpatient data) or first-listed diagnosis (outpatient data)",shortName:"Unacceptable principal diagnosis"}};class Qe extends g{constructor(){super(...arguments);h(this,"kind","Condition")}get abatement(){var e,t,r;return this.resource.abatementAge?(e=this.resource.abatementAge.value)==null?void 0:e.toString():this.resource.abatementDateTime?u(this.resource.abatementDateTime):this.resource.abatementPeriod?u(this.resource.abatementPeriod.start):this.resource.abatementRange?u((r=(t=this.resource.abatementRange.low)==null?void 0:t.value)==null?void 0:r.toString()):this.resource.abatementString}get active(){var t;const e=I((t=this.resource.clinicalStatus)==null?void 0:t.coding,{system:T});return e!=null&&e.code?["active","recurrence","relapse"].includes(e.code):!1}get asserter(){var e;return(e=this.resource.asserter)==null?void 0:e.display}get bodySites(){var e;return((e=this.resource.bodySite)==null?void 0:e.map(t=>c(t)))||[]}get categories(){var e;return((e=this.resource.category)==null?void 0:e.map(t=>c(t)))||[]}get ccsChapter(){var t;const e=this.ccsChapterCode;if(e)return(t=Xe[e])==null?void 0:t.shortName}get ccsChapterCode(){var e,t;return(t=(e=f(B,this.resource.code))==null?void 0:e.code)==null?void 0:t.slice(0,3)}get ccsGrouping(){var e;return(e=f(B,this.resource.code))==null?void 0:e.display}get clinicalStatus(){return c(this.resource.clinicalStatus)}get clinicalStatusCode(){var e,t;return(t=I((e=this.resource.clinicalStatus)==null?void 0:e.coding,{system:T}))==null?void 0:t.code}get codings(){return this.resource.code}get display(){var e;return((e=M(C,this.resource.code))==null?void 0:e.display)??c(this.resource.code)}get encounter(){var e;return(e=this.resource.encounter)==null?void 0:e.display}get evidences(){var e;return((e=this.resource.evidence)==null?void 0:e.map(t=>{var r;return c((r=t.code)==null?void 0:r[0])}))||[]}get icd10Code(){var e;return(e=f(N,this.resource.code))==null?void 0:e.code}get icd10System(){var e;return(e=f(N,this.resource.code))==null?void 0:e.system}get icd10Display(){var e;return(e=f(N,this.resource.code))==null?void 0:e.display}get isDeleted(){return this.verificationStatusCode==="entered-in-error"}get hasEnrichment(){const e=C.filter(r=>r.checkForEnrichment===!0);return R(e.map(r=>Y(r.system,this.resource.code))).length>0}get knownCodings(){const e=R(C.map(r=>r.checkForEnrichment?Y(r.system,this.resource.code):f(r.system,this.resource.code)));return Oe(e,(r,n)=>r.system===n.system)}knownCodingsMatch(e){return _e(this.knownCodings,e.knownCodings,(t,r)=>t.code===r.code&&t.system===r.system).length>0}get notes(){var e;return((e=this.resource.note)==null?void 0:e.map(t=>t.text))||[]}get onset(){var e,t,r;return this.resource.onsetAge?(e=this.resource.onsetAge.value)==null?void 0:e.toString():this.resource.onsetDateTime?u(this.resource.onsetDateTime):this.resource.onsetPeriod?u(this.resource.onsetPeriod.start):this.resource.onsetRange?u((r=(t=this.resource.onsetRange.low)==null?void 0:t.value)==null?void 0:r.toString()):ue(this.resource.onsetString)}get patient(){const e=m("Patient",this.resource.contained,this.includedResources,this.resource.subject.reference);if(e)return new w(e,this.includedResources)}get preferredCoding(){return M(C,this.resource.code)}get recordedDate(){return u(this.resource.recordedDate)}get recorded(){return u(this.resource.recordedDate)}get recorder(){var e;return(e=this.resource.recorder)==null?void 0:e.display}get severity(){return c(this.resource.severity)}get snomedCoding(){return f(p,this.resource.code)}get snomedCode(){var e;return(e=f(p,this.resource.code))==null?void 0:e.code}get snomedDisplay(){var e;return(e=f(p,this.resource.code))==null?void 0:e.display}get snomedSystem(){var e;return(e=f(p,this.resource.code))==null?void 0:e.system}get stages(){var e;return((e=this.resource.stage)==null?void 0:e.map(t=>{const r=c(t.summary),n=c(t.type);return`Summary: ${r}, Type: ${n}`}))||[]}get displayStatus(){function e(n){switch(n){case"active":case"recurrence":case"relapse":return"Active";case"inactive":case"remission":case"resolved":return"Inactive";default:return""}}function t(n){switch(n){case"confirmed":return"confirmed";case"unconfirmed":case"provisional":case"differential":return"unconfirmed";case"refuted":return"refuted";case"entered-in-error":return"entered-in-error";default:return""}}if(this.isSummaryResource)return e(this.clinicalStatusCode)||"Unknown";switch(t(this.verificationStatusCode)+e(this.clinicalStatusCode).toLowerCase()){case"unconfirmedactive":return"Pending";case"unconfirmedinactive":case"refutedactive":return"Unknown";case"confirmedinactive":return"Inactive";case"confirmedactive":return"Active";case"refutedinactive":return"Refuted";case"entered-in-error":return"Entered in Error";default:return"Unknown"}}get subjectID(){var t;const[,e]=((t=this.resource.subject.reference)==null?void 0:t.split("/"))||[];return e||""}get verificationStatus(){return c(this.resource.verificationStatus)}get verificationStatusCode(){var e,t;return(t=I((e=this.resource.verificationStatus)==null?void 0:e.coding,{system:O}))==null?void 0:t.code}}const Rt=["Active","Inactive","Entered in Error","Pending","Refuted","Unknown"],Tt=["Active","Inactive","Unknown"],C=[{system:p,checkForEnrichment:!0},{system:N,checkForEnrichment:!0},{system:p},{system:N},{system:de},{system:le},{system:he}];function Mt(s){const i={resourceType:"Condition",subject:{type:"Patient",reference:`Patient/${s}`},...W("Active")};return Ge(i)}function He(){return b(P,[],A(async(s,i)=>{try{const{bundle:e,resources:t}=await Q("Condition",s,{patientUPID:i.UPID});return Z(J(t,e))}catch(e){throw E.logError(e,`Failed fetching conditions for patient: ${i.UPID}`)}},"req.patient_conditions"))}function ze(){return b(X,[],A(async(s,i)=>{try{const{bundle:e,resources:t}=await me("Condition",s,{_revinclude:"Basic:subject",patientUPID:i.UPID});return Z(J(t,e))}catch(e){throw E.logError(e,`Failed fetching conditions outside for patient: ${i.UPID}`)}},"req.other_provider_conditions"))}function _t(){const[s,i]=L.useState([]),e=He(),t=ze();L.useEffect(()=>{const a=e.data??[],d=We(t.data??[],a,!0);i(d)},[e.data,t.data]);const r=e.isLoading||t.isLoading,n=e.isError||t.isError,o=e.isFetching||t.isFetching;return{isLoading:r,isError:n,isFetching:o,data:s}}const Ve=s=>({request:{method:"GET",url:`/Condition/${s}/_history`}}),Ke=async(s,i)=>{const t=(await Q("Condition",s,i)).resources.map(n=>n.id);if(!t.length)return;const r={resourceType:"Bundle",id:"bundle-history-conditions",type:"batch",entry:t.map(n=>Ve(n))};return s.fhirClient.batch({body:{...r,type:"batch"}})};function bt(s){return b(ye,[s],A(async(i,e)=>{if(s){if(s.verificationStatus==="entered-in-error")return{conditions:[],bundle:{resourceType:"Bundle",entry:[]}};try{const t=s.knownCodings.map(l=>`${l.system}|${l.code}`),r={patientUPID:e.UPID,_include:["Condition:patient","Condition:encounter"],"_include:iterate":"Patient:organization"};t.length>0?r.code=t.join(","):r._id=s.id;const{resources:n,bundle:o}=await ge("Condition",i,r),a=await Ke(i,r),d=[];return a&&a.entry&&a.entry.forEach(l=>{const{resource:y}=l;(y==null?void 0:y.resourceType)==="Bundle"&&y.entry&&d.push(...y.entry)}),{conditions:n.concat(...R(d.map(l=>l.resource))),bundle:o}}catch(t){throw E.logError(t,`Failed fetching condition history for patient: ${e.UPID}}`)}}},"req.condition_history"),!!s)}function J(s,i){const e=fe(i);return s.map(t=>new Qe(t,void 0,e.get(t.id??"")))}function Z(s){return k(s.filter(i=>{var e;return((e=i.resource.asserter)==null?void 0:e.type)!=="Patient"}),["resource.recordedDate","display"],["desc"])}const Pt=async(s,i)=>{if(!s.id)throw new Error("Tried to edit a resource that hasn't been created yet.");const e=H(s);if(e.verificationStatus={coding:[{code:"entered-in-error",system:O}]},delete e.clinicalStatus,(await j(e,i)).id)E.reportActionSuccess("delete_condition");else throw E.reportActionFailure("delete_condition"),new Error(`Failed to edit resource with id of ${s.id}`);await _.invalidateQueries([P])},We=(s,i,e)=>s.filter(t=>t.isArchived&&!e||["FAC","XXX"].includes(t.ccsChapterCode??"")?!1:!i.some(r=>{const n=t.resource.recordedDate,o=r.resource.recordedDate,a=t.knownCodingsMatch(r),d=r.verificationStatus==="entered-in-error",S=!n||o&&n<=o,l=t.clinicalStatus===r.clinicalStatus;return a&&!d&&(S||l)})),Je=s=>typeof s=="string"?s===$:(s==null?void 0:s.system)===$,Ze={NI:{display:"NoInformation",level:1},INV:{display:"invalid",level:2},DER:{display:"derived",level:3},OTH:{display:"other",level:3},NINF:{display:"negative infinity",level:4},PINF:{display:"positive infinity",level:4},UNC:{display:"un-encoded",level:3},MSK:{display:"masked",level:2},NA:{display:"not applicable",level:2},UNK:{display:"unknown",level:2},ASKU:{display:"asked but unknown",level:3},NAV:{display:"temporarily unavailable",level:4},NASK:{display:"not asked",level:3},NAVU:{display:"Not available",level:3},QS:{display:"Sufficient Quantity",level:3},TRC:{display:"trace",level:3},NP:{display:"not present",level:1}};class Ot extends g{constructor(){super(...arguments);h(this,"kind","DiagnosticReport")}get category(){var r,n,o,a;const e=c((r=this.resource.category)==null?void 0:r[0])||this.reportCategory;if(e)return e;const t=c((n=this.resource.category)==null?void 0:n[0]);return((a=m("Observation",void 0,this.includedResources,(o=this.resource.result)==null?void 0:o[0].reference))==null?void 0:a.category)??`No display value found ${t?" for ":""}${t}`}get displayName(){var r;const{code:e}=this.resource,t=c(e);return Je((r=e.coding)==null?void 0:r[0])?z(Ze,[t,"display"],"Unknown"):t}get effectiveEnd(){var e;return(e=this.resource.effectivePeriod)!=null&&e.end?u(this.resource.effectivePeriod.end):this.effectiveStart}get identifier(){var e;return((e=this.resource.identifier)==null?void 0:e[0].value)??""}get effectiveStart(){var e;return u(((e=this.resource.effectivePeriod)==null?void 0:e.start)||this.resource.effectiveDateTime)}get performer(){var e,t;return((e=this.organization)==null?void 0:e.display)||((t=this.resource.performer)==null?void 0:t[0].display)}get organization(){const e=this.resource.performer??[];return I(e,{type:"Organization"})}get reportCategory(){var e;return((e=M([{system:pe},{system:p}],this.resource.code))==null?void 0:e.display)??c(this.resource.code)}get results(){return this.resource.result??[]}}const et={active:"Currently taking","entered-in-error":"Never taken","not-taken":"Prescribed, not taken",completed:"No longer taking","on-hold":"On hold",intended:"Intend to take",stopped:"No longer taking"};function x(s,i){var t;if(s.medicationCodeableConcept)return s.medicationCodeableConcept;const e=m("Medication",s.contained,i,(t=s.medicationReference)==null?void 0:t.reference);return e==null?void 0:e.code}function F(s,i){var e;return(e=U(s,i))==null?void 0:e.code}function U(s,i){var r,n;const e=x(s,i),t=(r=e==null?void 0:e.coding)==null?void 0:r.find(o=>o.system===q&&o.extension===void 0);return t||((n=e==null?void 0:e.coding)==null?void 0:n.find(o=>{var a;return o.system===q&&((a=o.extension)==null?void 0:a.some(d=>d.url===Se&&d.valueString==="Standardization"))}))}function ee(s,i){var r,n,o,a;const e=U(s,i);if(e!=null&&e.display)return e.display;const t=x(s,i);return t!=null&&t.text?t.text:((n=(r=t==null?void 0:t.coding)==null?void 0:r.find(d=>d.display))==null?void 0:n.display)??`${(o=t==null?void 0:t.coding)==null?void 0:o[0].code} (${(a=t==null?void 0:t.coding)==null?void 0:a[0].system})`}function te(s,i){var t,r,n;let e;switch(s.resourceType){case"MedicationAdministration":case"MedicationDispense":e=(r=(t=s.performer)==null?void 0:t[0])==null?void 0:r.actor;break;case"MedicationRequest":e=s.performer||((n=s.dispenseRequest)==null?void 0:n.performer);break;case"MedicationStatement":default:return}if(e!=null&&e.reference&&e.type==="Organization")return m("Organization",s.contained,i,e.reference)}function tt(s){return z(et,s,"")}class rt extends g{constructor(){super(...arguments);h(this,"kind","MedicationDispense")}get includedPerformer(){var r,n,o,a;const e=(n=(r=this.resource.performer)==null?void 0:r[0])==null?void 0:n.actor.reference,t=m("Practitioner",this.resource.contained,this.includedResources,e);return t?new G(t).fullName:(a=(o=this.resource.performer)==null?void 0:o[0])==null?void 0:a.actor.display}get performer(){return te(this.resource,this.includedResources)}get performerDetails(){var t,r;const{performer:e}=this;return{name:(e==null?void 0:e.name)??"",address:((t=e==null?void 0:e.address)==null?void 0:t[0].text)??"",telecom:((r=e==null?void 0:e.telecom)==null?void 0:r[0].value)??""}}get status(){return this.resource.status}get quantityDisplay(){const{value:e,unit:t="units"}=this.resource.quantity||{};return e?`${e} ${t}`:void 0}get rxNorm(){return F(this.resource,this.includedResources)}get supplied(){const{value:e,unit:t="days"}=this.resource.daysSupply||{};return e?`${e} ${t}`:void 0}get medicationDisplayName(){return ee(this.resource,this.includedResources)}get whenHandedOver(){return u(this.resource.whenHandedOver)}get whenPrepared(){return u(this.resource.whenPrepared)}}class st extends g{constructor(){super(...arguments);h(this,"kind","MedicationAdministration")}get dosageDisplay(){const{text:e,route:t,dose:r}=this.resource.dosage||{};return e||v([r==null?void 0:r.value,r==null?void 0:r.unit]).join(" ")}get dosageRoute(){const{route:e}=this.resource.dosage||{};return e==null?void 0:e.text}get effectivePeriod(){const{start:e,end:t}=this.resource.effectivePeriod||{};return{start:e?u(e):"",end:t?u(t):""}}}class it extends g{constructor(){super(...arguments);h(this,"kind","MedicationRequest")}get authoredOn(){return u(this.resource.authoredOn)}get includedRequester(){var r,n;const e=(r=this.resource.requester)==null?void 0:r.reference,t=m("Practitioner",this.resource.contained,this.includedResources,e);return t?new G(t).fullName:(n=this.resource.requester)==null?void 0:n.display}get medicationDisplayName(){return ee(this.resource,this.includedResources)}get pharmacy(){var n,o,a;const{reference:e,display:t}=((n=this.resource.dispenseRequest)==null?void 0:n.performer)||{},r=m("Organization",this.resource.contained,this.includedResources,e);if(r){const d=(o=r.telecom)==null?void 0:o[0].value,{city:S,state:l,postalCode:y,text:re,line:se=[]}=((a=r.address)==null?void 0:a[0])||{},ie=v([S,`${l} ${y}`]).join(", ");return{telecom:d,name:r.name,address:re??v([se,ie]).join(`
`)}}return{name:t}}get rxNorm(){return F(this.resource,this.includedResources)}}class nt extends g{constructor(){super(...arguments);h(this,"kind","MedicationStatement");h(this,"builderPatientRxNormStatus")}get basedOn(){var e,t;return(t=(e=this.resource.basedOn)==null?void 0:e[0])==null?void 0:t.type}get category(){return c(this.resource.category)}get context(){var e;return(e=this.resource.context)==null?void 0:e.display}get dateAsserted(){return u(this.resource.dateAsserted)}set dateAsserted(e){e instanceof Date?this.resource.dateAsserted=D(e):this.resource.dateAsserted=e}get derivedFrom(){var e;return((e=this.resource.derivedFrom)==null?void 0:e.map(({display:t})=>t||""))||[]}get aggregatedFrom(){const e=we(t=>t.url===ve||t.url===Ne,this.resource.extension);return e!=null&&e.extension?v(e.extension.map(V("valueReference"))):v(this.resource.derivedFrom)}get display(){return c(x(this.resource,this.includedResources))}get dosage(){var e,t;return(t=(e=this.resource.dosage)==null?void 0:e[0])==null?void 0:t.text}get effectiveStart(){var e;return u((e=this.resource.effectivePeriod)==null?void 0:e.start)}get identifier(){var e,t;return(t=(e=this.resource.identifier)==null?void 0:e[0])==null?void 0:t.value}get informationSource(){return this.resource.informationSource||void 0}set informationSource(e){this.resource.informationSource=e}get medicationReference(){var e;return(e=this.resource.medicationReference)==null?void 0:e.display}get notesDisplay(){var e;return((e=this.resource.note)==null?void 0:e.map(({text:t})=>t))||[]}get partOf(){var e,t;return(t=(e=this.resource.partOf)==null?void 0:e[0])==null?void 0:t.display}get patientStatus(){var e;return tt((e=this.builderPatientRxNormStatus)==null?void 0:e[this.rxNorm??""])}get rxNorm(){return F(this.resource,this.includedResources)}get rxNormCodeableConcept(){const e=U(this.resource,this.includedResources);return{...e??{},display:(e==null?void 0:e.display)??this.display}}get reason(){var e;return c((e=this.resource.reasonCode)==null?void 0:e[0])}get reasonReference(){return this.resource.reasonReference}get isInactive(){return!["active","intended","unknown"].includes(this.status)}get status(){return this.resource.status}get displayStatus(){return this.isArchived?"Dismissed":Ae(this.resource.status)}get statusReason(){var e;return c((e=this.resource.statusReason)==null?void 0:e[0])}get subject(){return this.resource.subject}get subjectID(){var t;const[,e]=((t=this.resource.subject.reference)==null?void 0:t.split("/"))||[];return e||""}get patient(){const e=m("Patient",this.resource.contained,this.includedResources,this.resource.subject.reference);if(e)return new w(e,this.includedResources)}get lastFillDate(){var e,t;return u((t=(e=this.resource.extension)==null?void 0:e.find(r=>r.url===Ee))==null?void 0:t.valueDateTime)}get quantity(){var t,r;const e=(r=(t=this.resource.extension)==null?void 0:t.find(n=>n.url===Ce))==null?void 0:r.valueQuantity;if(e)return`${e.value} ${e.unit||""}`}get daysSupply(){var e,t,r,n;return(n=(r=(t=(e=this.resource.extension)==null?void 0:e.find(o=>o.url===De))==null?void 0:t.valueQuantity)==null?void 0:r.value)==null?void 0:n.toString()}get refills(){var e,t,r;return(r=(t=(e=this.resource.extension)==null?void 0:e.find(n=>n.url===Ie))==null?void 0:t.valueUnsignedInt)==null?void 0:r.toString()}get lastPrescriber(){var r,n;const e=(n=(r=this.resource.extension)==null?void 0:r.find(o=>o.url===Re))==null?void 0:n.valueReference;if(!(e!=null&&e.type)||!e.reference)return;const t=m(e.type,this.resource.contained,this.includedResources,e.reference);if(t!=null&&t.name){if(typeof t.name=="string")return t.name;const{family:o,given:a=[]}=t.name[0];return v([o,a[0]]).join(", ")}return e.display}get lastPrescribedDate(){var e,t;return u((t=(e=this.resource.extension)==null?void 0:e.find(r=>r.url===Te))==null?void 0:t.valueDateTime)}}class wt extends g{constructor(){super(...arguments);h(this,"kind","Medication")}get performer(){var e;return(e=te(this.resource,this.includedResources))==null?void 0:e.name}get status(){return this.resource.status}get dosage(){var e,t,r;switch(this.resource.resourceType){case"MedicationStatement":return(t=(e=this.resource.dosage)==null?void 0:e[0])==null?void 0:t.text;case"MedicationAdministration":return new st(this.resource,this.includedResources).dosageDisplay;case"MedicationDispense":case"MedicationRequest":return c((r=this.resource.dosageInstruction)==null?void 0:r[0]);default:return""}}get date(){var e,t,r,n,o,a;switch(this.resource.resourceType){case"MedicationStatement":return this.resource.dateAsserted??((e=this.resource.effectivePeriod)==null?void 0:e.start);case"MedicationAdministration":return(t=this.resource.effectivePeriod)==null?void 0:t.start;case"MedicationDispense":return this.resource.whenHandedOver??this.resource.whenPrepared;case"MedicationRequest":return this.resource.authoredOn??((a=(o=(n=(r=this.resource.dosageInstruction)==null?void 0:r[0].timing)==null?void 0:n.repeat)==null?void 0:o.boundsPeriod)==null?void 0:a.start);default:return""}}get dateLocal(){return u(this.date)}get patient(){var t;const e=m("Patient",this.resource.contained,this.includedResources,(t=this.resource.subject)==null?void 0:t.reference);if(e)return new w(e,this.includedResources)}get prescriber(){switch(this.resource.resourceType){case"MedicationStatement":return new nt(this.resource,this.includedResources).lastPrescriber;case"MedicationDispense":return new rt(this.resource,this.includedResources).includedPerformer;case"MedicationRequest":return new it(this.resource,this.includedResources).includedRequester;default:return}}}class At extends g{constructor(){super(...arguments);h(this,"kind","Observation")}get category(){var e;return c((e=this.resource.category)==null?void 0:e[0])}get display(){return c(this.resource.code)}get effectiveStart(){var e;return u(((e=this.resource.effectivePeriod)==null?void 0:e.start)||this.resource.effectiveDateTime)}get identifier(){var e;return((e=this.resource.identifier)==null?void 0:e[0].value)??""}get performer(){var e;return(e=this.resource.performer)==null?void 0:e[0].display}get value(){var e,t;return R([(e=this.resource.valueQuantity)==null?void 0:e.value,(t=this.resource.valueQuantity)==null?void 0:t.unit]).join("")}get interpretation(){var e;return c((e=this.resource.interpretation)==null?void 0:e[0])}get notes(){var e;return((e=this.resource.note)==null?void 0:e[0].text)??""}}function kt(s,i){const e=n=>o=>{const a=o[n];return!K(a)||!a?0:new Date(a).getTime()},t=[],r=[];return i.forEach(n=>{const{key:o,dir:a,isDate:d}=n;t.push(S=>Me(S[o]),d?e(o):o),r.push("asc",a)}),k(s,t,r)}function xt(s,i,e,t=!1){const r=K(i)?V(i):i;return t?ot(s,r,e):k(s,i,e)}function ot(s,i,e){return s.sort((t,r)=>{const n=i(t),o=i(r);if(!n&&!o)return 0;if(!n)return e==="asc"?-1:1;if(!o)return e==="asc"?1:-1;const a=new Date(n).getTime(),d=new Date(o).getTime();return e==="asc"?a-d:d-a}),s}export{Qe as C,Ot as D,nt as M,At as O,Mt as a,Rt as b,It as c,Pt as d,He as e,_t as f,Ge as g,kt as h,Je as i,wt as j,it as k,rt as l,F as m,st as n,Tt as o,xt as s,bt as u};

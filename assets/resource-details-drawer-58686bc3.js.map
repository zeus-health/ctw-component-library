{"version":3,"file":"resource-details-drawer-58686bc3.js","sources":["../../src/fhir/models/document.ts","../../src/components/content/resource/resource-details-drawer.tsx"],"sourcesContent":["import { codeableConceptLabel } from \"../codeable-concept\";\nimport { formatISODateStringToDate } from \"../formatters\";\nimport { FHIRModel } from \"./fhir-model\";\n\nexport class DocumentModel extends FHIRModel<fhir4.DocumentReference> {\n  get status(): string {\n    return this.resource.status;\n  }\n\n  get binaryID(): string | undefined {\n    const binaryID = this.resource.content[0].attachment.url;\n\n    if (binaryID) {\n      return binaryID.split(\"/\").pop();\n    }\n    return undefined;\n  }\n\n  get docStatus(): string | undefined {\n    return this.resource.docStatus;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get resourceTypeTitle(): string {\n    return \"Document\";\n  }\n\n  get title(): string | undefined {\n    return this.resource.content[0].attachment.title;\n  }\n\n  get dateCreated(): string | undefined {\n    return formatISODateStringToDate(\n      this.resource.content[0].attachment.creation\n    );\n  }\n\n  get custodian(): string | undefined {\n    return this.resource.custodian?.display;\n  }\n\n  get sectionDisplays(): string[] | undefined {\n    return (\n      this.resource.category?.map((coding) => codeableConceptLabel(coding)) ||\n      undefined\n    );\n  }\n}\n","import { useEffect, useState } from \"react\";\nimport { DocumentButton } from \"../CCDA/document-button\";\nimport { useCCDAModal } from \"../CCDA/modal-ccda\";\nimport {\n  Details,\n  DetailsProps,\n} from \"@/components/core/collapsible-data-list-details\";\nimport { Drawer } from \"@/components/core/drawer\";\nimport { Loading } from \"@/components/core/loading\";\nimport { useCTW } from \"@/components/core/providers/ctw-provider\";\nimport { useDrawer } from \"@/components/core/providers/drawer-provider\";\nimport { getBinaryId } from \"@/fhir/binaries\";\nimport { DocumentModel } from \"@/fhir/models/document\";\nimport { FHIRModel } from \"@/fhir/models/fhir-model\";\nimport { searchProvenances } from \"@/fhir/provenance\";\n\nexport type UseResourceDetailsDrawerProps<\n  T extends fhir4.Resource,\n  M extends FHIRModel<T>\n> = Pick<\n  ResourceDetailsDrawerProps<T, M>,\n  \"header\" | \"subHeader\" | \"getSourceDocument\" | \"details\"\n>;\n\nexport function useResourceDetailsDrawer<\n  T extends fhir4.Resource,\n  M extends FHIRModel<T>\n>(props: UseResourceDetailsDrawerProps<T, M>) {\n  const { openDrawer } = useDrawer();\n\n  return (model: M) => {\n    openDrawer({\n      component: (drawerProps) => (\n        <ResourceDetailsDrawer model={model} {...props} {...drawerProps} />\n      ),\n    });\n  };\n}\n\nexport type ResourceDetailsDrawerProps<\n  T extends fhir4.Resource,\n  M extends FHIRModel<T>\n> = {\n  className?: string;\n  model: M;\n  header: (model: M) => string | undefined;\n  subHeader?: (model: M) => string | undefined;\n  getSourceDocument?: boolean;\n  details: (model: M) => DetailsProps[\"data\"];\n  isOpen: boolean;\n  onClose: () => void;\n};\n\nexport function ResourceDetailsDrawer<\n  T extends fhir4.Resource,\n  M extends FHIRModel<T>\n>({\n  className,\n  model,\n  details,\n  header,\n  subHeader,\n  getSourceDocument,\n  isOpen,\n  onClose,\n}: ResourceDetailsDrawerProps<T, M>) {\n  const openCCDAModal = useCCDAModal();\n  const [isLoading, setIsLoading] = useState(false);\n  const [binaryId, setBinaryId] = useState<string>();\n  const { getRequestContext } = useCTW();\n\n  // We optionally look for any associated binary CCDAs\n  // if getSourceDocument is true.\n  useEffect(() => {\n    async function load() {\n      setIsLoading(true);\n      const requestContext = await getRequestContext();\n      const provenances = await searchProvenances(requestContext, [model]);\n      setBinaryId(getBinaryId(provenances, model.id));\n      setIsLoading(false);\n    }\n\n    if (model instanceof DocumentModel) {\n      // Special handling for document models\n      // which already have a binaryID.\n      setBinaryId(model.binaryID);\n    } else if (getSourceDocument) {\n      void load();\n    }\n  }, [getSourceDocument, model, getRequestContext]);\n\n  return (\n    <Drawer\n      className={className}\n      title={`${model.resourceTypeTitle} Details`}\n      isOpen={isOpen}\n      onClose={onClose}\n      showCloseFooter\n    >\n      <Drawer.Body>\n        <div className=\"ctw-py-2\">\n          <div className=\"ctw-text-2xl\">{header(model)}</div>\n          {subHeader && <div className=\"ctw-text-sm\">{subHeader(model)}</div>}\n        </div>\n\n        {isLoading ? (\n          <Loading message=\"Loading data...\" />\n        ) : (\n          <Details\n            data={details(model)}\n            documentButton={\n              binaryId && (\n                <DocumentButton\n                  onClick={() =>\n                    openCCDAModal(binaryId, model.resourceTypeTitle)\n                  }\n                  text=\"Source Document\"\n                />\n              )\n            }\n          />\n        )}\n      </Drawer.Body>\n    </Drawer>\n  );\n}\n"],"names":["DocumentModel","FHIRModel","binaryID","formatISODateStringToDate","_a","coding","codeableConceptLabel","useResourceDetailsDrawer","props","openDrawer","useDrawer","model","drawerProps","React","ResourceDetailsDrawer","className","details","header","subHeader","getSourceDocument","isOpen","onClose","openCCDAModal","useCCDAModal","isLoading","setIsLoading","useState","binaryId","setBinaryId","getRequestContext","useCTW","useEffect","load","requestContext","provenances","searchProvenances","getBinaryId","Drawer","Loading","Details","DocumentButton"],"mappings":"6XAIO,MAAMA,UAAsBC,CAAmC,CACpE,IAAI,QAAiB,CACnB,OAAO,KAAK,SAAS,MACvB,CAEA,IAAI,UAA+B,CACjC,MAAMC,EAAW,KAAK,SAAS,QAAQ,CAAC,EAAE,WAAW,IAErD,GAAIA,EACF,OAAOA,EAAS,MAAM,GAAG,EAAE,IAAI,CAGnC,CAEA,IAAI,WAAgC,CAClC,OAAO,KAAK,SAAS,SACvB,CAGA,IAAI,mBAA4B,CACvB,MAAA,UACT,CAEA,IAAI,OAA4B,CAC9B,OAAO,KAAK,SAAS,QAAQ,CAAC,EAAE,WAAW,KAC7C,CAEA,IAAI,aAAkC,CAC7B,OAAAC,EACL,KAAK,SAAS,QAAQ,CAAC,EAAE,WAAW,QAAA,CAExC,CAEA,IAAI,WAAgC,OAC3B,OAAAC,EAAA,KAAK,SAAS,YAAd,YAAAA,EAAyB,OAClC,CAEA,IAAI,iBAAwC,OAExC,QAAAA,EAAA,KAAK,SAAS,WAAd,YAAAA,EAAwB,IAAKC,GAAWC,EAAqBD,CAAM,KACnE,MAEJ,CACF,CCvBO,SAAAE,EAAAC,EAAA,CAIL,KAAA,CAAA,WAAAC,GAAAC,IAEA,OAAAC,GAAA,CACEF,EAAA,CAAW,UAAAG,GAAAC,EAAA,cAAAC,EAAA,CAAA,MAAAH,EAAA,GAAAH,EAAA,GAAAI,EAAA,CAE0D,CAAA,CAEpE,CAEL,CAgBO,SAAAE,EAAA,CAGL,UAAAC,EACA,MAAAJ,EACA,QAAAK,EACA,OAAAC,EACA,UAAAC,EACA,kBAAAC,EACA,OAAAC,EACA,QAAAC,CAEF,EAAA,CACE,MAAAC,EAAAC,IACA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,SAAA,EAAA,EACA,CAAAC,EAAAC,CAAA,EAAAF,EAAA,SAAA,EACA,CAAA,kBAAAG,GAAAC,IAIAC,OAAAA,EAAAA,UAAA,IAAA,CACE,eAAAC,GAAA,CACEP,EAAA,EAAA,EACA,MAAAQ,EAAA,MAAAJ,IACAK,EAAA,MAAAC,EAAAF,EAAA,CAAAtB,CAAA,CAAA,EACAiB,EAAAQ,EAAAF,EAAAvB,EAAA,EAAA,CAAA,EACAc,EAAA,EAAA,CAAkB,CAGpBd,aAAAX,EAGE4B,EAAAjB,EAAA,QAAA,EAA0BQ,GAE1Ba,EAAA,CACF,EAAA,CAAAb,EAAAR,EAAAkB,CAAA,CAAA,EAGFhB,EAAA,cACEwB,EAAC,CAAA,UAAAtB,EACC,MAAA,GAAAJ,EAAA,4BACgB,OAAAS,EAChB,QAAAC,EACA,gBAAA,EACe,EAAAR,EAAA,cAAAwB,EAAA,KAAA,KAAAxB,EAAA,cAAA,MAAA,CAAA,UAAA,YAAAA,EAAA,cAAA,MAAA,CAAA,UAAA,cAAA,EAAAI,EAAAN,CAAA,CAAA,EAAAO,GAAAL,EAAA,cAAA,MAAA,CAAA,UAAA,aAAA,EAAAK,EAAAP,CAAA,CAAA,CAAA,EAAAa,EAAAX,EAAA,cAAAyB,EAAA,CAAA,QAAA,iBAAA,CAAA,EAAAzB,EAAA,cAWX0B,EAAC,CAAA,KAAAvB,EAAAL,CAAA,EACoB,eAAAgB,GAAAd,EAAA,cAGf2B,EAAC,CAAA,QAAA,IAAAlB,EAAAK,EAAAhB,EAAA,iBAAA,EAEkD,KAAA,iBAE5C,CAAA,CACP,CAAA,CAAA,CAKV,CAGN"}
import{R as n}from"./index-6f814c40.js";import{c as b}from"./index-74f03c09.js";import{u as T}from"./resource-details-drawer-9d7a3644.js";import{V as D}from"./view-fhir-22599aea.js";import{C as P}from"./coding-list-1d7c950f.js";import{F as N,c as _,a as w,W as L,w as R,X as S,s as I,T as M,Y as V,u as F}from"./patient-helper-c6dfbaf2.js";import{T as U}from"./table-0bb423c6.js";import"./_baseToString-ba0098b0.js";import{c as p,o as q}from"./sortBy-64fcb484.js";import"./_baseClone-0c3bfcab.js";import"./sortBy-3860efd7.js";import"./_equalByTag-3aa7c076.js";import{h as W,d as x}from"./values-4e3b2a32.js";import"./_baseForOwn-56487e0e.js";import"./_createSet-3c80ad01.js";import{u as $}from"./patient-provider-b125b087.js";const u=({className:r,items:t,limit:e,total:i})=>n.createElement("div",{className:r},t.slice(0,e).map((a,s)=>n.createElement("div",{key:a+s},n.createElement("div",null,a))),i>e&&n.createElement("div",{className:"ctw-font-medium"},"+ ",i-e," more"));try{u.displayName="SimpleMoreList",u.__docgenInfo={description:"",displayName:"SimpleMoreList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"string[]"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},total:{defaultValue:null,description:"",name:"total",required:!0,type:{name:"number"}}}}}catch{}const y=(r=!0)=>{const t=[{title:"Date",widthPercent:10,minWidth:120,dataIndex:"periodStart"},{title:"Type",widthPercent:20,minWidth:150,render:e=>n.createElement("div",null,n.createElement("div",null,"Encounter"),n.createElement("div",null,e.typeDisplay))},{title:"Provider",widthPercent:25,minWidth:200,render:e=>{const{participant:i}=e.resource;if(!i||i.length===0)return null;const a=i.map(s=>{var c,d;const o=((c=s.individual)==null?void 0:c.display)??"";let l=((d=s.type)==null?void 0:d[0].text)??"";return["noinformation","unk"].includes(l.toLowerCase())&&(l=""),o&&l?`${o} (${l})`:o||l});return n.createElement("div",null,n.createElement(u,{items:a,limit:6,total:i.length}),n.createElement("div",null,e.location))}},{widthPercent:45,minWidth:250,render:e=>{const{diagnosis:i}=e.resource;return!i||i.length===0?null:n.createElement("div",null,n.createElement(u,{items:i.map(a=>a.condition.display??""),limit:3,total:i.length}))}}];return r&&t.push({widthPercent:10,minWidth:200,render:e=>n.createElement(D,{name:"Encounter Resource",resource:e.resource})}),t};try{y.displayName="patientTimelineColumns",y.__docgenInfo={description:"",displayName:"patientTimelineColumns",props:{}}}catch{}class j extends N{get class(){const{display:t,code:e}=this.resource.class;return t??e!=="UNK"?e:void 0}get diagnosis(){var e;const t=p((e=this.resource.diagnosis)==null?void 0:e.map(i=>i.condition.display));return t.length?t.join(", "):void 0}get dischargeDisposition(){var t;return _((t=this.resource.hospitalization)==null?void 0:t.dischargeDisposition)}get location(){var e;const t=p((e=this.resource.location)==null?void 0:e.map(i=>i.location.display));return t.length?t.join(", "):void 0}get participants(){var e;const t=p((e=this.resource.participant)==null?void 0:e.map(i=>{var a;return(a=i.individual)==null?void 0:a.display}));return t.length?t.join(", "):void 0}get periodEnd(){var t;return w((t=this.resource.period)==null?void 0:t.end)}get periodStart(){var t;return w((t=this.resource.period)==null?void 0:t.start)}get reason(){var e;const t=p((e=this.resource.reasonCode)==null?void 0:e.map(i=>_(i)));return t.length?t.join(", "):void 0}get status(){return this.resource.status}get typeCodings(){var t;return p(W((t=this.resource.type)==null?void 0:t.map(e=>e.coding)))}get typeDisplay(){var g,h,f,E;const{display:t,system:e}=this.resource.class,i=(this.resource.class.code??"").toUpperCase(),a=((f=(h=(g=this.resource.type)==null?void 0:g[0])==null?void 0:h.coding)==null?void 0:f[0])??{},{text:s}=((E=this.resource.type)==null?void 0:E[0])??{},o=(a.code??"").toUpperCase(),l=e===L,c=l?o:i;let d=l?s:t;const m={AMB:"Ambulatory",IMP:"Inpatient",EMER:"Emergency"};if(c&&Object.keys(m).includes(c)){const v=m[c];if(!d)return v;d.toLowerCase()!==v.toLowerCase()&&(d+=`, ${m[c]}`)}return d??"Unknown"}}function k(){return $(S,[],R(async(r,t)=>{try{const{bundle:e,resources:i}=await I("Encounter",r,{patientUPID:t.UPID});return A(i,e)}catch(e){throw M.logError(e,"Failed fetching timeline information for patient"),new Error(`Failed fetching timeline information for patient: ${e}`)}},"req.patient_encounters"))}function A(r,t){const e=V(t);return r.map(i=>new j(i,void 0,e.get(i.id??"")))}function C({className:r}){const t=k(),{featureFlags:e}=F(),i=T({header:s=>`${s.periodStart} - ${s.periodEnd}`,subHeader:s=>s.typeDisplay,getSourceDocument:!0,details:B}),a=q(t.data??[],[s=>{var o;return((o=s.resource.period)==null?void 0:o.start)??""}],["desc"]);return n.createElement("div",{className:b(r,"ctw-overflow-hidden")},n.createElement(U,{isLoading:t.isLoading,records:a,columns:y(e==null?void 0:e.enableViewFhirButton),handleRowClick:i}))}const B=r=>[{label:"Period Start",value:r.periodStart},{label:"Period End",value:r.periodEnd},{label:"Status",value:x(r.status)},{label:"Class",value:r.class},{label:"Type",value:r.typeCodings.length?n.createElement(P,{codings:r.typeCodings}):void 0},{label:"Location",value:r.location},{label:"Participants",value:r.participants},{label:"Reason",value:r.reason},{label:"Diagnosis",value:r.diagnosis},{label:"Discharge Disposition",value:r.dischargeDisposition}];try{C.displayName="PatientTimeline",C.__docgenInfo={description:"",displayName:"PatientTimeline",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"Argument"}},includeViewFhirResource:{defaultValue:null,description:"",name:"includeViewFhirResource",required:!1,type:{name:"boolean"}}}}}catch{}export{C as P};

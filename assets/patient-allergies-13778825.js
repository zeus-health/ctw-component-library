var B=Object.defineProperty;var L=(e,n,t)=>n in e?B(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var b=(e,n,t)=>(L(e,typeof n!="symbol"?n+"":n,t),t);import{R as o,r as M}from"./index-6f814c40.js";import{c as Y}from"./index-74f03c09.js";import{L as V,M as I,ab as T,ac as O,ad as U,T as $,N as j,ae as G,af as K,ag as Q,y as f,ah as W,F as x,c as p,H as S,z as X,ai as J,a6 as Z,aj as ee,K as te,b as ne}from"./patient-provider-45dff5f6.js";import{g as re,u as v,s as ae,V as ie,a as se}from"./view-fhir-1c9ee508.js";import"./_baseForOwn-b2e5e443.js";import"./sortBy-400dab6d.js";import{o as oe,c as P}from"./sortBy-a6efb69f.js";import"./_baseClone-39df8af0.js";import"./_baseIsEqual-f087c1ca.js";import{i as N}from"./isEqual-8b7b0b49.js";import"./_createSet-fb89f2da.js";import{e as l}from"./values-c66b9b7f.js";import{u as le,R as ue,a as ce}from"./use-filtered-sorted-data-13eb629a.js";import{w as de}from"./error-boundary-265fecd6.js";function me(){return[]}const A={};function pe({resourceType:e,model:n,queryKey:t,includeVersionHistory:a=!0,valuesToDedupeOn:r,getSearchParams:i,getHistoryEntry:u}){return V(t,[n],I(async(c,s)=>{try{const d={...i(n),patientUPID:s.UPID},{resources:C,bundle:F}=await T(e,c,d),k=O(F);let _=[];a&&(_=await ge(e,c,d));const z=n.constructor,E=[...C,..._].map(m=>new z(m,k)),R=fe(E,r).map(u),H=await U(c,E);return R.forEach(m=>{m.binaryId=re(H,m.id)}),R}catch(d){throw $.logError(d,`Failed fetching condition history for patient: ${s.UPID}}`)}},`req.${n.resourceType.toLowerCase()}_history`),!!n)}function fe(e,n){const t=oe(e,["isEnriched"],"desc");return v(t,(a,r)=>N(n(a),n(r)))}async function ge(e,n,t){const r=(await j(e,n,t)).resources.filter(s=>!D(s)),i=P(r.map(s=>s.id));if(!i.length)return[];const u={resourceType:"Bundle",id:`bundle-history-${e}`,type:"batch",entry:i.map(s=>({request:{method:"GET",url:`/${e}/${s}/_history`}}))};return G(await n.fhirClient.batch({body:{...u,type:"batch"}}),e).filter(s=>!D(s))}function D(e){var n;return!!("status"in e&&e.status==="entered-in-error"||"verificationStatus"in e&&ae((n=e.verificationStatus)==null?void 0:n.coding,{code:"entered-in-error"}))}function g(e){return pe({resourceType:"AllergyIntolerance",model:e,queryKey:K,includeVersionHistory:!1,valuesToDedupeOn:ve,getSearchParams:ye,getHistoryEntry:he})}function ye(e){const n=e.knownCodings.map(a=>`${a.system}|${a.code}`),t={_include:["AllergyIntolerance:patient"],"_include:iterate":"Patient:organization"};return n.length>0?t.code=n.join(","):t._id=e.id,t}function he(e){const n=[{label:"Status",value:e.clinicalStatus},{label:"Type",value:l(e.type)},{label:"Category",value:l(e.categories)},{label:"Onset",value:e.onset},{label:"Manifestation",value:l(e.manifestations)},{label:"Severity",value:l(e.severity)},{label:"Note",value:e.note}];return{id:e.id,date:e.recordedDate,versionId:e.versionId,title:e.managingOrganization,details:n}}const ve=e=>[e.recordedDate,e.managingOrganization,e.clinicalStatus,e.categories,e.onset,e.manifestations,e.severity,e.note,e.knownCodings.map(n=>[n.system,n.code])];try{g.displayName="useAllergiesHistory",g.__docgenInfo={description:"",displayName:"useAllergiesHistory",props:{kind:{defaultValue:null,description:"",name:"kind",required:!0,type:{name:'"Allergy"'}},categories:{defaultValue:null,description:"",name:"categories",required:!0,type:{name:"string | undefined"}},resourceTypeTitle:{defaultValue:null,description:"",name:"resourceTypeTitle",required:!0,type:{name:"string"}},clinicalStatus:{defaultValue:null,description:"",name:"clinicalStatus",required:!0,type:{name:"string"}},display:{defaultValue:null,description:"",name:"display",required:!0,type:{name:"string | undefined"}},manifestations:{defaultValue:null,description:"",name:"manifestations",required:!0,type:{name:"string"}},managingOrganization:{defaultValue:null,description:"",name:"managingOrganization",required:!0,type:{name:"string | undefined"}},note:{defaultValue:null,description:"",name:"note",required:!0,type:{name:"string | undefined"}},severity:{defaultValue:null,description:"",name:"severity",required:!0,type:{name:"string | undefined"}},knownCodings:{defaultValue:null,description:"",name:"knownCodings",required:!0,type:{name:"Coding[]"}},onset:{defaultValue:null,description:"",name:"onset",required:!0,type:{name:"string | undefined"}},recordedDate:{defaultValue:null,description:"",name:"recordedDate",required:!0,type:{name:"string | undefined"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"string"}},resource:{defaultValue:null,description:"",name:"resource",required:!0,type:{name:"AllergyIntolerance"}},includedResources:{defaultValue:null,description:"",name:"includedResources",required:!1,type:{name:"ResourceMap"}},revIncludes:{defaultValue:null,description:"",name:"revIncludes",required:!1,type:{name:"Resource[]"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},versionId:{defaultValue:null,description:"",name:"versionId",required:!0,type:{name:"string"}},isArchived:{defaultValue:null,description:"",name:"isArchived",required:!0,type:{name:"boolean"}},isSummaryResource:{defaultValue:null,description:"",name:"isSummaryResource",required:!0,type:{name:"boolean"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"string"}},getBasicResourceByAction:{defaultValue:null,description:"",name:"getBasicResourceByAction",required:!0,type:{name:"(profileAction: string) => Basic | undefined"}},isEnriched:{defaultValue:null,description:"",name:"isEnriched",required:!0,type:{name:"() => boolean"}},toString:{defaultValue:null,description:"",name:"toString",required:!1,type:{name:"() => string"}}}}}catch{}const y={display:"Date (New to Old)",sorts:[{key:"recordedDate",dir:"desc",isDate:!0}]},_e=[y,{display:"Date (Old to New)",sorts:[{key:"recordedDate",dir:"asc",isDate:!0}]}],h=(e=!1)=>{const n=[{title:"Name",render:t=>o.createElement("div",null,o.createElement("div",{className:"ctw-font-medium"},l(t.display)," "))},{title:"Last Updated",render:t=>o.createElement("div",null,o.createElement("div",{className:"ctw-font-medium"},t.recordedDate," "),o.createElement("div",null,t.managingOrganization))},{title:"Details",render:t=>o.createElement("div",null,!!t.manifestations&&t.manifestations!=="unknown"&&o.createElement("div",{className:"ctw-font-medium"},"Reaction: ",l(t.manifestations)))}];return e&&n.push({widthPercent:10,minWidth:200,render:t=>o.createElement(ie,{name:"Allergy Resource",resource:t.resource})}),n};try{h.displayName="patientAllergiesColumns",h.__docgenInfo={description:"",displayName:"patientAllergiesColumns",props:{}}}catch{}function Ee(e){var n,t;return e.onsetAge?Q(e.onsetAge):e.onsetDateTime?f(e.onsetDateTime):e.onsetPeriod?f(e.onsetPeriod.start):e.onsetRange?f((t=(n=e.onsetRange.low)==null?void 0:n.value)==null?void 0:t.toString()):W(e.onsetString)}class Re extends x{constructor(){super(...arguments);b(this,"kind","Allergy")}get categories(){var t;return(t=this.resource.category)==null?void 0:t.join(", ")}get resourceTypeTitle(){return this.resource.resourceType.slice(0,7)}get clinicalStatus(){return p(this.resource.clinicalStatus)}get display(){return p(this.resource.code)}get manifestations(){var a;const t=[];return(a=this.resource.reaction)==null||a.forEach(r=>r.manifestation.forEach(i=>t.push(p(i)))),t.join(", ")}get managingOrganization(){var r,i,u;const t=S("Patient",this.resource.contained,this.includedResources,this.resource.patient.reference),a=(i=S("Organization",this.resource.contained,this.includedResources,(r=t==null?void 0:t.managingOrganization)==null?void 0:r.reference))==null?void 0:i.name;return((u=t==null?void 0:t.managingOrganization)==null?void 0:u.display)||a}get note(){let t;return this.resource.note&&(t=this.resource.note.map(a=>p(a)).join(", ")),t}get severity(){var t;return(t=this.resource.reaction)==null?void 0:t[0].severity}get knownCodings(){const t=P(Ae.map(r=>X(r.system,this.resource.code)));return v(t,(r,i)=>r.system===i.system)}get onset(){return Ee(this.resource)}get recordedDate(){return f(this.resource.recordedDate)}get type(){return this.resource.type??""}}const be=(e,n)=>{const t=e.map(r=>new Re(r,n));return v(t,(r,i)=>N(w(r),w(i)))},w=e=>[e.display];function Se(){return V(J,[],I(async(e,n)=>{try{const{bundle:t,resources:a}=await T("AllergyIntolerance",e,{patientUPID:n.UPID,_include:["AllergyIntolerance:patient"],"_include:iterate":"Patient:organization"}),r=O(t);return be(a,r)}catch{throw new Error(`Failed fetching allergies information for patient ${n.UPID}`)}},"req.patient_allergies"))}const Ae=[{system:Z},{system:ee},{system:te}];function De({className:e}){const n=M.useRef(null),{featureFlags:t}=ne(),a=Se(),{data:r,setFilters:i,setSort:u}=le({defaultFilters:A,defaultSort:y,records:a.data}),c=se({header:d=>l(d.display),details:we,getHistory:g,getSourceDocument:!0}),{isLoading:s}=a;return o.createElement("div",{className:Y(e,"ctw-scrollable-pass-through-height"),ref:n,"data-zus-telemetry-namespace":"Allergies"},o.createElement(ue,{filterOptions:{onChange:i,defaultState:A,filters:me()},sortOptions:{defaultSort:y,options:_e,onChange:u}}),o.createElement("div",{className:"ctw-scrollable-pass-through-height"},o.createElement(ce,{showTableHead:!0,isLoading:s,data:r,columns:h(t==null?void 0:t.enableViewFhirButton),onRowClick:c})))}const q=de(De,"PatientAllergies"),we=e=>[{label:"Recorded Date",value:e.recordedDate},{label:"Recording Organization",value:e.managingOrganization},{label:"Status",value:e.clinicalStatus},{label:"Type",value:l(e.type)},{label:"Category",value:l(e.categories)},{label:"Onset",value:e.onset},{label:"Manifestation",value:l(e.manifestations)},{label:"Severity",value:l(e.severity)},{label:"Note",value:e.note}];try{q.displayName="PatientAllergies",q.__docgenInfo={description:"",displayName:"PatientAllergies",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},enableFqs:{defaultValue:null,description:"",name:"enableFqs",required:!1,type:{name:"boolean"}}}}}catch{}export{q as P,pe as u};

var A=Object.defineProperty;var C=(e,t,r)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var d=(e,t,r)=>(C(e,typeof t!="symbol"?t+"":t,r),r);import{r as o,R as a}from"./index-6f814c40.js";import{c as S}from"./index-74f03c09.js";import{h as D,i as F,j as N,k as L,u as M,l as U,m as q,T as B,Q as V,w as j,n as z,H as W,R as $,o as K,C as Q,F as Y,a as O,b as J,c as Z,S as G}from"./patient-allergies-901acd6f.js";import"./_baseForOwn-6ce43847.js";import"./uniqWith-685cf819.js";import{c as X,T as ee}from"./table-22844cd0.js";import"./_baseClone-7e8cfb08.js";import"./_baseIsEqual-2f71925b.js";import"./_baseUniq-84bbc0a2.js";import{u as te}from"./uniq-d93d87c5.js";import"./action-list-ab4ca90d.js";import"./drawer-3e903764.js";import"./request-ce924112.js";import"./spinner-66aa4ba7.js";import{s as ae}from"./requests-e44e7c89.js";import"./_commonjsHelpers-042e6b4d.js";import"./extends-ed7e75b0.js";import"./_basePickBy-a6d7916f.js";import"./toNumber-6e4e7434.js";import"./index-d206d595.js";import"./mapValues-dc8f3697.js";import"./index-6de6b113.js";import"./debounce-5d5a9f7a.js";import"./data-list-254aa0b0.js";import"./isEqual-dc54df64.js";import"./isPlainObject-f4e3af75.js";import"./index-135b3e83.js";import"./requests-acac8a0c.js";function re(){const e=[];return e.push({key:"status",type:"select",icon:D,values:["initialize",{key:"in_progress",name:"in progress"},"error","done",{key:"done_with_errors",name:"done with errors "}],display:"status"},{key:"future_jobs",type:"tag",icon:F,display:"Exclude Future Jobs"}),e}const se={future_jobs:{key:"future_jobs",selected:!0,type:"tag"}};class ie{constructor(t,r){d(this,"kind","PatientHistory");d(this,"historyInfo");d(this,"patient");this.patient=t,this.historyInfo=r}get providers(){var t;return(t=this.historyInfo)==null?void 0:t.attributes.providers}get lastUpdatedAt(){var t;return N(new Date(Number((t=this.historyInfo)==null?void 0:t.attributes.lastUpdatedAt)*1e3),"M/d/yy h:mm a")}get key(){var t;return((t=this.historyInfo)==null?void 0:t.id)||""}get targetDate(){var t;return L((t=this.historyInfo)==null?void 0:t.attributes.targetDate)}get createdAt(){var t;if((t=this.historyInfo)!=null&&t.attributes.createdAt)return N(new Date(Number(this.historyInfo.attributes.createdAt)*1e3),"M/d/yy h:mm a")}}function ne(e,t,r,i){return M(V,[e,t,r,i],async c=>{try{const s=await U({requestContext:c,count:e,offset:t,status:r,excludeFutureJobs:i}),l=te(X(s.data.map(n=>n.relationships.patient.data.id)));if(!l.length)return{total:0,patients:[]};const m=await q(c,void 0,l),f=s.data.map(n=>{const w=m.patients.filter(h=>h.id===n.relationships.patient.data.id);return new ie(w[0],n)});return{hasNext:!!s.links.next,total:s.data.length,patients:f}}catch(s){throw B.logError(s,"Failed fetching patient history patients."),new Error(`Failed fetching patient history patients: ${s}`)}})}const b=j(({className:e,handleRowClick:t,pageSize:r=10,title:i="Patient History Request"})=>{const[c,s]=o.useState(1),[l,m]=o.useState([]),[f,n]=o.useState(),[w,h]=o.useState(!0),{data:{patients:g,total:k,hasNext:R}={},isFetching:E,isError:_}=ne(r,c-1,f,w),x=u=>{var v,P;h(!!((v=u.future_jobs)!=null&&v.selected)),(P=u.status)!=null&&P.selected&&typeof u.status.selected=="string"?n(u.status.selected.split(" ").join("_")):n(void 0)};return o.useEffect(()=>{!E&&g&&m(g)},[g,k,_,E]),o.useEffect(()=>{_&&m([])},[_,E]),a.createElement(z,{className:S("ctw-patients-table",e),"data-zus-telemetry-namespace":"PatientsTable"},a.createElement(W,{title:i}),a.createElement($,{filterOptions:{onChange:x,filters:re(),defaultState:se},className:"ctw-ml-2"}),a.createElement("div",{className:"ctw-overflow-hidden"},a.createElement(ee,{records:l,columns:oe,pageSize:r,handleRowClick:t,hidePagination:!0},a.createElement(K,{currentPage:c,setCurrentPage:s,hasNext:R}))))},"PatientsHistoryTable"),oe=[{title:"Last Queried",render:e=>a.createElement("div",null,e.lastUpdatedAt)},{title:"Target Date",render:e=>a.createElement("div",null,e.targetDate)},{title:"Name",render:e=>a.createElement(ce,{data:e})},{title:"Source",render:e=>{var t;return a.createElement("div",{className:"ctw-space-y-2"},(t=e.providers)==null?void 0:t.map(r=>{var i;return a.createElement("div",{key:`${(i=e.historyInfo)==null?void 0:i.id}-${r.service}`},a.createElement("div",{className:"ctw-w-fit  ctw-py-1	ctw-capitalize"},le(r.service)))}))}},{title:"Status",render:e=>{var t;return a.createElement("div",{className:"ctw-space-y-2"},(t=e.providers)==null?void 0:t.map(r=>a.createElement("div",{key:`${e.key}-${r.service}`},a.createElement("div",{className:"ctw-capitalize"},a.createElement(me,{status:r.status})))))}}],ce=({data:e})=>a.createElement("div",{className:"ctw-flex ctw-items-center"},a.createElement("div",null,a.createElement("div",{className:"ctw-flex ctw-space-x-1 ctw-font-medium"},a.createElement("div",{className:"ctw-max-w-xs"},e.patient.fullName),e.patient.resource.gender&&a.createElement("div",{className:"ctw-uppercase"},"(",e.patient.resource.gender[0],")")),a.createElement("div",{className:"ctw-text-content-lighter"},e.patient.dob," (",e.patient.age,")"))),le=e=>{switch(e.toLowerCase()){case"commonwell":return"EHR Network";case"surescripts":return"Medication History";default:return e}},me=({status:e})=>{switch(e){case"initialize":case"in_progress":return a.createElement(p,{status:e,className:"ctw-bg-caution-light ctw-text-caution-heading"});case"done":return a.createElement(p,{status:e,className:"ctw-bg-success-light ctw-text-success-dark"});case"error":case"done_with_errors":return a.createElement(p,{status:e,className:"ctw-bg-error-light ctw-text-error-text"});default:return a.createElement(p,{status:e})}},p=({status:e,className:t})=>a.createElement("div",{className:S("ctw-w-fit ctw-rounded-2xl ctw-px-3 ctw-py-1 ctw-font-medium",t)},e.split("_").join(" "));try{b.displayName="PatientHistoryTable",b.__docgenInfo={description:"",displayName:"PatientHistoryTable",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"Argument"}},handleRowClick:{defaultValue:null,description:"",name:"handleRowClick",required:!1,type:{name:"((row: PatientHistoryRequestModel) => void)"}},pageSize:{defaultValue:null,description:"",name:"pageSize",required:!1,type:{name:"number"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},getRowClasses:{defaultValue:null,description:"",name:"getRowClasses",required:!1,type:{name:"((row: PatientModel) => Argument)"}},onRowClick:{defaultValue:null,description:"",name:"onRowClick",required:!1,type:{name:"((row: PatientModel) => void)"}}}}}catch{}const Be={component:b,tags:["autodocs"],args:{},decorators:[(e,{args:t})=>a.createElement(Q,{env:"dev",authToken:Y,builderId:O},a.createElement(J,{patientID:Z,systemURL:G},a.createElement(e,{args:t})))]},y={...ae()};var T,H,I;y.parameters={...y.parameters,docs:{...(T=y.parameters)==null?void 0:T.docs,source:{originalSource:`{
  ...setupPatientHistoryMocks()
}`,...(I=(H=y.parameters)==null?void 0:H.docs)==null?void 0:I.source}}};const Ve=["Basic"];export{y as Basic,Ve as __namedExportsOrder,Be as default};

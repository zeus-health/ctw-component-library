var te=Object.defineProperty;var re=(s,t,e)=>t in s?te(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var x=(s,t,e)=>(re(s,typeof t!="symbol"?t+"":t,e),e);import{r as k}from"./index-6f814c40.js";import{g as se,e as B,u as _,c as Y}from"./patient-provider-1d2019d5.js";import{ak as ne,n as E,al as M,a0 as j,am as P,an as R,F as m,a as u,c,ab as h,ao as F,ap as T,aq as v,ar as L,as as ie,G as f,at as w,au as y,av as oe,aw as ae,ax as ce,w as O,e as q,T as C,a1 as ue,ay as de,s as le,az as he,aA as fe,a6 as U,aB as me,aC as ge,aD as ye,aE as pe,aF as Se,aG as ve,aH as Ce,aI as Ne,aJ as Ee,aK as De}from"./patient-helper-9cec045f.js";import"./_baseToString-4993715b.js";import{f as D,c as I,i as Ie,o as A}from"./sortBy-be5f7eb4.js";import"./_baseClone-25b1595e.js";import{c as $}from"./_basePickBy-239377e6.js";import"./sortBy-919d7262.js";import"./_equalByTag-aaf39779.js";import{b as Re,h as G}from"./_baseForOwn-d8306f34.js";import{p as Te}from"./getPrototypeOf-9c757e77.js";import"./_createSet-12ef9b81.js";import{q as b}from"./request-5a1df4c1.js";import{u as be}from"./uniqWith-f1edcb30.js";import{i as _e,N as Me}from"./null-flavor-e3af2468.js";import{b as S,g as Pe,h as X,j as we}from"./values-6943c5c5.js";import{i as Q}from"./isString-35d4a3f2.js";function Oe(s){return s===void 0}var Ae=Oe,xe="Expected a function";function ke(s){if(typeof s!="function")throw new TypeError(xe);return function(){var t=arguments;switch(t.length){case 0:return!s.call(this);case 1:return!s.call(this,t[0]);case 2:return!s.call(this,t[0],t[1]);case 3:return!s.call(this,t[0],t[1],t[2])}return!s.apply(this,t)}}var Fe=ke,Le=Re,Ue=Fe,Be=Te;function Ye(s,t){return Be(s,Ue(Le(t)))}var je=Ye;function qe(s){return $(s)}const z=s=>{let t="",e="";switch(s){case"Active":t="confirmed",e="active";break;case"Inactive":t="confirmed",e="inactive";break;case"Pending":t="unconfirmed",e="active";break;case"Refuted":t="refuted",e="inactive";break;case"Entered In Error":t="entered-in-error";break;default:throw Error("status is should be of type ConditionStatus")}return je({verificationStatus:{coding:[{system:P,code:t}]},...e&&{clinicalStatus:{coding:[{system:R,code:e}]}}},Ae)},Et=async(s,t,e,r)=>{const n=await r(),i={resourceType:"Condition",id:e.id,recorder:await se(n),...z(e.status),category:e.id&&s?s.resource.category:[{coding:[{system:ne,code:"problem-list-item",display:"Problem List Item"}]}],code:e.id&&s?s.codings:{coding:[{system:e.condition.system,code:e.condition.code,display:e.condition.display}],text:e.condition.display},...e.abatement&&{abatementDateTime:E(e.abatement)},onsetDateTime:E(e.onset),recordedDate:E(new Date),subject:{type:"Patient",reference:`Patient/${t}`},note:e.note?[{text:e.note}]:void 0},o=await B(i,n);return await Promise.all([b.invalidateQueries([M]),b.invalidateQueries([j])]),o},$e={INF:{fullName:"Certain Infectious and Parasitic Diseases",shortName:"Infectious and Parasitic Diseases"},NEO:{fullName:"Neoplasms",shortName:"Neoplasms"},BLD:{fullName:"Diseases of the Blood and Blood Forming Organs and Certain Disorders Involving the Immune Mechanism",shortName:"Blood Diseases"},END:{fullName:"Endocrine, Nutritional and Metabolic Diseases",shortName:"Endocrine, Nutritional and Metabolic"},MBD:{fullName:"Mental, Behavioral and Neurodevelopmental Disorders",shortName:"Mental and Behavioral"},NVS:{fullName:"Diseases of the Nervous System",shortName:"Nervous System"},EYE:{fullName:"Diseases of the Eye and Adnexa",shortName:"Eye and Adnexa"},EAR:{fullName:"Diseases of the Ear and Mastoid Process",shortName:"Ear and Mastoid Process"},CIR:{fullName:"Diseases of the Circulatory System",shortName:"Circulatory System"},RSP:{fullName:"Diseases of the Respiratory System",shortName:"Respiratory System"},DIG:{fullName:"Diseases of the Digestive System",shortName:"Digestive System"},SKN:{fullName:"Diseases of the Skin and Subcutaneous Tissue",shortName:"Skin and Subcutaneous Tissue"},MUS:{fullName:"Diseases of the Musculoskeletal System and Connective Tissue",shortName:"Musculoskeletal System"},GEN:{fullName:"Diseases of the Genitourinary System",shortName:"Genitourinary System"},PRG:{fullName:"Pregnancy, Childbirth and the Puerperium",shortName:"Pregnancy & Childbirth"},PNL:{fullName:"Certain Conditions Originating in the Perinatal Period",shortName:"Perinatal Conditions"},MAL:{fullName:"Congenital Malformations, Deformations and Chromosomal Abnormalities",shortName:"Malformations and Chromosomal Abnormalities"},SYM:{fullName:"Symptoms, Signs and Abnormal Clinical and Laboratory Findings",shortName:"Clinical Findings"},INJ:{fullName:"Injury, Poisoning and Certain Other Consequences of External Causes",shortName:"External Causes Injury"},EXT:{fullName:"External Causes of Morbidity",shortName:"External Morbidity"},FAC:{fullName:"Factors Influencing Health Status and Contact with Health Services",shortName:"Health Status Influences"},XXX:{fullName:"Unacceptable principal diagnosis (inpatient data) or first-listed diagnosis (outpatient data)",shortName:"Unacceptable principal diagnosis"}};class Ge extends m{get abatement(){var t,e,r;return this.resource.abatementAge?(t=this.resource.abatementAge.value)==null?void 0:t.toString():this.resource.abatementDateTime?u(this.resource.abatementDateTime):this.resource.abatementPeriod?u(this.resource.abatementPeriod.start):this.resource.abatementRange?u((r=(e=this.resource.abatementRange.low)==null?void 0:e.value)==null?void 0:r.toString()):this.resource.abatementString}get active(){var e;const t=D((e=this.resource.clinicalStatus)==null?void 0:e.coding,{system:R});return t!=null&&t.code?["active","recurrence","relapse"].includes(t.code):!1}get asserter(){var t;return(t=this.resource.asserter)==null?void 0:t.display}get bodySites(){var t;return((t=this.resource.bodySite)==null?void 0:t.map(e=>c(e)))||[]}get categories(){var t;return((t=this.resource.category)==null?void 0:t.map(e=>c(e)))||[]}get ccsChapter(){var e;const t=this.ccsChapterCode;if(t)return(e=$e[t])==null?void 0:e.shortName}get ccsChapterCode(){var t,e;return(e=(t=h(F,this.resource.code))==null?void 0:t.code)==null?void 0:e.slice(0,3)}get ccsGrouping(){var t;return(t=h(F,this.resource.code))==null?void 0:t.display}get clinicalStatus(){return c(this.resource.clinicalStatus)}get clinicalStatusCode(){var t,e;return(e=D((t=this.resource.clinicalStatus)==null?void 0:t.coding,{system:R}))==null?void 0:e.code}get codings(){return this.resource.code}get display(){var t;return((t=T(N,this.resource.code))==null?void 0:t.display)??c(this.resource.code)}get encounter(){var t;return(t=this.resource.encounter)==null?void 0:t.display}get evidences(){var t;return((t=this.resource.evidence)==null?void 0:t.map(e=>{var r;return c((r=e.code)==null?void 0:r[0])}))||[]}get icd10Code(){var t;return(t=h(v,this.resource.code))==null?void 0:t.code}get icd10System(){var t;return(t=h(v,this.resource.code))==null?void 0:t.system}get icd10Display(){var t;return(t=h(v,this.resource.code))==null?void 0:t.display}get isDeleted(){return this.verificationStatusCode==="entered-in-error"}get hasEnrichment(){const t=N.filter(r=>r.checkForEnrichment===!0);return I(t.map(r=>L(r.system,this.resource.code))).length>0}get knownCodings(){const t=I(N.map(r=>r.checkForEnrichment?L(r.system,this.resource.code):h(r.system,this.resource.code)));return be(t,(r,n)=>r.system===n.system)}knownCodingsMatch(t){return Ie(this.knownCodings,t.knownCodings,(e,r)=>e.code===r.code&&e.system===r.system).length>0}get notes(){var t;return((t=this.resource.note)==null?void 0:t.map(e=>e.text))||[]}get onset(){var t,e,r;return this.resource.onsetAge?(t=this.resource.onsetAge.value)==null?void 0:t.toString():this.resource.onsetDateTime?u(this.resource.onsetDateTime):this.resource.onsetPeriod?u(this.resource.onsetPeriod.start):this.resource.onsetRange?u((r=(e=this.resource.onsetRange.low)==null?void 0:e.value)==null?void 0:r.toString()):ie(this.resource.onsetString)}get patient(){const t=f("Patient",this.resource.contained,this.includedResources,this.resource.subject.reference);if(t)return new w(t,this.includedResources)}get preferredCoding(){return T(N,this.resource.code)}get recordedDate(){return u(this.resource.recordedDate)}get recorded(){return u(this.resource.recordedDate)}get recorder(){var t;return(t=this.resource.recorder)==null?void 0:t.display}get severity(){return c(this.resource.severity)}get snomedCoding(){return h(y,this.resource.code)}get snomedCode(){var t;return(t=h(y,this.resource.code))==null?void 0:t.code}get snomedDisplay(){var t;return(t=h(y,this.resource.code))==null?void 0:t.display}get snomedSystem(){var t;return(t=h(y,this.resource.code))==null?void 0:t.system}get stages(){var t;return((t=this.resource.stage)==null?void 0:t.map(e=>{const r=c(e.summary),n=c(e.type);return`Summary: ${r}, Type: ${n}`}))||[]}get displayStatus(){function t(n){switch(n){case"active":case"recurrence":case"relapse":return"Active";case"inactive":case"remission":case"resolved":return"Inactive";default:return""}}function e(n){switch(n){case"confirmed":return"confirmed";case"unconfirmed":case"provisional":case"differential":return"unconfirmed";case"refuted":return"refuted";case"entered-in-error":return"entered-in-error";default:return""}}if(this.isSummaryResource)return t(this.clinicalStatusCode)||"Unknown";switch(e(this.verificationStatusCode)+t(this.clinicalStatusCode).toLowerCase()){case"unconfirmedactive":return"Pending";case"unconfirmedinactive":case"refutedactive":return"Unknown";case"confirmedinactive":return"Inactive";case"confirmedactive":return"Active";case"refutedinactive":return"Refuted";case"entered-in-error":return"Entered in Error";default:return"Unknown"}}get subjectID(){var e;const[,t]=((e=this.resource.subject.reference)==null?void 0:e.split("/"))||[];return t||""}get verificationStatus(){return c(this.resource.verificationStatus)}get verificationStatusCode(){var t,e;return(e=D((t=this.resource.verificationStatus)==null?void 0:t.coding,{system:P}))==null?void 0:e.code}}const Dt=["Active","Inactive","Entered in Error","Pending","Refuted","Unknown"],It=["Active","Inactive","Unknown"],N=[{system:y,checkForEnrichment:!0},{system:v,checkForEnrichment:!0},{system:y},{system:v},{system:oe},{system:ae},{system:ce}];function Rt(s){const t={resourceType:"Condition",subject:{type:"Patient",reference:`Patient/${s}`},...z("Active")};return qe(t)}function Xe(){return _(M,[],O(async(s,t)=>{try{const{bundle:e,resources:r}=await q("Condition",s,{patientUPID:t.UPID});return W(H(r,e))}catch(e){throw C.logError(e,`Failed fetching conditions for patient: ${t.UPID}`)}},"req.patient_conditions"))}function Qe(){return _(j,[],O(async(s,t)=>{try{const{bundle:e,resources:r}=await de("Condition",s,{_revinclude:"Basic:subject",patientUPID:t.UPID});return W(H(r,e))}catch(e){throw C.logError(e,`Failed fetching conditions outside for patient: ${t.UPID}`)}},"req.other_provider_conditions"))}function Tt(){const[s,t]=k.useState([]),e=Xe(),r=Qe();k.useEffect(()=>{const a=e.data??[],d=We(r.data??[],a,!0);t(d)},[e.data,r.data]);const n=e.isLoading||r.isLoading,i=e.isError||r.isError,o=e.isFetching||r.isFetching;return{isLoading:n,isError:i,isFetching:o,data:s}}const ze=s=>({request:{method:"GET",url:`/Condition/${s}/_history`}}),He=async(s,t)=>{const r=(await q("Condition",s,t)).resources.map(i=>i.id);if(!r.length)return;const n={resourceType:"Bundle",id:"bundle-history-conditions",type:"batch",entry:r.map(i=>ze(i))};return s.fhirClient.batch({body:{...n,type:"batch"}})};function bt(s){return _(he,[s],O(async(t,e)=>{if(s){if(s.verificationStatus==="entered-in-error")return{conditions:[],bundle:{resourceType:"Bundle",entry:[]}};try{const r=s.knownCodings.map(l=>`${l.system}|${l.code}`),n={patientUPID:e.UPID,_include:["Condition:patient","Condition:encounter"],"_include:iterate":"Patient:organization"};r.length>0?n.code=r.join(","):n._id=s.id;const{resources:i,bundle:o}=await le("Condition",t,n),a=await He(t,n),d=[];return a&&a.entry&&a.entry.forEach(l=>{const{resource:g}=l;(g==null?void 0:g.resourceType)==="Bundle"&&g.entry&&d.push(...g.entry)}),{conditions:i.concat(...I(d.map(l=>l.resource))),bundle:o}}catch(r){throw C.logError(r,`Failed fetching condition history for patient: ${e.UPID}}`)}}},"req.condition_history"),!!s)}function H(s,t){const e=ue(t);return s.map(r=>new Ge(r,void 0,e.get(r.id??"")))}function W(s){return A(s.filter(t=>{var e;return((e=t.resource.asserter)==null?void 0:e.type)!=="Patient"}),["resource.recordedDate","display"],["desc"])}const _t=async(s,t)=>{if(!s.id)throw new Error("Tried to edit a resource that hasn't been created yet.");const e=$(s);if(e.verificationStatus={coding:[{code:"entered-in-error",system:P}]},delete e.clinicalStatus,(await B(e,t)).id)C.reportActionSuccess("delete_condition");else throw C.reportActionFailure("delete_condition"),new Error(`Failed to edit resource with id of ${s.id}`);await b.invalidateQueries([M])},We=(s,t,e)=>s.filter(r=>r.isArchived&&!e||["FAC","XXX"].includes(r.ccsChapterCode??"")?!1:!t.some(n=>{const i=r.resource.recordedDate,o=n.resource.recordedDate,a=r.knownCodingsMatch(n),d=n.verificationStatus==="entered-in-error",p=!i||o&&i<=o,l=r.clinicalStatus===n.clinicalStatus;return a&&!d&&(p||l)}));class Mt extends m{get category(){var r,n,i,o;const t=c((r=this.resource.category)==null?void 0:r[0])||this.reportCategory;if(t)return t;const e=c((n=this.resource.category)==null?void 0:n[0]);return((o=f("Observation",void 0,this.includedResources,(i=this.resource.result)==null?void 0:i[0].reference))==null?void 0:o.category)??`No display value found ${e?" for ":""}${e}`}get displayName(){var r;const{code:t}=this.resource,e=c(t);return _e((r=t.coding)==null?void 0:r[0])?G(Me,[e,"display"],"Unknown"):e}get effectiveEnd(){var t;return(t=this.resource.effectivePeriod)!=null&&t.end?u(this.resource.effectivePeriod.end):this.effectiveStart}get identifier(){var t;return((t=this.resource.identifier)==null?void 0:t[0].value)??""}get effectiveStart(){var t;return u(((t=this.resource.effectivePeriod)==null?void 0:t.start)||this.resource.effectiveDateTime)}get performer(){var t,e;return((t=this.organization)==null?void 0:t.display)||((e=this.resource.performer)==null?void 0:e[0].display)}get organization(){const t=this.resource.performer??[];return D(t,{type:"Organization"})}get reportCategory(){var t;return((t=T([{system:fe},{system:y}],this.resource.code))==null?void 0:t.display)??c(this.resource.code)}get results(){return this.resource.result??[]}}const Ke={active:"Currently taking","entered-in-error":"Never taken","not-taken":"Prescribed, not taken",completed:"No longer taking","on-hold":"On hold",intended:"Intend to take",stopped:"No longer taking"};function K(s,t){var r;if(s.medicationCodeableConcept)return s.medicationCodeableConcept;const e=f("Medication",s.contained,t,(r=s.medicationReference)==null?void 0:r.reference);return e==null?void 0:e.code}function Ve(s,t){var e;return(e=V(s,t))==null?void 0:e.code}function V(s,t){var n,i;const e=K(s,t),r=(n=e==null?void 0:e.coding)==null?void 0:n.find(o=>o.system===U&&o.extension===void 0);return r||((i=e==null?void 0:e.coding)==null?void 0:i.find(o=>{var a;return o.system===U&&((a=o.extension)==null?void 0:a.some(d=>d.url===me&&d.valueString==="Standardization"))}))}function J(s,t){var r,n,i;let e;switch(s.resourceType){case"MedicationAdministration":case"MedicationDispense":e=(n=(r=s.performer)==null?void 0:r[0])==null?void 0:n.actor;break;case"MedicationRequest":e=s.performer||((i=s.dispenseRequest)==null?void 0:i.performer);break;case"MedicationStatement":default:return}if(e!=null&&e.reference&&e.type==="Organization")return f("Organization",s.contained,t,e.reference)}function Je(s){return G(Ke,s,"")}class Ze extends m{get includedPerformer(){var r,n,i,o;const t=(n=(r=this.resource.performer)==null?void 0:r[0])==null?void 0:n.actor.reference,e=f("Practitioner",this.resource.contained,this.includedResources,t);return e?new Y(e).fullName:(o=(i=this.resource.performer)==null?void 0:i[0])==null?void 0:o.actor.display}get performer(){return J(this.resource,this.includedResources)}get performerDetails(){var e,r;const{performer:t}=this;return{name:(t==null?void 0:t.name)??"",address:((e=t==null?void 0:t.address)==null?void 0:e[0].text)??"",telecom:((r=t==null?void 0:t.telecom)==null?void 0:r[0].value)??""}}get status(){return this.resource.status}get quantityDisplay(){const{value:t,unit:e="units"}=this.resource.quantity||{};return t?`${t} ${e}`:void 0}get supplied(){const{value:t,unit:e="days"}=this.resource.daysSupply||{};return t?`${t} ${e}`:void 0}}class et extends m{get dosageDisplay(){const{text:t,route:e,dose:r}=this.resource.dosage||{};return t||S([r==null?void 0:r.value,r==null?void 0:r.unit]).join(" ")}get dosageRoute(){const{route:t}=this.resource.dosage||{};return t==null?void 0:t.text}get effectivePeriod(){const{start:t,end:e}=this.resource.effectivePeriod||{};return{start:t?u(t):"",end:e?u(e):""}}}class tt extends m{get includedRequester(){var r,n;const t=(r=this.resource.requester)==null?void 0:r.reference,e=f("Practitioner",this.resource.contained,this.includedResources,t);return e?new Y(e).fullName:(n=this.resource.requester)==null?void 0:n.display}get pharmacy(){var n,i,o;const{reference:t,display:e}=((n=this.resource.dispenseRequest)==null?void 0:n.performer)||{},r=f("Organization",this.resource.contained,this.includedResources,t);if(r){const a=(i=r.telecom)==null?void 0:i[0].value,{city:d,state:p,postalCode:l,text:g,line:Z=[]}=((o=r.address)==null?void 0:o[0])||{},ee=S([d,`${p} ${l}`]).join(", ");return{telecom:a,name:r.name,address:g??S([Z,ee]).join(`
`)}}return{name:e}}}class rt extends m{constructor(){super(...arguments);x(this,"builderPatientRxNormStatus")}get basedOn(){var e,r;return(r=(e=this.resource.basedOn)==null?void 0:e[0])==null?void 0:r.type}get category(){return c(this.resource.category)}get context(){var e;return(e=this.resource.context)==null?void 0:e.display}get dateAsserted(){return u(this.resource.dateAsserted)}set dateAsserted(e){e instanceof Date?this.resource.dateAsserted=E(e):this.resource.dateAsserted=e}get derivedFrom(){var e;return((e=this.resource.derivedFrom)==null?void 0:e.map(({display:r})=>r||""))||[]}get aggregatedFrom(){const e=Pe(r=>r.url===ge||r.url===ye,this.resource.extension);return e!=null&&e.extension?S(e.extension.map(X("valueReference"))):S(this.resource.derivedFrom)}get display(){return c(K(this.resource,this.includedResources))}get dosage(){var e,r;return(r=(e=this.resource.dosage)==null?void 0:e[0])==null?void 0:r.text}get effectiveStart(){var e;return u((e=this.resource.effectivePeriod)==null?void 0:e.start)}get identifier(){var e,r;return(r=(e=this.resource.identifier)==null?void 0:e[0])==null?void 0:r.value}get informationSource(){return this.resource.informationSource||void 0}set informationSource(e){this.resource.informationSource=e}get medicationReference(){var e;return(e=this.resource.medicationReference)==null?void 0:e.display}get notesDisplay(){var e;return((e=this.resource.note)==null?void 0:e.map(({text:r})=>r))||[]}get partOf(){var e,r;return(r=(e=this.resource.partOf)==null?void 0:e[0])==null?void 0:r.display}get patientStatus(){var e;return Je((e=this.builderPatientRxNormStatus)==null?void 0:e[this.rxNorm??""])}get rxNorm(){return Ve(this.resource,this.includedResources)}get rxNormCodeableConcept(){const e=V(this.resource,this.includedResources);return{...e??{},display:(e==null?void 0:e.display)??this.display}}get reason(){var e;return c((e=this.resource.reasonCode)==null?void 0:e[0])}get reasonReference(){return this.resource.reasonReference}get isInactive(){return!["active","intended","unknown"].includes(this.status)}get status(){return this.resource.status}get displayStatus(){return this.isArchived?"Dismissed":we(this.resource.status)}get statusReason(){var e;return c((e=this.resource.statusReason)==null?void 0:e[0])}get subject(){return this.resource.subject}get subjectID(){var r;const[,e]=((r=this.resource.subject.reference)==null?void 0:r.split("/"))||[];return e||""}get patient(){const e=f("Patient",this.resource.contained,this.includedResources,this.resource.subject.reference);if(e)return new w(e,this.includedResources)}get lastFillDate(){var e,r;return u((r=(e=this.resource.extension)==null?void 0:e.find(n=>n.url===pe))==null?void 0:r.valueDateTime)}get quantity(){var r,n;const e=(n=(r=this.resource.extension)==null?void 0:r.find(i=>i.url===Se))==null?void 0:n.valueQuantity;if(e)return`${e.value} ${e.unit||""}`}get daysSupply(){var e,r,n,i;return(i=(n=(r=(e=this.resource.extension)==null?void 0:e.find(o=>o.url===ve))==null?void 0:r.valueQuantity)==null?void 0:n.value)==null?void 0:i.toString()}get refills(){var e,r,n;return(n=(r=(e=this.resource.extension)==null?void 0:e.find(i=>i.url===Ce))==null?void 0:r.valueUnsignedInt)==null?void 0:n.toString()}get lastPrescriber(){var n,i;const e=(i=(n=this.resource.extension)==null?void 0:n.find(o=>o.url===Ne))==null?void 0:i.valueReference;if(!(e!=null&&e.type)||!e.reference)return;const r=f(e.type,this.resource.contained,this.includedResources,e.reference);if(r!=null&&r.name){if(typeof r.name=="string")return r.name;const{family:o,given:a=[]}=r.name[0];return S([o,a[0]]).join(", ")}return e.display}get lastPrescribedDate(){var e,r;return u((r=(e=this.resource.extension)==null?void 0:e.find(n=>n.url===Ee))==null?void 0:r.valueDateTime)}}class Pt extends m{get performer(){var t;return(t=J(this.resource,this.includedResources))==null?void 0:t.name}get status(){return this.resource.status}get dosage(){var t,e,r;switch(this.resource.resourceType){case"MedicationStatement":return(e=(t=this.resource.dosage)==null?void 0:t[0])==null?void 0:e.text;case"MedicationAdministration":return new et(this.resource,this.includedResources).dosageDisplay;case"MedicationDispense":case"MedicationRequest":return c((r=this.resource.dosageInstruction)==null?void 0:r[0]);default:return""}}get date(){var t,e,r,n,i,o;switch(this.resource.resourceType){case"MedicationStatement":return this.resource.dateAsserted??((t=this.resource.effectivePeriod)==null?void 0:t.start);case"MedicationAdministration":return(e=this.resource.effectivePeriod)==null?void 0:e.start;case"MedicationDispense":return this.resource.whenHandedOver??this.resource.whenPrepared;case"MedicationRequest":return this.resource.authoredOn??((o=(i=(n=(r=this.resource.dosageInstruction)==null?void 0:r[0].timing)==null?void 0:n.repeat)==null?void 0:i.boundsPeriod)==null?void 0:o.start);default:return""}}get dateLocal(){return u(this.date)}get patient(){var e;const t=f("Patient",this.resource.contained,this.includedResources,(e=this.resource.subject)==null?void 0:e.reference);if(t)return new w(t,this.includedResources)}get prescriber(){switch(this.resource.resourceType){case"MedicationStatement":return new rt(this.resource,this.includedResources).lastPrescriber;case"MedicationDispense":return new Ze(this.resource,this.includedResources).includedPerformer;case"MedicationRequest":return new tt(this.resource,this.includedResources).includedRequester;default:return}}}class wt extends m{get category(){var t;return c((t=this.resource.category)==null?void 0:t[0])}get display(){return c(this.resource.code)}get effectiveStart(){var t;return u(((t=this.resource.effectivePeriod)==null?void 0:t.start)||this.resource.effectiveDateTime)}get identifier(){var t;return((t=this.resource.identifier)==null?void 0:t[0].value)??""}get performer(){var t;return(t=this.resource.performer)==null?void 0:t[0].display}get value(){var t,e;return I([(t=this.resource.valueQuantity)==null?void 0:t.value,(e=this.resource.valueQuantity)==null?void 0:e.unit]).join("")}get interpretation(){var t;return c((t=this.resource.interpretation)==null?void 0:t[0])}get notes(){var t;return((t=this.resource.note)==null?void 0:t[0].text)??""}}function Ot(s,t){const e=i=>o=>{const a=o[i];return!Q(a)||!a?0:new Date(a).getTime()},r=[],n=[];return t.forEach(i=>{const{key:o,dir:a,isDate:d}=i;r.push(p=>De(p[o]),d?e(o):o),n.push("asc",a)}),A(s,r,n)}function At(s,t,e,r=!1){const n=Q(t)?X(t):t;return r?st(s,n,e):A(s,t,e)}function st(s,t,e){return s.sort((r,n)=>{const i=t(r),o=t(n);if(!i&&!o)return 0;if(!i)return e==="asc"?-1:1;if(!o)return e==="asc"?1:-1;const a=new Date(i).getTime(),d=new Date(o).getTime();return e==="asc"?a-d:d-a}),s}export{Ge as C,Mt as D,rt as M,wt as O,Rt as a,Dt as b,Et as c,_t as d,Xe as e,Tt as f,qe as g,Ot as h,Pt as i,Ve as j,tt as k,Ze as l,et as m,It as o,At as s,bt as u};

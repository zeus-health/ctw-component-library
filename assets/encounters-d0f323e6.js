var R=Object.defineProperty;var A=(e,r,t)=>r in e?R(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var q=(e,r,t)=>(A(e,typeof r!="symbol"?r+"":r,t),t);import{R as n,r as h}from"./index-6f814c40.js";import{D as O,e as L}from"./data-list-254aa0b0.js";import{D as N}from"./drawer-2856393a.js";import{u as Q,M as F,g as B,a as U,b as Y,s as x,c as j,d as k}from"./medication-history-0379edfb.js";import{L as K}from"./loading-c7ff698a.js";import{u as z}from"./resource-details-drawer-52eb6858.js";import{C as G}from"./coding-list-1d7c950f.js";import{u,a as H}from"./patient-provider-c798b9ef.js";import{w as d,aL as $,aM as W,aN as J,ay as w,aO as X,a6 as Z,a5 as ee,F as te,c as C,a as V,aP as ae,s as re,T as ie}from"./patient-helper-c9c408d6.js";import{M as I,i as ne}from"./observation-022b8790.js";import{h as se,j as oe}from"./values-2f84f633.js";import"./_baseToString-2a4c2757.js";import{c as g}from"./sortBy-1cabbe82.js";import"./_baseClone-184e5c2b.js";import"./sortBy-649a17b3.js";import"./_equalByTag-5ee6784b.js";import"./_baseForOwn-54d22bab.js";import{u as T}from"./uniq-789c9501.js";import"./_createSet-014fa0cf.js";function le(e,r){return e?[{label:"Status",value:e.displayStatus},{label:"Last Fill Date",value:e.lastFillDate},{label:"Quantity",value:e.quantity},{label:"Days Supply",value:e.daysSupply},{label:"Refills",value:e.refills},{label:"Instructions",value:e.dosage},{label:"Prescriber",value:r},{label:"Last Prescribed Date",value:e.lastPrescribedDate},...L("Note",e.notesDisplay)]:[]}const b=({medication:e,...r})=>{const{lastPrescriber:t,isLoading:a}=Q(e==null?void 0:e.resource),i=le(e,t);return n.createElement(N,{title:"Medication Details",...r,showCloseFooter:!0},n.createElement(N.Body,null,n.createElement("div",{className:"ctw-space-y-5"},n.createElement("div",{className:"ctw-flex ctw-justify-between ctw-space-x-8"},n.createElement("h3",{className:"ctw-m-0 ctw-text-3xl ctw-font-light"},e==null?void 0:e.display)),a&&n.createElement(K,null),!a&&n.createElement(O,{title:"Summary",data:i}),e&&n.createElement(F,{medication:e}))))};try{b.displayName="MedicationDrawer",b.__docgenInfo={description:"",displayName:"MedicationDrawer",props:{medication:{defaultValue:null,description:"",name:"medication",required:!1,type:{name:"MedicationStatementModel"}},onDismissal:{defaultValue:null,description:"",name:"onDismissal",required:!1,type:{name:"((m: MedicationStatementModel) => void)"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onOpen:{defaultValue:null,description:"",name:"onOpen",required:!1,type:{name:"(() => void)"}},onAfterOpen:{defaultValue:null,description:"",name:"onAfterOpen",required:!1,type:{name:"(() => void)"}}}}}catch{}function ue(){return u(Z,[{informationSourceNot:"Patient"}],d(j,"req.builder_medications"))}function de(){return u(ee,[{_revinclude:"Basic:subject"}],d(k,"req.active_medications"))}function Oe(){return u($,[{informationSourceNot:"Patient"}],d(B,"req.medication_requests_common"))}function Le(){return u(W,[{informationSourceNot:"Patient"}],d(U,"req.medication_dispense_common"))}function ce(e){return u(J,[e],d(Y,"req.medication_statement"))}function Qe(){const[e,r]=h.useState([]),[t,a]=h.useState([]),i=de(),s=ue();h.useEffect(()=>{var o,l;if((o=i.data)!=null&&o.bundle&&((l=s.data)!=null&&l.bundle)){const{medications:c,bundle:M}=i.data,{medications:v}=s.data,p=w(M),m=X([i.data.bundle,s.data.bundle]),y=x(c.map(f=>new I(f,m,p.get(f.id??""))),v.map(f=>new I(f,m,p.get(f.id??""))));r(y.builderMedications),a(y.otherProviderMedications)}},[i.data,s.data]);const _=s.isLoading||i.isLoading,D=s.isFetching||i.isFetching,E=s.isError||i.isError;return{isFetching:D,isLoading:_,isError:E,builderMedications:e,otherProviderMedications:t}}function Fe(){return z({header:e=>`${e.periodStart} - ${e.periodEnd}`,subHeader:e=>e.typeDisplay,getSourceDocument:!0,details:S})}const S=e=>{var r;return[{label:"Period Start",value:e.periodStart},{label:"Period End",value:e.periodEnd},{label:"Status",value:se(e.status)},{label:"Class",value:e.class},{label:"Type",value:e.typeCodings.length?n.createElement(G,{codings:e.typeCodings}):void 0},{label:"Location",value:e.location},{label:"Participants",value:e.participants},{label:"Reason",value:e.reason},{label:"Diagnosis",value:(r=e.diagnoses)==null?void 0:r.join(", ")},{label:"Discharge Disposition",value:e.dischargeDisposition}]};function Be(){const{openDrawer:e}=H();return r=>{e({component:t=>n.createElement(pe,{medicationEventModel:r,...t})})}}const pe=e=>{var a;const{medicationEventModel:r}=e,t=ce(r.rxNorm);return(a=t.data)!=null&&a.length?n.createElement(b,{medication:t.data[0],...e}):null};try{S.displayName="encounterData",S.__docgenInfo={description:"",displayName:"encounterData",props:{kind:{defaultValue:null,description:"",name:"kind",required:!0,type:{name:'"Encounter"'}},class:{defaultValue:null,description:"",name:"class",required:!0,type:{name:"string | undefined"}},diagnoses:{defaultValue:null,description:"",name:"diagnoses",required:!0,type:{name:"string[] | undefined"}},dischargeDisposition:{defaultValue:null,description:"",name:"dischargeDisposition",required:!0,type:{name:"string | undefined"}},location:{defaultValue:null,description:"",name:"location",required:!0,type:{name:"string | undefined"}},participants:{defaultValue:null,description:"",name:"participants",required:!0,type:{name:"string | undefined"}},periodEnd:{defaultValue:null,description:"",name:"periodEnd",required:!0,type:{name:"string | undefined"}},periodStart:{defaultValue:null,description:"",name:"periodStart",required:!0,type:{name:"string | undefined"}},reason:{defaultValue:null,description:"",name:"reason",required:!0,type:{name:"string | undefined"}},status:{defaultValue:null,description:"",name:"status",required:!0,type:{name:"enum",value:[{value:'"entered-in-error"'},{value:'"planned"'},{value:'"arrived"'},{value:'"triaged"'},{value:'"in-progress"'},{value:'"onleave"'},{value:'"finished"'},{value:'"cancelled"'},{value:'"unknown"'}]}},typeCodings:{defaultValue:null,description:"",name:"typeCodings",required:!0,type:{name:"Coding[]"}},typeDisplay:{defaultValue:null,description:"",name:"typeDisplay",required:!0,type:{name:"string | undefined"}},resource:{defaultValue:null,description:"",name:"resource",required:!0,type:{name:"Encounter"}},includedResources:{defaultValue:null,description:"",name:"includedResources",required:!1,type:{name:"ResourceMap"}},revIncludes:{defaultValue:null,description:"",name:"revIncludes",required:!1,type:{name:"Resource[]"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},versionId:{defaultValue:null,description:"",name:"versionId",required:!0,type:{name:"string"}},isArchived:{defaultValue:null,description:"",name:"isArchived",required:!0,type:{name:"boolean"}},isSummaryResource:{defaultValue:null,description:"",name:"isSummaryResource",required:!0,type:{name:"boolean"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"string"}},resourceTypeTitle:{defaultValue:null,description:"",name:"resourceTypeTitle",required:!0,type:{name:"string"}},getBasicResourceByAction:{defaultValue:null,description:"",name:"getBasicResourceByAction",required:!0,type:{name:"(profileAction: string) => Basic | undefined"}},isEnriched:{defaultValue:null,description:"",name:"isEnriched",required:!0,type:{name:"() => boolean"}},toString:{defaultValue:null,description:"",name:"toString",required:!1,type:{name:"() => string"}}}}}catch{}const P=({className:e,items:r,limit:t,total:a})=>n.createElement("div",{className:e},r.slice(0,t).map((i,s)=>n.createElement("div",{key:i+s},n.createElement("div",null,i))),a>t&&n.createElement("div",{className:"ctw-font-medium"},"+ ",a-t," more"));try{P.displayName="SimpleMoreList",P.__docgenInfo={description:"",displayName:"SimpleMoreList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"string[]"}},limit:{defaultValue:null,description:"",name:"limit",required:!0,type:{name:"number"}},total:{defaultValue:null,description:"",name:"total",required:!0,type:{name:"number"}}}}}catch{}class me extends te{constructor(){super(...arguments);q(this,"kind","Encounter")}get class(){const{display:t,code:a}=this.resource.class;return t??a!=="UNK"?a:void 0}get diagnoses(){var t;return g(T((t=this.resource.diagnosis)==null?void 0:t.map(a=>a.condition.display)))}get dischargeDisposition(){var t;return C((t=this.resource.hospitalization)==null?void 0:t.dischargeDisposition)}get location(){var a;const t=g((a=this.resource.location)==null?void 0:a.map(i=>i.location.display));return t.length?t.join(", "):void 0}get participants(){var a;const t=g(T((a=this.resource.participant)==null?void 0:a.map(i=>{var s;return(s=i.individual)==null?void 0:s.display})));return t.length?t.join(", "):void 0}get periodEnd(){var t;return V((t=this.resource.period)==null?void 0:t.end)}get periodStart(){var t;return V((t=this.resource.period)==null?void 0:t.start)}get reason(){var a;const t=g((a=this.resource.reasonCode)==null?void 0:a.map(i=>C(i)));return t.length?t.join(", "):void 0}get status(){return this.resource.status}get typeCodings(){var t;return g(oe((t=this.resource.type)==null?void 0:t.map(a=>a.coding)))}get typeDisplay(){var M,v,p,m;const{display:t,system:a}=this.resource.class,i=(this.resource.class.code??"").toUpperCase(),s=((p=(v=(M=this.resource.type)==null?void 0:M[0])==null?void 0:v.coding)==null?void 0:p[0])??{},{text:_}=((m=this.resource.type)==null?void 0:m[0])??{},D=(s.code??"").toUpperCase(),E=ne(a),o=E?D:i;let l=E?_:t;const c={AMB:"Ambulatory",IMP:"Inpatient",EMER:"Emergency"};if(o&&Object.keys(c).includes(o)){const y=c[o];if(!l)return y;l.toLowerCase()!==y.toLowerCase()&&(l+=`, ${c[o]}`)}return l??"Unknown"}}function Ue(){return u(ae,[],d(async(e,r)=>{try{const{bundle:t,resources:a}=await re("Encounter",e,{patientUPID:r.UPID});return ye(a,t)}catch(t){throw ie.logError(t,"Failed fetching timeline information for patient"),new Error(`Failed fetching timeline information for patient: ${t}`)}},"req.patient_encounters"))}function ye(e,r){const t=w(r);return e.map(a=>new me(a,void 0,t.get(a.id??"")))}export{me as E,b as M,P as S,Ue as a,Fe as b,Oe as c,Le as d,Be as e,Qe as u};

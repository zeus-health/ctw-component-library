{"version":3,"file":"conditions.stories-3564cc51.js","sources":["../../node_modules/@heroicons/react/outline/esm/DotsHorizontalIcon.js","../../src/components/content/conditions-no-patient.tsx","../../src/components/core/dropdown-menu.tsx","../../src/components/content/conditions-table-base.tsx","../../src/components/content/patient-history/patient-history-message.tsx","../../src/components/content/conditions.tsx","../../src/components/content/conditions/story-helpers/condition-form-drawer.ts","../../src/components/content/conditions/story-helpers/condition-table.ts","../../src/components/content/conditions/story-helpers/conditions.ts","../../src/components/content/conditions/conditions.stories.tsx"],"sourcesContent":["import * as React from \"react\";\n\nfunction DotsHorizontalIcon(props, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 2,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    ref: svgRef\n  }, props), /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z\"\n  }));\n}\n\nconst ForwardRef = React.forwardRef(DotsHorizontalIcon);\nexport default ForwardRef;","import cx from \"classnames\";\nimport { CautionAlert } from \"../core/alert\";\n\nexport function ConditionsNoPatient({ className }: { className?: string }) {\n  return (\n    <div className={cx(\"ctw-conditions\", className)}>\n      <div className=\"ctw-heading-container\">\n        <div className=\"ctw-title\">Conditions</div>\n      </div>\n      <div className=\"ctw-p-5\">\n        <CautionAlert header=\"Conditions Unavailable\">\n          <div>\n            We are unable to access Condition information for this patient.\n          </div>\n          <div>\n            Contact your system administrator or customer service for\n            assistance.\n          </div>\n        </CautionAlert>\n      </div>\n    </div>\n  );\n}\n","import { Menu } from \"@headlessui/react\";\nimport * as RadixDropdownMenu from \"@radix-ui/react-dropdown-menu\";\nimport cx from \"classnames\";\nimport { ReactNode, useState } from \"react\";\nimport { Loading } from \"./loading\";\nimport { useCTW } from \"./providers/ctw-provider\";\nimport \"./dropdown-menu.scss\";\n\nexport type MenuItem = {\n  name: string;\n  action: () => void;\n  className?: cx.Argument;\n};\n\nexport type DropdownMenuProps = {\n  children: ReactNode;\n  menuItems: MenuItem[];\n  telemetryNamespace?: string;\n  triggerClassName?: cx.Argument;\n};\n\nexport function DropdownMenu({\n  children,\n  menuItems,\n  triggerClassName,\n  telemetryNamespace = \"unknown\",\n}: DropdownMenuProps) {\n  const { ctwProviderRef } = useCTW();\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Wrap our menuItem's action so that we set loading\n  async function handleClick(menuItem: MenuItem) {\n    setIsLoading(true);\n    await menuItem.action();\n    setIsLoading(false);\n  }\n\n  return (\n    <Menu>\n      <RadixDropdownMenu.Root modal={false}>\n        <RadixDropdownMenu.Trigger\n          className={cx(\"ctw-btn-clear ctw-link\", triggerClassName)}\n          aria-label=\"dropdown\"\n        >\n          {isLoading && <Loading message=\"\" />}\n          {!isLoading && children}\n        </RadixDropdownMenu.Trigger>\n\n        <RadixDropdownMenu.Portal container={ctwProviderRef.current}>\n          <RadixDropdownMenu.Content\n            data-zus-telemetry-namespace={`Menu[${telemetryNamespace}]`}\n            // Prevent focus from closing menu, this fixes\n            // an issue with interactive testing where a \"click\"\n            // would fire twice, once for the mousedown and\n            // again for focus on the button being clicked.\n            onFocusOutside={(event) => event.preventDefault()}\n            className=\"ctw-dropdown-menu-container\"\n            collisionPadding={10}\n          >\n            <RadixDropdownMenu.Arrow asChild>\n              <div className=\"ctw-dropdown-menu-arrow\" />\n            </RadixDropdownMenu.Arrow>\n\n            {menuItems.map((menuItem) => (\n              <RadixDropdownMenu.Item\n                data-zus-telemetry-click={`Item[${menuItem.name}]`}\n                onClick={() => handleClick(menuItem)}\n                key={menuItem.name}\n                className={cx(menuItem.className, \"ctw-dropdown-menu-item\")}\n              >\n                {menuItem.name}\n              </RadixDropdownMenu.Item>\n            ))}\n          </RadixDropdownMenu.Content>\n        </RadixDropdownMenu.Portal>\n      </RadixDropdownMenu.Root>\n    </Menu>\n  );\n}\n","import { DotsHorizontalIcon } from \"@heroicons/react/outline\";\nimport { DropdownMenu, MenuItem } from \"../core/dropdown-menu\";\nimport { Table, TableBaseProps } from \"../core/table/table\";\nimport { TableColumn } from \"../core/table/table-helpers\";\nimport { ConditionModel } from \"@/fhir/models/condition\";\n\nexport type ConditionsTableBaseProps = {\n  className?: string;\n  conditions: ConditionModel[];\n  rowMenuActions: (condition: ConditionModel) => MenuItem[];\n  hideMenu: boolean;\n} & TableBaseProps<ConditionModel>;\n\nexport function ConditionsTableBase({\n  className,\n  conditions,\n  rowMenuActions,\n  hideMenu,\n  sort = { columnTitle: \"Last Recorded\", dir: \"desc\" },\n  onSort,\n  ...tableProps\n}: ConditionsTableBaseProps) {\n  const columns: TableColumn<ConditionModel>[] = [\n    {\n      title: \"Condition\",\n      dataIndex: \"display\",\n      widthPercent: 40,\n      minWidth: 320,\n      sortIndices: [{ index: \"display\" }, { index: \"recorded\", dir: \"desc\" }],\n    },\n    {\n      title: \"Category\",\n      dataIndex: \"ccsGrouping\",\n      widthPercent: 25,\n      minWidth: 192,\n      sortIndices: [{ index: \"ccsGrouping\" }, { index: \"display\", dir: \"asc\" }],\n    },\n    {\n      title: \"Status\",\n      render: (condition) => (\n        <div className=\"ctw-capitalize\">\n          <div className=\"ctw-text-content-black\">\n            {condition.clinicalStatus}\n          </div>\n          <div>\n            {condition.isArchived ? \"Archived\" : condition.verificationStatus}\n          </div>\n        </div>\n      ),\n      widthPercent: 17.5,\n      minWidth: 128,\n      sortIndices: [\n        { index: \"clinicalStatus\" },\n        { index: \"verificationStatus\" },\n        { index: \"recorded\", dir: \"desc\" },\n      ],\n    },\n    {\n      title: \"Last Recorded\",\n      dataIndex: \"recordedDate\",\n      widthPercent: 17.5,\n      minWidth: 132,\n      sortIndices: [{ index: \"recorded\" }, { index: \"display\", dir: \"asc\" }],\n    },\n  ];\n\n  if (!hideMenu) {\n    columns.push({\n      className: \"ctw-table-action-column\",\n      render: (condition: ConditionModel) => (\n        <DropdownMenu\n          menuItems={rowMenuActions(condition)}\n          telemetryNamespace=\"ConditionsTableBase\"\n        >\n          <DotsHorizontalIcon className=\"ctw-w-5\" />\n        </DropdownMenu>\n      ),\n    });\n  }\n\n  return (\n    <Table\n      className={className}\n      records={conditions}\n      columns={columns}\n      sort={sort}\n      onSort={onSort}\n      {...tableProps}\n    />\n  );\n}\n","import { withErrorBoundary } from \"@/components/core/error-boundary\";\n\nexport type PatientHistoryProps = {\n  readOnly: boolean;\n  onClick?: React.MouseEventHandler<HTMLButtonElement>;\n};\n\nexport const PatientHistoryMessage = withErrorBoundary(\n  ({ readOnly, onClick }: PatientHistoryProps) => (\n    <div\n      className=\"ctw-flex ctw-justify-center ctw-space-x-2 ctw-border ctw-border-solid ctw-border-divider-light ctw-p-5\"\n      data-zus-telemetry-namespace=\"PatientHistoryMessage\"\n    >\n      {readOnly ? (\n        <span>There are no condition records available.</span>\n      ) : (\n        <>\n          <div className=\"ctw-flex ctw-justify-center ctw-text-icon-default\">\n            Retrieve patient clinical history.\n          </div>\n          <button\n            type=\"button\"\n            className=\"ctw-btn-clear ctw-link\"\n            onClick={onClick}\n            data-zus-telemetry-click=\"Request records\"\n          >\n            Request Records\n          </button>\n        </>\n      )}\n    </div>\n  ),\n  \"PatientHistoryMessage\"\n);\n","import cx from \"classnames\";\nimport { useEffect, useRef, useState } from \"react\";\nimport {\n  DrawerFormWithFields,\n  FormActionTypes,\n  FormEntry,\n} from \"../core/form/drawer-form-with-fields\";\nimport { ModalConfirmDelete } from \"../core/modal-confirm-delete\";\nimport { useCTW } from \"../core/providers/ctw-provider\";\nimport { usePatient } from \"../core/providers/patient-provider\";\nimport { TableSort } from \"../core/table/table-helpers\";\nimport { ToggleControl } from \"../core/toggle-control\";\nimport { ConditionHeader } from \"./condition-header\";\nimport { useConditionHistory } from \"./condition-history/conditions-history-drawer\";\nimport { onConditionDelete, toggleArchive } from \"./conditions-helper\";\nimport { ConditionsNoPatient } from \"./conditions-no-patient\";\nimport { ConditionsTableBase } from \"./conditions-table-base\";\nimport \"./conditions.scss\";\nimport { filterOtherConditions } from \"./conditions/helpers\";\nimport {\n  createOrEditCondition,\n  getAddConditionWithDefaults,\n} from \"./forms/actions/conditions\";\nimport { getAddConditionData } from \"./forms/schemas/condition-schema\";\nimport { PatientHistoryMessage } from \"./patient-history/patient-history-message\";\nimport { PatientHistoryStatus } from \"./patient-history/patient-history-message-status\";\nimport { usePatientHistory } from \"./patient-history/use-patient-history\";\nimport {\n  conditionAddSchema,\n  conditionEditSchema,\n  getEditingPatientConditionData,\n} from \"@/components/content/forms/schemas/condition-schema\";\nimport { withErrorBoundary } from \"@/components/core/error-boundary\";\nimport {\n  getNewCondition,\n  useOtherProviderConditions,\n  usePatientConditions,\n} from \"@/fhir/conditions\";\nimport { formatISODateStringToDate } from \"@/fhir/formatters\";\nimport { ConditionModel } from \"@/fhir/models/condition\";\nimport { useBreakpoints } from \"@/hooks/use-breakpoints\";\nimport { AnyZodSchema } from \"@/utils/form-helper\";\nimport { curry } from \"@/utils/nodash\";\n\nexport type ConditionsProps = {\n  className?: string;\n  readOnly?: boolean;\n  hideRequestRecords?: boolean;\n};\n\nconst EMPTY_MESSAGE_PATIENT_RECORD =\n  \"There are no conditions in this patient's record.\";\nconst EMPTY_MESSAGE_PROVIDER = \"There are no conditions available.\";\nconst ERROR_MSG =\n  \"There was an error fetching conditions for this patient. Refresh the page or contact your organization's technical support if this issue persists.\";\n\nexport const Conditions = withErrorBoundary(\n  ({\n    className,\n    readOnly = false,\n    hideRequestRecords = false,\n  }: ConditionsProps) => {\n    const containerRef = useRef<HTMLDivElement>(null);\n    const breakpoints = useBreakpoints(containerRef);\n    const [drawerIsOpen, setDrawerIsOpen] = useState(false);\n    const [showConfirmDelete, setShowConfirmDelete] = useState(false);\n\n    const showConditionHistory = useConditionHistory();\n    const [patientRecords, setPatientRecords] = useState<ConditionModel[]>([]);\n    const [otherProviderRecords, setOtherProviderRecords] = useState<\n      ConditionModel[]\n    >([]);\n    const [includeInactive, setIncludeInactive] = useState(false);\n    const [formAction, setFormAction] = useState<FormActionTypes>(\"Add\");\n    const [schema, setSchema] = useState<AnyZodSchema>(conditionAddSchema);\n    const [currentSelectedData, setCurrentlySelectedData] =\n      useState<FormEntry[]>();\n    const [selectedCondition, setSelectedCondition] =\n      useState<ConditionModel>();\n    const patientResponse = usePatient();\n    const patientRecordsResponse = usePatientConditions();\n    const otherProviderRecordsResponse = useOtherProviderConditions();\n    const { getRequestContext } = useCTW();\n    const [sort, setSort] = useState<TableSort>();\n\n    const patientRecordsMessage = patientRecordsResponse.isError\n      ? ERROR_MSG\n      : EMPTY_MESSAGE_PATIENT_RECORD;\n\n    const otherProviderRecordMessage = otherProviderRecordsResponse.isError\n      ? ERROR_MSG\n      : EMPTY_MESSAGE_PROVIDER;\n\n    const handleEditCondition = (condition: ConditionModel) => {\n      if (patientResponse.data) {\n        setDrawerIsOpen(true);\n        setFormAction(\"Edit\");\n        setSchema(conditionEditSchema);\n        setCurrentlySelectedData(getEditingPatientConditionData({ condition }));\n        setSelectedCondition(condition);\n      }\n    };\n\n    const handleConditionDelete = (condition: ConditionModel) => {\n      setShowConfirmDelete(true);\n      setSelectedCondition(condition);\n    };\n\n    const handleAddOtherProviderCondition = (condition: ConditionModel) => {\n      const newCondition = getAddConditionWithDefaults(condition.resource);\n\n      if (patientResponse.data) {\n        setSchema(conditionAddSchema);\n        setDrawerIsOpen(true);\n        setFormAction(\"Add\");\n        setCurrentlySelectedData(\n          getAddConditionData({\n            condition: new ConditionModel(newCondition),\n          })\n        );\n      }\n    };\n\n    const handleAddNewCondition = () => {\n      if (!patientResponse.data) return;\n\n      const newCondition = getNewCondition(patientResponse.data.id);\n      setDrawerIsOpen(true);\n      setSchema(conditionAddSchema);\n      setCurrentlySelectedData(\n        getAddConditionData({\n          condition: new ConditionModel(newCondition),\n        })\n      );\n    };\n\n    const addConditionBtn = (\n      <button\n        className=\"ctw-btn-primary\"\n        type=\"button\"\n        onClick={handleAddNewCondition}\n        data-zus-telemetry-click=\"Add new condition (Empty table)\"\n      >\n        Add Condition\n      </button>\n    );\n\n    const patientHistory = usePatientHistory();\n\n    const shouldShowClinicalHistoryArea =\n      !!patientHistory.lastRetrievedAt ||\n      (otherProviderRecordsResponse.data &&\n        otherProviderRecordsResponse.data.length > 0);\n\n    useEffect(() => {\n      async function load() {\n        const patientConditions = patientRecordsResponse.data;\n        const otherConditions = otherProviderRecordsResponse.data;\n\n        if (patientConditions) {\n          setPatientRecords(\n            patientConditions.filter((c) => c.active || includeInactive)\n          );\n\n          if (otherConditions) {\n            setOtherProviderRecords(\n              filterOtherConditions(\n                otherConditions,\n                patientConditions,\n                includeInactive\n              )\n            );\n          } else {\n            setOtherProviderRecords([]);\n          }\n        }\n\n        if (patientRecordsResponse.error) {\n          setPatientRecords([]);\n          setOtherProviderRecords([]);\n        }\n      }\n      void load();\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [\n      includeInactive,\n      patientResponse.data,\n      patientRecordsResponse.data,\n      otherProviderRecordsResponse.data,\n      patientRecordsResponse.error,\n    ]);\n\n    if (patientResponse.isError) {\n      return <ConditionsNoPatient className={className} />;\n    }\n\n    return (\n      <div\n        ref={containerRef}\n        data-zus-telemetry-namespace=\"Conditions\"\n        className={cx(\"ctw-conditions\", className, {\n          \"ctw-conditions-stacked\": breakpoints.sm,\n        })}\n      >\n        {!readOnly && (\n          <div className=\"ctw-conditions-heading-container\">\n            <div className=\"ctw-title\">Conditions</div>\n            <button\n              type=\"button\"\n              className=\"ctw-btn-clear ctw-link\"\n              data-zus-telemetry-click=\"Add new condition\"\n              onClick={handleAddNewCondition}\n            >\n              + Add Condition\n            </button>\n          </div>\n        )}\n\n        <div className=\"ctw-conditions-body-container\">\n          <div className=\"ctw-space-y-3\">\n            <div className=\"ctw-conditions-title-container\">\n              <div className=\"ctw-title\">Patient Record</div>\n              <ToggleControl\n                onFormChange={() => setIncludeInactive(!includeInactive)}\n                toggleProps={{ name: \"conditions\", text: \"Include Inactive\" }}\n              />\n            </div>\n\n            <ConditionsTableBase\n              stacked={breakpoints.sm}\n              conditions={patientRecords}\n              isLoading={patientRecordsResponse.isLoading}\n              hideMenu={readOnly}\n              sort={sort}\n              onSort={(newSort) => setSort(newSort)}\n              emptyMessage={\n                <>\n                  <div>{patientRecordsMessage}</div>\n                  {!patientRecordsResponse.isError && !readOnly && (\n                    <div className=\"ctw-mt-5\">{addConditionBtn}</div>\n                  )}\n                </>\n              }\n              rowMenuActions={(condition) => [\n                {\n                  name: \"Edit\",\n                  action: async () => {\n                    handleEditCondition(condition);\n                  },\n                },\n                {\n                  name: \"View History\",\n                  action: async () => {\n                    showConditionHistory({\n                      condition,\n                      readOnly,\n                    });\n                  },\n                },\n                {\n                  name: \"Delete\",\n                  className: \"dangerous\",\n                  action: async () => {\n                    handleConditionDelete(condition);\n                  },\n                },\n              ]}\n            />\n          </div>\n          <div className=\"ctw-space-y-3\">\n            <PatientHistoryStatus\n              status={patientHistory.lastStatus}\n              date={patientHistory.dateCreatedAt}\n            />\n            <div className=\"ctw-conditions-title-container\">\n              <div className=\"ctw-title\">Other Provider Records</div>\n              <div className=\"ctw-flex ctw-items-baseline ctw-space-x-2\">\n                {patientHistory.lastRetrievedAt && (\n                  <div className=\"ctw-text-sm ctw-italic ctw-text-black\">\n                    Last Retrieved{\" \"}\n                    {formatISODateStringToDate(patientHistory.lastRetrievedAt)}\n                  </div>\n                )}\n                {shouldShowClinicalHistoryArea &&\n                  !readOnly &&\n                  !hideRequestRecords && (\n                    <button\n                      type=\"button\"\n                      className=\"ctw-btn-clear ctw-link\"\n                      onClick={patientHistory.openHistoryRequestDrawer}\n                      data-zus-telemetry-click=\"Request records\"\n                    >\n                      Request Records\n                    </button>\n                  )}\n              </div>\n            </div>\n            {shouldShowClinicalHistoryArea ? (\n              <ConditionsTableBase\n                className=\"ctw-conditions-not-reviewed\"\n                stacked={breakpoints.sm}\n                conditions={otherProviderRecords}\n                sort={sort}\n                onSort={(newSort) => setSort(newSort)}\n                isLoading={\n                  otherProviderRecordsResponse.isLoading ||\n                  patientRecordsResponse.isLoading\n                }\n                hideMenu={readOnly}\n                emptyMessage={otherProviderRecordMessage}\n                rowMenuActions={(condition) => [\n                  {\n                    name: \"Add\",\n                    action: async () => {\n                      handleAddOtherProviderCondition(condition);\n                    },\n                  },\n                  {\n                    name: \"View History\",\n                    action: async () => {\n                      showConditionHistory({ condition, readOnly: true });\n                    },\n                  },\n                  {\n                    name: condition.isArchived ? \"Un-Archive\" : \"Archive\",\n                    action: async () => {\n                      const requestContext = await getRequestContext();\n                      await toggleArchive(condition, requestContext);\n                    },\n                  },\n                ]}\n              />\n            ) : (\n              <PatientHistoryMessage\n                readOnly={readOnly || hideRequestRecords}\n                onClick={patientHistory.openHistoryRequestDrawer}\n              />\n            )}\n          </div>\n        </div>\n\n        {patientResponse.data && (\n          <DrawerFormWithFields\n            title={`${formAction} Condition`}\n            header={\n              formAction === \"Edit\" &&\n              selectedCondition && (\n                <ConditionHeader condition={selectedCondition} />\n              )\n            }\n            action={curry(createOrEditCondition)(\n              selectedCondition,\n              patientResponse.data.id\n            )}\n            data={currentSelectedData}\n            schema={schema}\n            isOpen={drawerIsOpen}\n            onClose={() => setDrawerIsOpen(false)}\n          />\n        )}\n\n        {selectedCondition && patientResponse.data && (\n          <ModalConfirmDelete\n            resource={selectedCondition}\n            resourceName={selectedCondition.display || \"unnamed condition\"}\n            onClose={() => setShowConfirmDelete(false)}\n            isOpen={showConfirmDelete}\n            onDelete={async () => {\n              const requestContext = await getRequestContext();\n              await onConditionDelete(\n                selectedCondition.resource,\n                requestContext\n              );\n            }}\n          />\n        )}\n      </div>\n    );\n  },\n  \"Conditions\"\n);\n","import {\n  userEvent,\n  waitForElementToBeRemoved,\n  within,\n} from \"@storybook/testing-library\";\n\nexport function conditionFormDrawer(canvasElement: HTMLElement) {\n  const canvas = within(canvasElement);\n  const drawer = within(canvas.getByRole(\"dialog\"));\n\n  return {\n    conditionSearch: (search: string) =>\n      userEvent.type(drawer.getByPlaceholderText(\"Type to search\"), search),\n    selectCondition: async (name: string) =>\n      userEvent.click(await drawer.findByRole(\"option\", { name })),\n    status: (status: string) =>\n      userEvent.selectOptions(drawer.getByTestId(\"form-field-status\"), status),\n\n    onset: (date: string) =>\n      userEvent.type(drawer.getByTestId(\"form-field-onset\"), date),\n    abatement: (date: string) =>\n      userEvent.type(drawer.getByTestId(\"form-field-abatement\"), date),\n    note: (note: string) =>\n      userEvent.type(drawer.getByTestId(\"form-field-note\"), note),\n\n    cancel: () =>\n      userEvent.click(drawer.getByRole(\"button\", { name: \"Cancel\" })),\n    save: async () => {\n      userEvent.click(drawer.getByRole(\"button\", { name: \"Save\" }));\n      await waitForElementToBeRemoved(() => canvas.queryByRole(\"dialog\"));\n    },\n  };\n}\n","import { expect } from \"@storybook/jest\";\nimport {\n  userEvent,\n  waitFor,\n  waitForElementToBeRemoved,\n  within,\n} from \"@storybook/testing-library\";\n\nexport function conditionTable(\n  canvasElement: HTMLElement,\n  tableEl: HTMLElement\n) {\n  const canvas = within(canvasElement);\n  const table = within(tableEl);\n\n  async function openMenu(row: number) {\n    userEvent.click(getRow(row).getByRole(\"button\", { name: /dropdown/i }));\n    await canvas.findAllByRole(\"menuitem\");\n  }\n\n  function clickMenu(menuItem: string) {\n    userEvent.click(canvas.getByRole(\"menuitem\", { name: menuItem }));\n  }\n\n  function getRow(row: number) {\n    const tbody = table.getAllByRole(\"rowgroup\")[1];\n    return within(within(tbody).queryAllByRole(\"row\")[row]);\n  }\n\n  return {\n    table,\n    // We use waitFor here as there is a race condition\n    // when switching between tests, where the new\n    // mocked data has yet to update.\n    toHaveRowCount: async (count: number) => {\n      const tbody = table.getAllByRole(\"rowgroup\")[1];\n      if (count === 0) {\n        await waitFor(() => expect(tbody).toBeFalsy());\n      } else {\n        await waitFor(() =>\n          expect(within(tbody).queryAllByRole(\"row\")).toHaveLength(count)\n        );\n      }\n    },\n    toHaveRowWithText: (row: number, text: string | RegExp) => {\n      getRow(row).getByText(text);\n    },\n    add: async (row: number) => {\n      await openMenu(row);\n      clickMenu(\"Add\");\n    },\n    delete: async (row: number) => {\n      await openMenu(row);\n      clickMenu(\"Delete\");\n      userEvent.click(await canvas.findByRole(\"button\", { name: /remove/i }));\n      await waitForElementToBeRemoved(() => canvas.queryByRole(\"dialog\"));\n    },\n    edit: async (row: number) => {\n      await openMenu(row);\n      clickMenu(\"Edit\");\n    },\n    viewHistory: async (row: number) => {\n      await openMenu(row);\n      clickMenu(\"View History\");\n    },\n  };\n}\n","import { expect } from \"@storybook/jest\";\nimport { userEvent, waitFor, within } from \"@storybook/testing-library\";\nimport { conditionTable } from \"./condition-table\";\n\nexport async function conditionsObject(canvasElement: HTMLElement) {\n  const canvas = within(canvasElement);\n  await waitFor(() => expect(canvas.queryAllByRole(\"table\")).toHaveLength(2));\n  const tables = canvas.queryAllByRole(\"table\");\n  const patientRecord = conditionTable(canvasElement, tables[0]);\n  const otherProvider = conditionTable(canvasElement, tables[1]);\n\n  // Wait for loading to finish, we should have an active condition in each table.\n  await patientRecord.table.findAllByText(\"active\");\n  await otherProvider.table.findAllByText(\"active\");\n\n  return {\n    clickAddCondition: () =>\n      userEvent.click(canvas.getByRole(\"button\", { name: \"+ Add Condition\" })),\n\n    toggleInactive: () =>\n      userEvent.click(canvas.getByLabelText(\"Include Inactive\")),\n\n    patientRecord,\n    otherProvider,\n  };\n}\n","import { expect } from \"@storybook/jest\";\nimport type { Meta, StoryObj } from \"@storybook/react\";\nimport { userEvent, waitFor, within } from \"@storybook/testing-library\";\nimport { Conditions, ConditionsProps } from \"../conditions\";\nimport { conditionFormDrawer } from \"./story-helpers/condition-form-drawer\";\nimport { conditionsObject } from \"./story-helpers/conditions\";\nimport { emptyConditions } from \"./story-helpers/mocks/empty-conditions\";\nimport { otherConditions } from \"./story-helpers/mocks/other-conditions\";\nimport { patientConditions } from \"./story-helpers/mocks/patient-conditions\";\nimport { setupConditionMocks } from \"./story-helpers/mocks/requests\";\nimport { CTWProvider } from \"@/components/core/providers/ctw-provider\";\nimport { PatientProvider } from \"@/components/core/providers/patient-provider\";\nimport { SYSTEM_ZUS_UNIVERSAL_ID } from \"@/fhir/system-urls\";\ntype Props = ConditionsProps;\nexport default ({\n  component: Conditions,\n  tags: [\"autodocs\"],\n  argTypes: {\n    className: {\n      options: [\"Blank\", \"Fixed Width\"],\n      control: \"select\",\n      mapping: {\n        Blank: \"\",\n        \"Fixed Width\": \"ctw-m-auto ctw-max-w-[600px]\"\n      }\n    }\n  },\n  args: {\n    className: \"Blank\",\n    readOnly: false,\n    hideRequestRecords: false\n  },\n  decorators: [(Story, {\n    args\n  }) => <CTWProvider env=\"dev\" authToken=\"dummy-token\" builderId=\"b123\">\n        <PatientProvider patientID=\"u12345\" systemURL={SYSTEM_ZUS_UNIVERSAL_ID}>\n          <Story args={args} />\n        </PatientProvider>\n      </CTWProvider>]\n} as Meta<Props>);\nexport const Basic: StoryObj<Props> = {\n  ...setupConditionMocks({\n    otherConditions,\n    patientConditions\n  })\n};\nexport const Empty: StoryObj<Props> = {\n  ...setupConditionMocks({\n    otherConditions: emptyConditions,\n    patientConditions: emptyConditions\n  })\n};\nexport const TestAdd: StoryObj<Props> = {\n  ...Basic,\n  play: async ({\n    canvasElement\n  }) => {\n    const conditions = await conditionsObject(canvasElement);\n    await conditions.patientRecord.toHaveRowCount(2);\n    const newCondition = \"Heart failure (disorder)\";\n    conditions.clickAddCondition();\n    const conditionForm = conditionFormDrawer(canvasElement);\n    conditionForm.conditionSearch(\"heart\");\n    await conditionForm.selectCondition(newCondition);\n    conditionForm.status(\"Active\");\n    conditionForm.onset(\"2020-02-14\");\n    await conditionForm.save();\n    await conditions.patientRecord.toHaveRowCount(3);\n    expect(await conditions.patientRecord.table.findByText(newCondition)).toBeTruthy();\n  }\n};\nexport const TestAddOther: StoryObj<Props> = {\n  ...Basic,\n  play: async ({\n    canvasElement\n  }) => {\n    const conditions = await conditionsObject(canvasElement);\n    await conditions.patientRecord.toHaveRowCount(2);\n    await conditions.otherProvider.add(2);\n    const conditionForm = conditionFormDrawer(canvasElement);\n    await conditionForm.save();\n    await conditions.patientRecord.toHaveRowCount(3);\n    expect(await conditions.patientRecord.table.findByText(/iron deficiency/i)).toBeTruthy();\n  }\n};\nexport const TestEdit: StoryObj<Props> = {\n  ...Basic,\n  play: async ({\n    canvasElement\n  }) => {\n    const conditions = await conditionsObject(canvasElement);\n    await conditions.patientRecord.toHaveRowCount(2);\n    await conditions.patientRecord.edit(0);\n    const conditionForm = conditionFormDrawer(canvasElement);\n    conditionForm.note(\"hello world\");\n    await conditionForm.save();\n    conditions.patientRecord.toHaveRowWithText(0, /confirmed/i);\n  }\n};\nexport const TestDelete: StoryObj<Props> = {\n  ...Basic,\n  play: async ({\n    canvasElement\n  }) => {\n    const conditions = await conditionsObject(canvasElement);\n    await conditions.patientRecord.toHaveRowCount(2);\n    await conditions.patientRecord.delete(0);\n    await conditions.patientRecord.toHaveRowCount(1);\n    conditions.toggleInactive();\n    await conditions.patientRecord.toHaveRowCount(3);\n    conditions.patientRecord.toHaveRowWithText(1, /entered-in-error/i);\n    conditions.toggleInactive();\n    await conditions.patientRecord.toHaveRowCount(1);\n  }\n};\nexport const TestViewHistory: StoryObj<Props> = {\n  ...Basic,\n  play: async ({\n    canvasElement\n  }) => {\n    const conditions = await conditionsObject(canvasElement);\n    await conditions.patientRecord.toHaveRowCount(2);\n    await conditions.patientRecord.viewHistory(0);\n    const canvas = within(canvasElement);\n    await waitFor(() => expect(canvas.queryAllByRole(\"dialog\")).toHaveLength(1));\n    const drawer = within(canvas.getByRole(\"dialog\"));\n    expect(await drawer.findByText(/generalized anxiety disorder/i)).toBeTruthy();\n    await waitFor(() => expect(drawer.getAllByRole(\"button\", {\n      name: /details/i\n    })).toHaveLength(3));\n    userEvent.click(drawer.getAllByRole(\"button\", {\n      name: /close/i\n    })[0]);\n  }\n};\nBasic.parameters = {\n  ...Basic.parameters,\n  storySource: {\n    source: \"{\\n  ...setupConditionMocks({\\n    otherConditions,\\n    patientConditions\\n  })\\n}\",\n    ...Basic.parameters?.storySource\n  }\n};\nEmpty.parameters = {\n  ...Empty.parameters,\n  storySource: {\n    source: \"{\\n  ...setupConditionMocks({\\n    otherConditions: emptyConditions,\\n    patientConditions: emptyConditions\\n  })\\n}\",\n    ...Empty.parameters?.storySource\n  }\n};\nTestAdd.parameters = {\n  ...TestAdd.parameters,\n  storySource: {\n    source: \"{\\n  ...Basic,\\n  play: async ({\\n    canvasElement\\n  }) => {\\n    const conditions = await conditionsObject(canvasElement);\\n    await conditions.patientRecord.toHaveRowCount(2);\\n    const newCondition = \\\"Heart failure (disorder)\\\";\\n    conditions.clickAddCondition();\\n    const conditionForm = conditionFormDrawer(canvasElement);\\n    conditionForm.conditionSearch(\\\"heart\\\");\\n    await conditionForm.selectCondition(newCondition);\\n    conditionForm.status(\\\"Active\\\");\\n    conditionForm.onset(\\\"2020-02-14\\\");\\n    await conditionForm.save();\\n    await conditions.patientRecord.toHaveRowCount(3);\\n    expect(await conditions.patientRecord.table.findByText(newCondition)).toBeTruthy();\\n  }\\n}\",\n    ...TestAdd.parameters?.storySource\n  }\n};\nTestAddOther.parameters = {\n  ...TestAddOther.parameters,\n  storySource: {\n    source: \"{\\n  ...Basic,\\n  play: async ({\\n    canvasElement\\n  }) => {\\n    const conditions = await conditionsObject(canvasElement);\\n    await conditions.patientRecord.toHaveRowCount(2);\\n    await conditions.otherProvider.add(2);\\n    const conditionForm = conditionFormDrawer(canvasElement);\\n    await conditionForm.save();\\n    await conditions.patientRecord.toHaveRowCount(3);\\n    expect(await conditions.patientRecord.table.findByText(/iron deficiency/i)).toBeTruthy();\\n  }\\n}\",\n    ...TestAddOther.parameters?.storySource\n  }\n};\nTestEdit.parameters = {\n  ...TestEdit.parameters,\n  storySource: {\n    source: \"{\\n  ...Basic,\\n  play: async ({\\n    canvasElement\\n  }) => {\\n    const conditions = await conditionsObject(canvasElement);\\n    await conditions.patientRecord.toHaveRowCount(2);\\n    await conditions.patientRecord.edit(0);\\n    const conditionForm = conditionFormDrawer(canvasElement);\\n    conditionForm.note(\\\"hello world\\\");\\n    await conditionForm.save();\\n    conditions.patientRecord.toHaveRowWithText(0, /confirmed/i);\\n  }\\n}\",\n    ...TestEdit.parameters?.storySource\n  }\n};\nTestDelete.parameters = {\n  ...TestDelete.parameters,\n  storySource: {\n    source: \"{\\n  ...Basic,\\n  play: async ({\\n    canvasElement\\n  }) => {\\n    const conditions = await conditionsObject(canvasElement);\\n    await conditions.patientRecord.toHaveRowCount(2);\\n    await conditions.patientRecord.delete(0);\\n    await conditions.patientRecord.toHaveRowCount(1);\\n    conditions.toggleInactive();\\n    await conditions.patientRecord.toHaveRowCount(3);\\n    conditions.patientRecord.toHaveRowWithText(1, /entered-in-error/i);\\n    conditions.toggleInactive();\\n    await conditions.patientRecord.toHaveRowCount(1);\\n  }\\n}\",\n    ...TestDelete.parameters?.storySource\n  }\n};\nTestViewHistory.parameters = {\n  ...TestViewHistory.parameters,\n  storySource: {\n    source: \"{\\n  ...Basic,\\n  play: async ({\\n    canvasElement\\n  }) => {\\n    const conditions = await conditionsObject(canvasElement);\\n    await conditions.patientRecord.toHaveRowCount(2);\\n    await conditions.patientRecord.viewHistory(0);\\n    const canvas = within(canvasElement);\\n    await waitFor(() => expect(canvas.queryAllByRole(\\\"dialog\\\")).toHaveLength(1));\\n    const drawer = within(canvas.getByRole(\\\"dialog\\\"));\\n    expect(await drawer.findByText(/generalized anxiety disorder/i)).toBeTruthy();\\n    await waitFor(() => expect(drawer.getAllByRole(\\\"button\\\", {\\n      name: /details/i\\n    })).toHaveLength(3));\\n    userEvent.click(drawer.getAllByRole(\\\"button\\\", {\\n      name: /close/i\\n    })[0]);\\n  }\\n}\",\n    ...TestViewHistory.parameters?.storySource\n  }\n};"],"names":["DotsHorizontalIcon","props","svgRef","React.createElement","ForwardRef","React.forwardRef","DotsHorizontalIcon$1","ConditionsNoPatient","className","React","cx","CautionAlert","DropdownMenu","children","menuItems","triggerClassName","telemetryNamespace","ctwProviderRef","useCTW","isLoading","setIsLoading","useState","handleClick","menuItem","Menu","RadixDropdownMenu.Root","RadixDropdownMenu.Trigger","Loading","RadixDropdownMenu.Portal","RadixDropdownMenu.Content","event","RadixDropdownMenu.Arrow","RadixDropdownMenu.Item","ConditionsTableBase","conditions","rowMenuActions","hideMenu","sort","onSort","tableProps","columns","condition","Table","PatientHistoryMessage","withErrorBoundary","readOnly","onClick","EMPTY_MESSAGE_PATIENT_RECORD","EMPTY_MESSAGE_PROVIDER","ERROR_MSG","Conditions","hideRequestRecords","containerRef","useRef","breakpoints","useBreakpoints","drawerIsOpen","setDrawerIsOpen","showConfirmDelete","setShowConfirmDelete","showConditionHistory","useConditionHistory","patientRecords","setPatientRecords","otherProviderRecords","setOtherProviderRecords","includeInactive","setIncludeInactive","formAction","setFormAction","schema","setSchema","conditionAddSchema","currentSelectedData","setCurrentlySelectedData","selectedCondition","setSelectedCondition","patientResponse","usePatient","patientRecordsResponse","usePatientConditions","otherProviderRecordsResponse","useOtherProviderConditions","getRequestContext","setSort","patientRecordsMessage","otherProviderRecordMessage","handleEditCondition","conditionEditSchema","getEditingPatientConditionData","handleConditionDelete","handleAddOtherProviderCondition","newCondition","getAddConditionWithDefaults","getAddConditionData","ConditionModel","handleAddNewCondition","getNewCondition","addConditionBtn","patientHistory","usePatientHistory","shouldShowClinicalHistoryArea","useEffect","load","patientConditions","otherConditions","c","filterOtherConditions","ToggleControl","newSort","PatientHistoryStatus","formatISODateStringToDate","requestContext","toggleArchive","DrawerFormWithFields","ConditionHeader","curry","createOrEditCondition","ModalConfirmDelete","onConditionDelete","conditionFormDrawer","canvasElement","canvas","within","drawer","search","userEvent","name","status","date","note","waitForElementToBeRemoved","conditionTable","tableEl","table","openMenu","row","getRow","clickMenu","tbody","count","waitFor","expect","text","conditionsObject","tables","patientRecord","otherProvider","conditions_stories","Story","args","CTWProvider","PatientProvider","SYSTEM_ZUS_UNIVERSAL_ID","Basic","setupConditionMocks","Empty","emptyConditions","TestAdd","conditionForm","TestAddOther","TestEdit","TestDelete","TestViewHistory","_a"],"mappings":"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"}
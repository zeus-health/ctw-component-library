var $=Object.defineProperty;var k=(e,t,n)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var T=(e,t,n)=>(k(e,typeof t!="symbol"?t+"":t,n),n);import{r as s,R as d}from"./index-6f814c40.js";import{F as B,w as R,b as F,d as H,e as Y,g as L,h as Q,i as I,T as p,j,k as S,o as g,l as w,n as z,p as v,S as G,u as y,q as b,r as C}from"./patient-helper-085f4541.js";import"./_baseToString-2a4c2757.js";import"./sortBy-1cabbe82.js";import"./_baseClone-184e5c2b.js";import"./sortBy-649a17b3.js";import"./_equalByTag-5ee6784b.js";import"./_baseForOwn-54d22bab.js";import{u as W}from"./uniq-789c9501.js";import"./_createSet-014fa0cf.js";import{q as _}from"./request-3ce689a7.js";import{c as Z}from"./_basePickBy-53e340c6.js";const A=s.createContext(void 0),K=e=>d.createElement("div",null);function P({children:e}){const[t,n]=s.useState(!1),[a,r]=s.useState({component:K}),i=s.useMemo(()=>({openModal:o=>{r(o),n(!1),setTimeout(()=>{n(!0)})}}),[]);return d.createElement(A.Provider,{value:i},a.component({isOpen:t,onClose:()=>n(!1)}),e)}const Ee=()=>{const e=s.useContext(A);if(!e)throw new Error("useModal must be used within a ModalProvider");return e};try{P.displayName="ModalProvider",P.__docgenInfo={description:"",displayName:"ModalProvider",props:{}}}catch{}const D=s.createContext(void 0),J=e=>d.createElement("div",null);function h({children:e}){const[t,n]=s.useState(!1),[a,r]=s.useState({component:J}),i=s.useMemo(()=>({openDrawer:o=>{r(o),n(!1),setTimeout(()=>{n(!0)})}}),[]);return d.createElement(D.Provider,{value:i},a.component({isOpen:t,onClose:()=>n(!1)}),e)}const Ve=()=>{const e=s.useContext(D);if(!e)throw new Error("useDrawer must be used within a DrawerProvider");return e};try{h.displayName="DrawerProvider",h.__docgenInfo={description:"",displayName:"DrawerProvider",props:{}}}catch{}class X extends B{constructor(){super(...arguments);T(this,"kind","Practitioner")}get fullName(){var r,i;const n=(r=this.resource.name)==null?void 0:r[0];return[(i=n==null?void 0:n.given)!=null&&i.length?n.given[0]:"",n==null?void 0:n.family].filter(o=>o).join(" ")}}const ee=async(e,t)=>{let n=[];try{const{resources:a}=await Y("Practitioner",t,{_id:e});n=a}catch(a){throw new Error(`Failed fetching practitioner with an id of: ${e}. ${a}`)}if(!n[0])throw new Error(`No practitioner found with an id of: ${e}`);return new X(n[0])};async function te(e){const t=F(e.authToken);if(t){const n=await ee(t,e);return{reference:`Practitioner/${t}`,type:"Practitioner",display:n.fullName}}return{display:H(e.authToken)}}const U=R(te,"req.get_users_practitioner_reference"),x={system:j,code:"assembler",display:"Assembler"},M={coding:[{system:S,code:"CREATE",display:"create"}]},ne={coding:[{system:S,code:"UPDATE",display:"revise"}]},re=async(e,t,n)=>{var l;const{fhirClient:a}=n,r=I(n.authToken),i=parseInt(((l=t.meta)==null?void 0:l.versionId)||"0",10),o={resourceType:"Provenance",agent:[{who:await U(n),onBehalfOf:{display:r}},{type:{coding:[x]},who:{display:"Zus Health"}}],recorded:new Date().toISOString(),target:[{reference:`${t.resourceType}/${t.id}/_history/${i}`,type:t.resourceType}]};o.activity=e==="CREATE"?M:ne;try{const c=a.create({resourceType:"Provenance",body:o});return p.reportActionSuccess(`${t.resourceType}.provenance`),c}catch(c){throw p.reportActionFailure(`${t.resourceType}.provenance`),c}};async function Ne(e,t){const n=W(t.map(r=>`${r.resourceType}/${r.id}`)).join(","),{resources:a}=await _.fetchQuery([L,n],async()=>Q("Provenance",e,{target:n}));return a}let m;const ae=new Uint8Array(16);function ie(){if(!m&&(m=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!m))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return m(ae)}const u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function oe(e,t=0){return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}const ue=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),q={randomUUID:ue};function E(e,t,n){if(q.randomUUID&&!t&&!e)return q.randomUUID();e=e||{};const a=e.random||(e.rng||ie)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,t){n=n||0;for(let r=0;r<16;++r)t[n+r]=a[r];return t}return oe(a)}async function se(e,t){const{fhirClient:n}=t,a=e;let r="create",i;try{return e.id?(r="update",i=await n.update({resourceType:e.resourceType,id:e.id,body:g(e)}),w(i)||await re("UPDATE",i,t)):(i=await n.create({resourceType:e.resourceType,body:g(e)}),w(i)||(a.id=i.id)),p.reportActionSuccess(`${e.resourceType}.${r}`),i}catch(o){return p.reportActionFailure(`${e.resourceType}.${r}`),p.logError(o),o}}async function Re(e,t){const{fhirClient:n}=t,a=I(t.authToken),r=e.id||E(),i=E(),o={resourceType:"Bundle",type:"transaction",entry:[{request:{method:"POST",url:e.resourceType},fullUrl:r,resource:e},{request:{method:"POST",url:"Provenance"},fullUrl:i,resource:{resourceType:"Provenance",activity:M,agent:[{who:await U(t),onBehalfOf:{display:a}},{type:{coding:[x]},who:{display:"Zus Health"}}],recorded:new Date().toISOString(),target:[{reference:`${e.resourceType}/${r}`,type:e.resourceType}]}}]};return n.transaction({body:g({...o,type:"transaction"})})}const de=async(e,t,n)=>{const a=await n(),r=Z(e.resource);r.gender=t.gender,r.birthDate=z(t.dateOfBirth),r.name=[{use:"official",family:t.lastName,given:[t.firstName]}],r.address=[{line:[t.address],city:t.city,state:t.state,postalCode:t.zipCode}];const i=[];t.phone&&i.push({system:"phone",value:t.phone}),t.email&&i.push({system:"email",value:t.email}),r.telecom=i;const o=await se(r,a);return await _.invalidateQueries([v]),o},f=s.createContext(void 0),O=1e3*60*5;function V({children:e,patientUPID:t,patientID:n,systemURL:a,tags:r,onPatientSave:i}){const o=s.useMemo(()=>({patientID:t||n,systemURL:t?G:a,tags:r,onPatientSave:i}),[n,t,a,r,i]);return d.createElement(f.Provider,{value:o},d.createElement(P,null,d.createElement(h,null,e)))}function le(){const{getRequestContext:e}=y(),t=s.useContext(f);if(!t)throw new Error("usePatient must be used within a PatientProvider");const{patientID:n,systemURL:a,tags:r}=t;return b([v,n,a,r],R(async()=>{const i=await e();return C(i,n,a,{_tag:(r==null?void 0:r.map(o=>`${o.system}|${o.code}`))??[]})},"req.get_builder_fhir_patient"),{staleTime:O})}function Ie(){const{getRequestContext:e}=y(),t=s.useContext(f);return{getPatient:s.useCallback(()=>{if(!t)throw new Error("usePatient must be used within a PatientProvider");const{patientID:n,systemURL:a,tags:r}=t;return _.fetchQuery([v,n,a,r],async()=>{const i=await e();return C(i,n,a,{_tag:(r==null?void 0:r.map(o=>`${o.system}|${o.code}`))??[]})},{staleTime:O})},[t,e])}}function N(e){const{getRequestContext:t}=y(),n=s.useContext(f);if(!n)throw new Error("usePatient must be used within a PatientProvider");const{onPatientSave:a}=n;return s.useCallback(async r=>a?a(r):de(e,r,t),[a,e,t])}function Se(e,t,n,a=!0){var o,l;const{getRequestContext:r}=y(),i=le();return b([e,(o=i.data)==null?void 0:o.UPID,...t],async()=>{const c=await r();return n(c,i.data,t)},{enabled:!!((l=i.data)!=null&&l.UPID)&&a})}try{V.displayName="PatientProvider",V.__docgenInfo={description:"",displayName:"PatientProvider",props:{tags:{defaultValue:null,description:"",name:"tags",required:!1,type:{name:"Tag[]"}},onPatientSave:{defaultValue:null,description:"",name:"onPatientSave",required:!1,type:{name:"((data: PatientFormData) => Promise<void>)"}},patientUPID:{defaultValue:null,description:"",name:"patientUPID",required:!1,type:{name:"string"}},patientID:{defaultValue:null,description:"",name:"patientID",required:!1,type:{name:"string"}},systemURL:{defaultValue:null,description:"",name:"systemURL",required:!1,type:{name:"string"}}}}}catch{}try{N.displayName="useHandlePatientSave",N.__docgenInfo={description:"",displayName:"useHandlePatientSave",props:{kind:{defaultValue:null,description:"",name:"kind",required:!0,type:{name:'"Patient"'}},active:{defaultValue:null,description:"",name:"active",required:!0,type:{name:"boolean | undefined"}},contact:{defaultValue:null,description:"",name:"contact",required:!0,type:{name:"PatientContact[] | undefined"}},dob:{defaultValue:null,description:"",name:"dob",required:!0,type:{name:"string | undefined"}},age:{defaultValue:null,description:"",name:"age",required:!0,type:{name:"number | undefined"}},gender:{defaultValue:null,description:"",name:"gender",required:!0,type:{name:"string | undefined"}},maritalStatus:{defaultValue:null,description:"",name:"maritalStatus",required:!0,type:{name:"string | undefined"}},organization:{defaultValue:null,description:"",name:"organization",required:!0,type:{name:"OrganizationModel | undefined"}},use:{defaultValue:null,description:"",name:"use",required:!0,type:{name:"enum",value:[{value:"undefined"},{value:'"usual"'},{value:'"official"'},{value:'"temp"'},{value:'"nickname"'},{value:'"anonymous"'},{value:'"old"'},{value:'"maiden"'}]}},officialOrUsualIdentifier:{defaultValue:null,description:"",name:"officialOrUsualIdentifier",required:!0,type:{name:"string"}},UPID:{defaultValue:null,description:"",name:"UPID",required:!0,type:{name:"string"}},getPhoneNumber:{defaultValue:null,description:"",name:"getPhoneNumber",required:!0,type:{name:'(use?: "temp" | "old" | "home" | "work" | "mobile" | undefined) => string | undefined'}},phoneNumber:{defaultValue:null,description:"",name:"phoneNumber",required:!0,type:{name:"string | undefined"}},email:{defaultValue:null,description:"",name:"email",required:!0,type:{name:"string | undefined"}},bestHomeAddress:{defaultValue:null,description:"",name:"bestHomeAddress",required:!0,type:{name:"Address | undefined"}},homeAddress:{defaultValue:null,description:"",name:"homeAddress",required:!0,type:{name:"Address | undefined"}},bestName:{defaultValue:null,description:"",name:"bestName",required:!0,type:{name:"HumanName"}},additionalNames:{defaultValue:null,description:"",name:"additionalNames",required:!0,type:{name:"string | undefined"}},display:{defaultValue:null,description:"",name:"display",required:!0,type:{name:"string"}},firstName:{defaultValue:null,description:"",name:"firstName",required:!0,type:{name:"string"}},fullName:{defaultValue:null,description:"",name:"fullName",required:!0,type:{name:"string"}},lastName:{defaultValue:null,description:"",name:"lastName",required:!0,type:{name:"string | undefined"}},nickname:{defaultValue:null,description:"",name:"nickname",required:!0,type:{name:"string | undefined"}},prefix:{defaultValue:null,description:"",name:"prefix",required:!0,type:{name:"string | undefined"}},suffix:{defaultValue:null,description:"",name:"suffix",required:!0,type:{name:"string | undefined"}},resource:{defaultValue:null,description:"",name:"resource",required:!0,type:{name:"Patient"}},includedResources:{defaultValue:null,description:"",name:"includedResources",required:!1,type:{name:"ResourceMap"}},revIncludes:{defaultValue:null,description:"",name:"revIncludes",required:!1,type:{name:"Resource[]"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},versionId:{defaultValue:null,description:"",name:"versionId",required:!0,type:{name:"string"}},isArchived:{defaultValue:null,description:"",name:"isArchived",required:!0,type:{name:"boolean"}},isSummaryResource:{defaultValue:null,description:"",name:"isSummaryResource",required:!0,type:{name:"boolean"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"string"}},resourceTypeTitle:{defaultValue:null,description:"",name:"resourceTypeTitle",required:!0,type:{name:"string"}},getBasicResourceByAction:{defaultValue:null,description:"",name:"getBasicResourceByAction",required:!0,type:{name:"(profileAction: string) => Basic | undefined"}},isEnriched:{defaultValue:null,description:"",name:"isEnriched",required:!0,type:{name:"() => boolean"}},toString:{defaultValue:null,description:"",name:"toString",required:!1,type:{name:"() => string"}}}}}catch{}export{V as P,Ve as a,Ee as b,X as c,le as d,se as e,Re as f,U as g,N as h,Ie as i,Ne as s,Se as u,E as v};
